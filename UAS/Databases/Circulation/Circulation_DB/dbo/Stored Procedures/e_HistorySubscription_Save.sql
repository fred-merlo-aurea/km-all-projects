CREATE PROCEDURE [dbo].[e_HistorySubscription_Save]
@HistorySubscriptionID int,
@SubscriptionID int,
@PublisherID int,
@SubscriberID int,
@PublicationID int,
@ActionID_Current int,
@ActionID_Previous int,
@SubscriptionStatusID int,
@IsPaid bit,
@QSourceID int,
@QSourceDate datetime,
@DeliverabilityID int,
@IsSubscribed bit,
@SubscriberSourceCode varchar(256)='',
@Copies int,
@OriginalSubscriberSourceCode varchar(256)='',
@SubscriptionDateCreated datetime,
@SubscriptionDateUpdated datetime,
@SubscriptionCreatedByUserID int,
@SubscriptionUpdatedByUserID int,
@AccountNumber int = '',
@GraceIssues int = '',
@IsNewSubscription int = '',
@MemberGroup varchar(256) = '',
@OnBehalfOf varchar(256) = '',
@Par3cID int = '',
@SequenceID int = '',
@SubsrcTypeID int = '',
@Verify varchar(256),
@IsActive bit = 'true',
@ExternalKeyID int,
@FirstName nvarchar(50),
@LastName nvarchar(50),
@Company nvarchar(100),
@Title nvarchar(50),
@Occupation nvarchar(50),
@AddressTypeID int,
@Address1 nvarchar(100),
@Address2 nvarchar(100),
@Address3 nvarchar(100),
@City nvarchar(50),
@RegionCode nvarchar(50),
@RegionID int,
@ZipCode nvarchar(50),
@Plus4 nchar(10),
@CarrierRoute varchar(10),
@County nvarchar(50),
@Country nvarchar(50),
@CountryID int,
@Latitude decimal(18,15),
@Longitude decimal(18,15),
@IsAddressValidated bit,
@AddressValidationDate datetime,
@AddressValidationSource nvarchar(50),
@AddressValidationMessage nvarchar(max),
@Email nvarchar(100),
@Phone nchar(10),
@Fax nchar(10),
@Mobile nchar(10),
@Website nvarchar(100),
@Birthdate date,
@Age int,
@Income nvarchar(50),
@Gender nvarchar(50),
@SubscriberDateCreated datetime,
@SubscriberDateUpdated datetime,
@SubscriberCreatedByUserID int,
@SubscriberUpdatedByUserID int,
@DateCreated datetime,
@CreatedByUserID int,
@IsLocked bit,
@LockDate DATETIME = '',
@LockDateRelease datetime = '',
@LockedByUserID	int = '',
@PhoneExt varchar(25)='',
@IsUadUpdated bit,
@UadUpdatedDate datetime =''
AS

IF @HistorySubscriptionID > 0
	BEGIN		
		UPDATE HistorySubscription
		SET 
			SubscriptionID = @SubscriptionID,
			PublisherID = @PublisherID,
			SubscriberID = @SubscriberID,
			PublicationID = @PublicationID,
			ActionID_Current = @ActionID_Current,
			ActionID_Previous = @ActionID_Previous,
			SubscriptionStatusID = @SubscriptionStatusID,
			IsPaid = @IsPaid,
			QSourceID = @QSourceID,
			QSourceDate = @QSourceDate,
			DeliverabilityID = @DeliverabilityID,
			IsSubscribed = @IsSubscribed,
			SubscriberSourceCode = @SubscriberSourceCode,
			Copies = @Copies,
			OriginalSubscriberSourceCode = @OriginalSubscriberSourceCode,
			SubscriptionDateCreated = @SubscriptionDateCreated,
			SubscriptionDateUpdated = @SubscriptionDateUpdated,
			SubscriptionCreatedByUserID = @SubscriptionCreatedByUserID,
			SubscriptionUpdatedByUserID = @SubscriptionUpdatedByUserID,
			AccountNumber =	AccountNumber,
			GraceIssues = GraceIssues,
			IsNewSubscription = IsNewSubscription, 
			MemberGroup = MemberGroup,
			OnBehalfOf = OnBehalfOf,
			Par3cID = @Par3cID,
			SequenceID = SequenceID,
			SubsrcTypeID = SubsrcTypeID,
			Verify = Verify,
			IsActive = @IsActive,
			ExternalKeyID = @ExternalKeyID,
			FirstName = @FirstName,
			LastName = @LastName,
			Company = @Company,
			Title = @Title,
			Occupation = @Occupation,
			AddressTypeID = @AddressTypeID,
			Address1 = @Address1,
			Address2 = @Address2,
			Address3 = @Address3,
			City = @City,
			RegionCode = @RegionCode,
			RegionID = @RegionID,
			ZipCode = @ZipCode,
			Plus4 = @Plus4,
			CarrierRoute = @CarrierRoute,
			County = @County,
			Country = @Country,
			CountryID = @CountryID,
			Latitude = @Latitude,
			Longitude = @Longitude,
			IsAddressValidated = @IsAddressValidated,
			AddressValidationDate = @AddressValidationDate,
			AddressValidationSource = @AddressValidationSource,
			AddressValidationMessage = @AddressValidationMessage,
			Email = @Email,
			Phone = @Phone,
			Fax = @Fax,
			Mobile = @Mobile,
			Website = @Website,
			Birthdate = @Birthdate, 
			Age = @Age,
			Income = @Income,
			Gender = @Gender,
			SubscriberDateCreated = @SubscriberDateCreated,
			SubscriberDateUpdated = @SubscriberDateUpdated,
			SubscriberCreatedByUserID = @SubscriberCreatedByUserID,
			SubscriberUpdatedByUserID = @SubscriberUpdatedByUserID,
			IsLocked = IsLocked,
			LockDate  = @LockDate,
			LockDateRelease = LockDateRelease,
			LockedByUserID= @LockedByUserID,
			PhoneExt = @PhoneExt,
			IsUadUpdated = @IsUadUpdated,
			UadUpdatedDate = @UadUpdatedDate
		WHERE HistorySubscriptionID = @HistorySubscriptionID;
		
		SELECT @HistorySubscriptionID;
	END
ELSE
	BEGIN
		IF @DateCreated IS NULL
			BEGIN
				SET @DateCreated = GETDATE();
			END
		INSERT INTO HistorySubscription (SubscriptionID,PublisherID,SubscriberID,PublicationID,ActionID_Current,ActionID_Previous,SubscriptionStatusID,IsPaid,QSourceID,QSourceDate,DeliverabilityID,IsSubscribed,SubscriberSourceCode,Copies,OriginalSubscriberSourceCode,SubscriptionDateCreated,
										 SubscriptionDateUpdated,SubscriptionCreatedByUserID,SubscriptionUpdatedByUserID,AccountNumber,GraceIssues,IsNewSubscription,MemberGroup,OnBehalfOf,Par3cID,SequenceID,SubsrcTypeID,Verify,IsActive,ExternalKeyID,FirstName,LastName,Company,
										 Title,Occupation,AddressTypeID,Address1,Address2,Address3,City,RegionCode,RegionID,ZipCode,Plus4,CarrierRoute,County,Country,CountryID,Latitude,Longitude,IsAddressValidated,
										 AddressValidationDate,AddressValidationSource,AddressValidationMessage,Email,Phone,Fax,Mobile,Website,Birthdate,Age,Income,Gender,SubscriberDateCreated,
										 SubscriberDateUpdated,SubscriberCreatedByUserID,SubscriberUpdatedByUserID,DateCreated,CreatedByUserID,IsLocked,LockDate,LockDateRelease,LockedByUserID,PhoneExt,IsUadUpdated,UadUpdatedDate)
										 
		VALUES(@SubscriptionID,@PublisherID,@SubscriberID,@PublicationID,@ActionID_Current,@ActionID_Previous,@SubscriptionStatusID,@IsPaid,@QSourceID,@QSourceDate,@DeliverabilityID,@IsSubscribed,@SubscriberSourceCode,@Copies,@OriginalSubscriberSourceCode,@SubscriptionDateCreated,
			   @SubscriptionDateUpdated,@SubscriptionCreatedByUserID,@SubscriptionUpdatedByUserID,@AccountNumber,@GraceIssues,@IsNewSubscription,@MemberGroup,@OnBehalfOf,@Par3cID,@SequenceID,@SubsrcTypeID,@Verify,@IsActive,@ExternalKeyID,@FirstName,@LastName,@Company,
			   @Title,@Occupation,@AddressTypeID,@Address1,@Address2,@Address3,@City,@RegionCode,@RegionID,@ZipCode,@Plus4,@CarrierRoute,@County,@Country,@CountryID,@Latitude,@Longitude,@IsAddressValidated,
			   @AddressValidationDate,@AddressValidationSource,@AddressValidationMessage,@Email,@Phone,@Fax,@Mobile,@Website,@Birthdate,@Age,@Income,@Gender,@SubscriberDateCreated,
			   @SubscriberDateUpdated,@SubscriberCreatedByUserID,@SubscriberUpdatedByUserID,@DateCreated,@CreatedByUserID,@IsLocked,@LockDate,@LockDateRelease,@LockedByUserID,@PhoneExt,@IsUadUpdated,@UadUpdatedDate);SELECT @@IDENTITY;
	END
