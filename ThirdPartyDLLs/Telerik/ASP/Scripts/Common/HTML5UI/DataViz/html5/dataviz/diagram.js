(function(b,a){a("util/main",["kendo.core"],b);
}(function(){(function(){var q=Math,n=window.kendo,f=n.deepExtend;
var i=q.PI/180,r=Number.MAX_VALUE,u=-Number.MAX_VALUE,N="undefined";
function g(P){return typeof P!==N;
}function G(R,Q){var P=x(Q);
return q.round(R*P)/P;
}function x(P){if(P){return q.pow(10,P);
}else{return 1;
}}function p(R,Q,P){return q.max(q.min(R,P),Q);
}function y(P){return P*i;
}function h(P){return P/i;
}function l(P){return typeof P==="number"&&!isNaN(P);
}function O(Q,P){return g(Q)?Q:P;
}function K(P){return P*P;
}function w(Q){var R=[];
for(var P in Q){R.push(P+Q[P]);
}return R.sort().join("");
}function j(R){var P=2166136261;
for(var Q=0;
Q<R.length;
++Q){P+=(P<<1)+(P<<4)+(P<<7)+(P<<8)+(P<<24);
P^=R.charCodeAt(Q);
}return P>>>0;
}function k(P){return j(w(P));
}var v=Date.now;
if(!v){v=function(){return new Date().getTime();
};
}function c(P){var R=P.length,Q,T=r,S=u;
for(Q=0;
Q<R;
Q++){S=q.max(S,P[Q]);
T=q.min(T,P[Q]);
}return{min:T,max:S};
}function e(P){return c(P).min;
}function d(P){return c(P).max;
}function J(P){return H(P).min;
}function I(P){return H(P).max;
}function H(P){var T=r,S=u;
for(var Q=0,R=P.length;
Q<R;
Q++){var U=P[Q];
if(U!==null&&isFinite(U)){T=q.min(T,U);
S=q.max(S,U);
}}return{min:T===r?undefined:T,max:S===u?undefined:S};
}function o(P){if(P){return P[P.length-1];
}}function a(P,Q){P.push.apply(P,Q);
return P;
}function E(P){return n.template(P,{useWithBlock:false,paramName:"d"});
}function A(P,Q){return g(Q)&&Q!==null?" "+P+"='"+Q+"' ":"";
}function z(P){var R="";
for(var Q=0;
Q<P.length;
Q++){R+=A(P[Q][0],P[Q][1]);
}return R;
}function D(P){var R="";
for(var Q=0;
Q<P.length;
Q++){var S=P[Q][1];
if(g(S)){R+=P[Q][0]+":"+S+";";
}}if(R!==""){return R;
}}function C(P){if(typeof P!=="string"){P+="px";
}return P;
}function B(R){var S=[];
if(R){var Q=n.toHyphens(R).split("-");
for(var P=0;
P<Q.length;
P++){S.push("k-pos-"+Q[P]);
}}return S.join(" ");
}function m(P){return P===""||P===null||P==="none"||P==="transparent"||!g(P);
}function b(Q){var P={1:"i",10:"x",100:"c",2:"ii",20:"xx",200:"cc",3:"iii",30:"xxx",300:"ccc",4:"iv",40:"xl",400:"cd",5:"v",50:"l",500:"d",6:"vi",60:"lx",600:"dc",7:"vii",70:"lxx",700:"dcc",8:"viii",80:"lxxx",800:"dccc",9:"ix",90:"xc",900:"cm",1000:"m"};
var S=[1000,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1];
var R="";
while(Q>0){if(Q<S[0]){S.shift();
}else{R+=P[S[0]];
Q-=S[0];
}}return R;
}function F(S){S=S.toLowerCase();
var P={i:1,v:5,x:10,l:50,c:100,d:500,m:1000};
var U=0,R=0;
for(var Q=0;
Q<S.length;
++Q){var T=P[S.charAt(Q)];
if(!T){return null;
}U+=T;
if(T>R){U-=2*R;
}R=T;
}return U;
}function s(Q){var P=Object.create(null);
return function(){var S="";
for(var R=arguments.length;
--R>=0;
){S+=":"+arguments[R];
}if(S in P){return P[S];
}return Q.apply(this,arguments);
};
}function L(T){var S=[],P=0,R=T.length,U,Q;
while(P<R){U=T.charCodeAt(P++);
if(U>=55296&&U<=56319&&P<R){Q=T.charCodeAt(P++);
if((Q&64512)==56320){S.push(((U&1023)<<10)+(Q&1023)+65536);
}else{S.push(U);
P--;
}}else{S.push(U);
}}return S;
}function M(P){return P.map(function(R){var Q="";
if(R>65535){R-=65536;
Q+=String.fromCharCode(R>>>10&1023|55296);
R=56320|R&1023;
}Q+=String.fromCharCode(R);
return Q;
}).join("");
}function t(P,Q){if(P.length<2){return P.slice();
}function R(T,V){var Y=[],U=0,W=0,X=0;
while(U<T.length&&W<V.length){if(Q(T[U],V[W])<=0){Y[X++]=T[U++];
}else{Y[X++]=V[W++];
}}if(U<T.length){Y.push.apply(Y,T.slice(U));
}if(W<V.length){Y.push.apply(Y,V.slice(W));
}return Y;
}return function S(T){if(T.length<=1){return T;
}var V=Math.floor(T.length/2);
var U=T.slice(0,V);
var W=T.slice(V);
U=S(U);
W=S(W);
return R(U,W);
}(P);
}f(n,{util:{MAX_NUM:r,MIN_NUM:u,append:a,arrayLimits:c,arrayMin:e,arrayMax:d,defined:g,deg:h,hashKey:j,hashObject:k,isNumber:l,isTransparent:m,last:o,limitValue:p,now:v,objectKey:w,round:G,rad:y,renderAttr:A,renderAllAttr:z,renderPos:B,renderSize:C,renderStyle:D,renderTemplate:E,sparseArrayLimits:H,sparseArrayMin:J,sparseArrayMax:I,sqr:K,valueOrDefault:O,romanToArabic:F,arabicToRoman:b,memoize:s,ucs2encode:M,ucs2decode:L,mergeSort:t}});
n.drawing.util=n.util;
n.dataviz.util=n.util;
}());
return window.kendo;
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("util/text-metrics",["kendo.core","util/main"],b);
}(function(){(function(a){var e=document,f=window.kendo,b=f.Class,k=f.util,d=k.defined;
var h=b.extend({init:function(m){this._size=m;
this._length=0;
this._map={};
},put:function(n,q){var o=this,p=o._map,m={key:n,value:q};
p[n]=m;
if(!o._head){o._head=o._tail=m;
}else{o._tail.newer=m;
m.older=o._tail;
o._tail=m;
}if(o._length>=o._size){p[o._head.key]=null;
o._head=o._head.newer;
o._head.older=null;
}else{o._length++;
}},get:function(n){var o=this,m=o._map[n];
if(m){if(m===o._head&&m!==o._tail){o._head=m.newer;
o._head.older=null;
}if(m!==o._tail){if(m.older){m.older.newer=m.newer;
m.newer.older=m.older;
}m.older=o._tail;
m.newer=null;
o._tail.newer=m;
o._tail=m;
}return m.value;
}}});
var c=a("<div style='position: absolute !important; top: -4000px !important; width: auto !important; height: auto !important;padding: 0 !important; margin: 0 !important; border: 0 !important;line-height: normal !important; visibility: hidden !important; white-space: nowrap!important;' />")[0];
function l(){return{width:0,height:0,baseline:0};
}var j=b.extend({init:function(m){this._cache=new h(1000);
this._initOptions(m);
},options:{baselineMarkerSize:1},measure:function(v,t,n){if(!v){return l();
}var u=k.objectKey(t),p=k.hashKey(v+u),o=this._cache.get(p);
if(o){return o;
}var s=l();
var r=n?n:c;
var m=this._baselineMarker().cloneNode(false);
for(var q in t){var w=t[q];
if(d(w)){r.style[q]=w;
}}a(r).text(v);
r.appendChild(m);
e.body.appendChild(r);
if((v+"").length){s.width=r.offsetWidth-this.options.baselineMarkerSize;
s.height=r.offsetHeight;
s.baseline=m.offsetTop+this.options.baselineMarkerSize;
}if(s.width>0&&s.height>0){this._cache.put(p,s);
}r.parentNode.removeChild(r);
return s;
},_baselineMarker:function(){return a("<div class='k-baseline-marker' style='display: inline-block; vertical-align: baseline;width: "+this.options.baselineMarkerSize+"px; height: "+this.options.baselineMarkerSize+"px;overflow: hidden;' />")[0];
}});
j.current=new j();
function i(o,n,m){return j.current.measure(o,n,m);
}function g(o,m){var p=[];
if(o.length>0&&document.fonts){try{p=o.map(function(q){return document.fonts.load(q);
});
}catch(n){f.logToConsole(n);
}Promise.all(p).then(m,m);
}else{m();
}}f.util.TextMetrics=j;
f.util.LRUCache=h;
f.util.loadFonts=g;
f.util.measureText=i;
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("util/base64",["util/main"],b);
}(function(){(function(){var e=window.kendo,a=e.deepExtend,d=String.fromCharCode;
var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
function b(p){var q="";
var g,h,j,k,l,m,n;
var o=0;
p=c(p);
while(o<p.length){g=p.charCodeAt(o++);
h=p.charCodeAt(o++);
j=p.charCodeAt(o++);
k=g>>2;
l=(g&3)<<4|h>>4;
m=(h&15)<<2|j>>6;
n=j&63;
if(isNaN(h)){m=n=64;
}else{if(isNaN(j)){n=64;
}}q=q+f.charAt(k)+f.charAt(l)+f.charAt(m)+f.charAt(n);
}return q;
}function c(j){var k="";
for(var h=0;
h<j.length;
h++){var g=j.charCodeAt(h);
if(g<128){k+=d(g);
}else{if(g<2048){k+=d(192|g>>>6);
k+=d(128|g&63);
}else{if(g<65536){k+=d(224|g>>>12);
k+=d(128|g>>>6&63);
k+=d(128|g&63);
}}}}return k;
}a(e.util,{encodeBase64:b,encodeUTF8:c});
}());
return window.kendo;
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("mixins/observers",["kendo.core"],b);
}(function(){(function(a){var e=Math,d=window.kendo,b=d.deepExtend,c=a.inArray;
var f={observers:function(){this._observers=this._observers||[];
return this._observers;
},addObserver:function(g){if(!this._observers){this._observers=[g];
}else{this._observers.push(g);
}return this;
},removeObserver:function(g){var i=this.observers();
var h=c(g,i);
if(h!=-1){i.splice(h,1);
}return this;
},trigger:function(i,g){var k=this._observers;
var j;
var h;
if(k&&!this._suspended){for(h=0;
h<k.length;
h++){j=k[h];
if(j[i]){j[i](g);
}}}return this;
},optionsChange:function(g){g=g||{};
g.element=this;
this.trigger("optionsChange",g);
},geometryChange:function(){this.trigger("geometryChange",{element:this});
},suspend:function(){this._suspended=(this._suspended||0)+1;
return this;
},resume:function(){this._suspended=e.max((this._suspended||0)-1,0);
return this;
},_observerField:function(g,h){if(this[g]){this[g].removeObserver(this);
}this[g]=h;
h.addObserver(this);
}};
b(d,{mixins:{ObserversMixin:f}});
}(window.kendo.jQuery));
return window.kendo;
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("dataviz/diagram/utils",["kendo.core"],b);
}(function(){(function(a,l){var i=window.kendo,d=i.dataviz.diagram={},c=i.deepExtend,h=a.isArray,f=1e-06;
var m={};
c(m,{isNearZero:function(n){return Math.abs(n)<f;
},isDefined:function(n){return typeof n!=="undefined";
},isUndefined:function(n){return typeof n==="undefined"||n===null;
},isObject:function(n){return n===Object(n);
},has:function(o,n){return Object.hasOwnProperty.call(o,n);
},isString:function(n){return Object.prototype.toString.call(n)=="[object String]";
},isBoolean:function(n){return Object.prototype.toString.call(n)=="[object Boolean]";
},isType:function(n,o){return Object.prototype.toString.call(n)=="[object "+o+"]";
},isNumber:function(n){return !isNaN(parseFloat(n))&&isFinite(n);
},isEmpty:function(o){if(o===null){return true;
}if(h(o)||m.isString(o)){return o.length===0;
}for(var n in o){if(m.has(o,n)){return false;
}}return true;
},simpleExtend:function(n,p){if(!m.isObject(p)){return;
}for(var o in p){n[o]=p[o];
}},initArray:function b(p,q){var n=[];
for(var o=0;
o<p;
++o){n[o]=q;
}return n;
},serializePoints:function(q){var r=[];
for(var n=0;
n<q.length;
n++){var o=q[n];
r.push(o.x+";"+o.y);
}return r.join(";");
},deserializePoints:function(p){var q=p.split(";"),o=[];
if(q.length%2!==0){throw"Not an array of points.";
}for(var n=0;
n<q.length;
n+=2){o.push(new d.Point(parseInt(q[n],10),parseInt(q[n+1],10)));
}return o;
},randomInteger:function(n,o){return parseInt(Math.floor(Math.random()*o)+n,10);
},DFT:function(n,o){o(n);
if(n.childNodes){for(var p=0;
p<n.childNodes.length;
p++){var q=n.childNodes[p];
this.DFT(q,o);
}}},getMatrixAngle:function(n){if(n===null||n.d===0){return 0;
}return Math.atan2(n.b,n.d)*180/Math.PI;
},getMatrixScaling:function(n){var o=Math.sqrt(n.a*n.a+n.c*n.c);
var p=Math.sqrt(n.b*n.b+n.d*n.d);
return[o,p];
}});
function j(s,u,t){if(typeof s=="undefined"||typeof u=="undefined"){return[];
}if(t&&m.sign(u-s)!=m.sign(t)){throw"The sign of the increment should allow to reach the stop-value.";
}t=t||1;
s=s||0;
u=u||s;
if((u-s)/t===Infinity){throw"Infinite range defined.";
}var q=[],n=-1,o;
function r(w){var v=1;
while(w*v%1){v*=10;
}return v;
}var p=r(Math.abs(t));
s*=p;
u*=p;
t*=p;
if(s>u&&t>0){t=-t;
}if(t<0){while((o=s+t*++n)>=u){q.push(o/p);
}}else{while((o=s+t*++n)<=u){q.push(o/p);
}}return q;
}function g(r,o){if(r==o){return 0;
}var p=o.x-r.x,q=r.y-o.y,n=Math.atan(p/q);
if(q>=0){return p<0?n+2*Math.PI:n;
}return n+Math.PI;
}m.sign=function(n){return n?n<0?-1:1:0;
};
m.findAngle=function(n,o){return g(n,o)*180/Math.PI;
};
m.forEach=function(n,p,q){for(var o=0;
o<n.length;
o++){p.call(q,n[o],o,n);
}};
m.any=function(n,p){for(var o=0;
o<n.length;
++o){if(p(n[o])){return n[o];
}}return null;
};
m.remove=function(n,p){var o;
while((o=m.indexOf(n,p))!==-1){n.splice(o,1);
}return n;
};
m.contains=function(n,o){return m.indexOf(n,o)!==-1;
};
m.indexOf=function(n,o){return a.inArray(o,n);
};
m.fold=function(s,r,n,o){var q=arguments.length>2;
for(var p=0;
p<s.length;
p++){var t=s[p];
if(!q){n=t;
q=true;
}else{n=r.call(o,n,t,p,s);
}}if(!q){throw"Reduce of empty array with no initial value";
}return n;
};
m.find=function(n,p,o){var q;
m.any(n,function(t,r,s){if(p.call(o,t,r,s)){q=t;
return true;
}return false;
});
return q;
};
m.first=function(n,o,p){if(n.length===0){return null;
}if(m.isUndefined(o)){return n[0];
}return m.find(n,o,p);
};
m.insert=function(n,o,p){n.splice(p,0,o);
return n;
};
m.all=function(n,q,o){var r=true;
var s;
for(var p=0;
p<n.length;
p++){s=n[p];
r=r&&q.call(o,s,p,n);
if(!r){break;
}}return r;
};
m.clear=function(n){n.splice(0,n.length);
};
m.bisort=function(n,p,r){if(m.isUndefined(n)){throw"First array is not specified.";
}if(m.isUndefined(p)){throw"Second array is not specified.";
}if(n.length!=p.length){throw"The two arrays should have equal length";
}var o=[],q;
for(q=0;
q<n.length;
q++){o.push({x:n[q],y:p[q]});
}if(m.isUndefined(r)){o.sort(function(s,t){return s.x-t.x;
});
}else{o.sort(function(s,t){return r(s.x,t.x);
});
}m.clear(n);
m.clear(p);
for(q=0;
q<o.length;
q++){n.push(o[q].x);
p.push(o[q].y);
}};
m.addRange=function(n,o){n.push.apply(n,o);
};
var e={easeInOut:function(n){return -Math.cos(n*Math.PI)/2+0.5;
}};
var k=i.Class.extend({init:function(){this.adapters=[];
this.target=0;
this.tick=0;
this.interval=20;
this.duration=800;
this.lastTime=null;
this.handlers=[];
var n=this;
this.transition=e.easeInOut;
this.timerDelegate=function(){n.onTimerEvent();
};
},addAdapter:function(n){this.adapters.push(n);
},onComplete:function(n){this.handlers.push(n);
},removeHandler:function(n){this.handlers=a.grep(this.handlers,function(o){return o!==n;
});
},trigger:function(){var n=this;
if(this.handlers){m.forEach(this.handlers,function(o){return o.call(n.caller!==null?n.caller:n);
});
}},onStep:function(){},seekTo:function(n){this.seekFromTo(this.tick,n);
},seekFromTo:function(n,o){this.target=Math.max(0,Math.min(1,o));
this.tick=Math.max(0,Math.min(1,n));
this.lastTime=new Date().getTime();
if(!this.intervalId){this.intervalId=window.setInterval(this.timerDelegate,this.interval);
}},stop:function(){if(this.intervalId){window.clearInterval(this.intervalId);
this.intervalId=null;
this.trigger();
}},play:function(n){if(this.adapters.length===0){return;
}if(n!==null){this.caller=n;
}this.initState();
this.seekFromTo(0,1);
},reverse:function(){this.seekFromTo(1,0);
},initState:function(){if(this.adapters.length===0){return;
}for(var n=0;
n<this.adapters.length;
n++){this.adapters[n].initState();
}},propagate:function(){var o=this.transition(this.tick);
for(var n=0;
n<this.adapters.length;
n++){this.adapters[n].update(o);
}},onTimerEvent:function(){var o=new Date().getTime();
var p=o-this.lastTime;
this.lastTime=o;
var n=p/this.duration*(this.tick<this.target?1:-1);
if(Math.abs(n)>=Math.abs(this.tick-this.target)){this.tick=this.target;
}else{this.tick+=n;
}try{this.propagate();
}finally{this.onStep.call(this);
if(this.target==this.tick){this.stop();
}}}});
i.deepExtend(d,{init:function(n){i.init(n,d.ui);
},Utils:m,Range:j,Ticker:k});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("dataviz/diagram/math",["dataviz/diagram/utils","kendo.dataviz.core"],b);
}(function(){(function(a,I){var r=window.kendo,f=r.dataviz.diagram,b=r.Class,e=r.deepExtend,d=r.dataviz,J=f.Utils,A=d.Point2D,p=r.isFunction,c=J.contains,t=a.map;
var m=3,h=1e-06;
e(A.fn,{plus:function(K){return new A(this.x+K.x,this.y+K.y);
},minus:function(K){return new A(this.x-K.x,this.y-K.y);
},offset:function(K){return new A(this.x-K,this.y-K);
},times:function(K){return new A(this.x*K,this.y*K);
},normalize:function(){if(this.length()===0){return new A();
}return this.times(1/this.length());
},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y);
},toString:function(){return"("+this.x+","+this.y+")";
},lengthSquared:function(){return this.x*this.x+this.y*this.y;
},middleOf:function w(K,L){return new A(L.x-K.x,L.y-K.y).times(0.5).plus(K);
},toPolar:function(O){var L=1;
if(O){L=180/Math.PI;
}var K=Math.atan2(Math.abs(this.y),Math.abs(this.x));
var M=Math.PI/2;
var N=this.length();
if(this.x===0){if(this.y===0){return new B(0,0);
}if(this.y>0){return new B(N,L*M);
}if(this.y<0){return new B(N,L*3*M);
}}else{if(this.x>0){if(this.y===0){return new B(N,0);
}if(this.y>0){return new B(N,L*K);
}if(this.y<0){return new B(N,L*(4*M-K));
}}else{if(this.y===0){return new B(N,2*M);
}if(this.y>0){return new B(N,L*(2*M-K));
}if(this.y<0){return new B(N,L*(2*M+K));
}}}},isOnLine:function(K,P){if(K.x>P.x){var O=P;
P=K;
K=O;
}var M=new E(K.x,K.y).inflate(m,m),N=new E(P.x,P.y).inflate(m,m),L,Q;
if(M.union(N).contains(this)){if(K.x===P.x||K.y===P.y){return true;
}else{if(K.y<P.y){L=M.x+(N.x-M.x)*(this.y-(M.y+M.height))/(N.y+N.height-(M.y+M.height));
Q=M.x+M.width+(N.x+N.width-(M.x+M.width))*(this.y-M.y)/(N.y-M.y);
}else{L=M.x+(N.x-M.x)*(this.y-M.y)/(N.y-M.y);
Q=M.x+M.width+(N.x+N.width-(M.x+M.width))*(this.y-(M.y+M.height))/(N.y+N.height-(M.y+M.height));
}}return this.x>L&&this.x<Q;
}return false;
}});
e(A,{parse:function(K){var L=K.slice(1,K.length-1),N=L.split(","),M=parseInt(N[0],10),O=parseInt(N[1],10);
if(!isNaN(M)&&!isNaN(O)){return new A(M,O);
}}});
var z=b.extend({init:function(L,K,M){this.point=L;
this.left=K;
this.right=M;
}});
var E=b.extend({init:function(M,N,L,K){this.x=M||0;
this.y=N||0;
this.width=L||0;
this.height=K||0;
},contains:function(K){return K.x>=this.x&&K.x<=this.x+this.width&&K.y>=this.y&&K.y<=this.y+this.height;
},inflate:function(K,L){if(L===I){L=K;
}this.x-=K;
this.y-=L;
this.width+=2*K+1;
this.height+=2*L+1;
return this;
},offset:function(K,L){var M=K,N=L;
if(K instanceof A){M=K.x;
N=K.y;
}this.x+=M;
this.y+=N;
return this;
},union:function(K){var L=Math.min(this.x,K.x);
var N=Math.min(this.y,K.y);
var M=Math.max(this.x+this.width,K.x+K.width);
var O=Math.max(this.y+this.height,K.y+K.height);
return new E(L,N,M-L,O-N);
},center:function(){return new A(this.x+this.width/2,this.y+this.height/2);
},top:function(){return new A(this.x+this.width/2,this.y);
},right:function(){return new A(this.x+this.width,this.y+this.height/2);
},bottom:function(){return new A(this.x+this.width/2,this.y+this.height);
},left:function(){return new A(this.x,this.y+this.height/2);
},topLeft:function(){return new A(this.x,this.y);
},topRight:function(){return new A(this.x+this.width,this.y);
},bottomLeft:function(){return new A(this.x,this.y+this.height);
},bottomRight:function(){return new A(this.x+this.width,this.y+this.height);
},clone:function(){return new E(this.x,this.y,this.width,this.height);
},isEmpty:function(){return !this.width&&!this.height;
},equals:function(K){return this.x===K.x&&this.y===K.y&&this.width===K.width&&this.height===K.height;
},rotatedBounds:function(K){var O=this.clone(),N=this.rotatedPoints(K),P=N[0],Q=N[1],M=N[2],L=N[3];
O.x=Math.min(M.x,P.x,Q.x,L.x);
O.y=Math.min(M.y,P.y,Q.y,L.y);
O.width=Math.max(M.x,P.x,Q.x,L.x)-O.x;
O.height=Math.max(M.y,P.y,Q.y,L.y)-O.y;
return O;
},rotatedPoints:function(K){var O=this,N=O.center(),M=O.bottomRight().rotate(N,360-K),P=O.topLeft().rotate(N,360-K),Q=O.topRight().rotate(N,360-K),L=O.bottomLeft().rotate(N,360-K);
return[P,Q,M,L];
},toString:function(K){K=K||" ";
return this.x+K+this.y+K+this.width+K+this.height;
},scale:function(P,Q,R,K,L){var T=this.topLeft();
var S=this.center();
T.rotate(S,360-L).rotate(K,L);
var M=R.minus(T);
var O=new A(M.x*P,M.y*Q);
var N=M.minus(O);
T=T.plus(N);
T.rotate(K,360-L).rotate(S,L);
this.x=T.x;
this.y=T.y;
this.width*=P;
this.height*=Q;
},zoom:function(K){this.x*=K;
this.y*=K;
this.width*=K;
this.height*=K;
return this;
},overlaps:function(M){var K=this.bottomRight();
var N=M.bottomRight();
var L=!(K.x<M.x||K.y<M.y||N.x<this.x||N.y<this.y);
return L;
}});
var H=b.extend({init:function(L,K){this.width=L;
this.height=K;
}});
H.prototype.Empty=new H(0,0);
E.toRect=function(K){if(!(K instanceof E)){K=new E(K.x,K.y,K.width,K.height);
}return K;
};
E.empty=function(){return new E(0,0,0,0);
};
E.fromPoints=function(K,L){if(isNaN(K.x)||isNaN(K.y)||isNaN(L.x)||isNaN(L.y)){throw"Some values are NaN.";
}return new E(Math.min(K.x,L.x),Math.min(K.y,L.y),Math.abs(K.x-L.x),Math.abs(K.y-L.y));
};
function q(K){return Math.abs(K)<h;
}function o(R,K,S,L,M){var T=(K.x-R.x)*(L.y-S.y)-(K.y-R.y)*(L.x-S.x);
if(q(T)){return;
}var N=(R.y-S.y)*(L.x-S.x)-(R.x-S.x)*(L.y-S.y);
var O=(R.y-S.y)*(K.x-R.x)-(R.x-S.x)*(K.y-R.y);
var P=N/T;
var Q=O/T;
if(M&&(P<0||P>1||Q<0||Q>1)){return;
}return new A(R.x+P*(K.x-R.x),R.y+P*(K.y-R.y));
}var n={lines:function(M,K,N,L){return o(M,K,N,L);
},segments:function(M,K,N,L){return o(M,K,N,L,true);
},rectWithLine:function(L,M,K){return n.segments(M,K,L.topLeft(),L.topRight())||n.segments(M,K,L.topRight(),L.bottomRight())||n.segments(M,K,L.bottomLeft(),L.bottomRight())||n.segments(M,K,L.topLeft(),L.bottomLeft());
},rects:function(P,Q,K){var S=Q.topLeft(),T=Q.topRight(),L=Q.bottomLeft(),M=Q.bottomRight();
var N=Q.center();
if(K){S=S.rotate(N,K);
T=T.rotate(N,K);
L=L.rotate(N,K);
M=M.rotate(N,K);
}var O=P.contains(S)||P.contains(T)||P.contains(L)||P.contains(M)||n.rectWithLine(P,S,T)||n.rectWithLine(P,S,L)||n.rectWithLine(P,T,M)||n.rectWithLine(P,L,M);
if(!O){S=P.topLeft();
T=P.topRight();
L=P.bottomLeft();
M=P.bottomRight();
if(K){var R=360-K;
S=S.rotate(N,R);
T=T.rotate(N,R);
L=L.rotate(N,R);
M=M.rotate(N,R);
}O=Q.contains(S)||Q.contains(T)||Q.contains(L)||Q.contains(M);
}return O;
}};
var F=b.extend({init:function(K){this.container=E.toRect(K);
},align:function(M,K){var L=K.toLowerCase().split(" ");
for(var N=0;
N<L.length;
N++){M=this._singleAlign(M,L[N]);
}return M;
},_singleAlign:function(L,K){if(p(this[K])){return this[K](L);
}else{return L;
}},left:function(K){return this._align(K,this._left);
},center:function(K){return this._align(K,this._center);
},right:function(K){return this._align(K,this._right);
},stretch:function(K){return this._align(K,this._stretch);
},top:function(K){return this._align(K,this._top);
},middle:function(K){return this._align(K,this._middle);
},bottom:function(K){return this._align(K,this._bottom);
},_left:function(K,L){L.x=K.x;
},_center:function(K,L){L.x=(K.width-L.width)/2||0;
},_right:function(K,L){L.x=K.width-L.width;
},_top:function(K,L){L.y=K.y;
},_middle:function(K,L){L.y=(K.height-L.height)/2||0;
},_bottom:function(K,L){L.y=K.height-L.height;
},_stretch:function(K,L){L.x=0;
L.y=0;
L.height=K.height;
L.width=K.width;
},_align:function(L,K){L=E.toRect(L);
K(this.container,L);
return L;
}});
var B=b.extend({init:function(L,K){this.r=L;
this.angle=K;
}});
var u=b.extend({init:function(K,L,M,N,O,P){this.a=K||0;
this.b=L||0;
this.c=M||0;
this.d=N||0;
this.e=O||0;
this.f=P||0;
},plus:function(K){this.a+=K.a;
this.b+=K.b;
this.c+=K.c;
this.d+=K.d;
this.e+=K.e;
this.f+=K.f;
},minus:function(K){this.a-=K.a;
this.b-=K.b;
this.c-=K.c;
this.d-=K.d;
this.e-=K.e;
this.f-=K.f;
},times:function(K){return new u(this.a*K.a+this.c*K.b,this.b*K.a+this.d*K.b,this.a*K.c+this.c*K.d,this.b*K.c+this.d*K.d,this.a*K.e+this.c*K.f+this.e,this.b*K.e+this.d*K.f+this.f);
},apply:function(K){return new A(this.a*K.x+this.c*K.y+this.e,this.b*K.x+this.d*K.y+this.f);
},applyRect:function(K){return E.fromPoints(this.apply(K.topLeft()),this.apply(K.bottomRight()));
},toString:function(){return"matrix("+this.a+" "+this.b+" "+this.c+" "+this.d+" "+this.e+" "+this.f+")";
}});
e(u,{fromSVGMatrix:function(L){var K=new u();
K.a=L.a;
K.b=L.b;
K.c=L.c;
K.d=L.d;
K.e=L.e;
K.f=L.f;
return K;
},fromMatrixVector:function(L){var K=new u();
K.a=L.a;
K.b=L.b;
K.c=L.c;
K.d=L.d;
K.e=L.e;
K.f=L.f;
return K;
},fromList:function(L){if(L.length!==6){throw"The given list should consist of six elements.";
}var K=new u();
K.a=L[0];
K.b=L[1];
K.c=L[2];
K.d=L[3];
K.e=L[4];
K.f=L[5];
return K;
},translation:function(L,M){var K=new u();
K.a=1;
K.b=0;
K.c=0;
K.d=1;
K.e=L;
K.f=M;
return K;
},unit:function(){return new u(1,0,0,1,0,0);
},rotation:function(K,M,N){var L=new u();
L.a=Math.cos(K*Math.PI/180);
L.b=Math.sin(K*Math.PI/180);
L.c=-L.b;
L.d=L.a;
L.e=M-M*L.a+N*L.b||0;
L.f=N-N*L.a-M*L.b||0;
return L;
},scaling:function(L,M){var K=new u();
K.a=L;
K.b=0;
K.c=0;
K.d=M;
K.e=0;
K.f=0;
return K;
},parse:function(M){var L,K;
if(M){M=M.trim();
if(M.slice(0,6).toLowerCase()==="matrix"){K=M.slice(7,M.length-1).trim();
L=K.split(",");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}L=K.split(" ");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}}if(M.slice(0,1)==="("&&M.slice(M.length-1)===")"){M=M.substr(1,M.length-1);
}if(M.indexOf(",")>0){L=M.split(",");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}}if(M.indexOf(" ")>0){L=M.split(" ");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}}}return L;
}});
var v=b.extend({init:function(K,L,M,N,O,P){this.a=K||0;
this.b=L||0;
this.c=M||0;
this.d=N||0;
this.e=O||0;
this.f=P||0;
},fromMatrix:function i(K){var L=new v();
L.a=K.a;
L.b=K.b;
L.c=K.c;
L.d=K.d;
L.e=K.e;
L.f=K.f;
return L;
}});
function y(L,K){var N,O,M;
do{N=Math.random()*2-1;
O=Math.random()*2-1;
M=N*N+O*O;
}while(!M||M>1);
return L+K*N*Math.sqrt(-2*Math.log(M)/M);
}function D(M){if(J.isUndefined(M)){M=10;
}var N="";
var K="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
for(var L=M;
L>0;
--L){N+=K.charAt(Math.round(Math.random()*(K.length-1)));
}return N;
}var j={_distanceToLineSquared:function(O,K,L){function M(R,S){return(R.x-S.x)*(R.x-S.x)+(R.y-S.y)*(R.y-S.y);
}if(K===L){return M(O,K);
}var P=L.x-K.x,Q=L.y-K.y,N=(O.x-K.x)*P+(O.y-K.y)*Q;
if(N<0){return M(K,O);
}N=(L.x-O.x)*P+(L.y-O.y)*Q;
if(N<0){return M(L,O);
}N=(L.x-O.x)*Q-(L.y-O.y)*P;
return N*N/(P*P+Q*Q);
},distanceToLine:function(M,K,L){return Math.sqrt(this._distanceToLineSquared(M,K,L));
},distanceToPolyline:function(M,P){var L=Number.MAX_VALUE;
if(J.isUndefined(P)||P.length===0){return Number.MAX_VALUE;
}for(var Q=0;
Q<P.length-1;
Q++){var N=P[Q];
var O=P[Q+1];
var K=this._distanceToLineSquared(M,N,O);
if(K<L){L=K;
}}return Math.sqrt(L);
}};
var l=r.Class.extend({init:function(){this._buckets=[];
this.length=0;
},add:function(K,M){var L=this._createGetBucket(K);
if(J.isDefined(M)){L.value=M;
}return L;
},get:function(K){if(this._bucketExists(K)){return this._createGetBucket(K);
}return null;
},set:function(K,L){this.add(K,L);
},containsKey:function(K){return this._bucketExists(K);
},remove:function(L){if(this._bucketExists(L)){var K=this._hash(L);
delete this._buckets[K];
this.length--;
return L;
}},forEach:function(L){var N=this._hashes();
for(var O=0,P=N.length;
O<P;
O++){var M=N[O];
var K=this._buckets[M];
if(J.isUndefined(K)){continue;
}L(K);
}},clone:function(){var N=new l();
var M=this._hashes();
for(var O=0,P=M.length;
O<P;
O++){var L=M[O];
var K=this._buckets[L];
if(J.isUndefined(K)){continue;
}N.add(K.key,K.value);
}return N;
},_hashes:function(){var L=[];
for(var K in this._buckets){if(this._buckets.hasOwnProperty(K)){L.push(K);
}}return L;
},_bucketExists:function(L){var K=this._hash(L);
return J.isDefined(this._buckets[K]);
},_createGetBucket:function(M){var L=this._hash(M);
var K=this._buckets[L];
if(J.isUndefined(K)){K={key:M};
this._buckets[L]=K;
this.length++;
}return K;
},_hash:function(K){if(J.isNumber(K)){return K;
}if(J.isString(K)){return this._hashString(K);
}if(J.isObject(K)){return this._objectHashId(K);
}throw"Unsupported key type.";
},_hashString:function(N){var M=0;
if(N.length===0){return M;
}for(var L=0;
L<N.length;
L++){var K=N.charCodeAt(L);
M=M*32-M+K;
}return M;
},_objectHashId:function(L){var K=L._hashId;
if(J.isUndefined(K)){K=D();
L._hashId=K;
}return K;
}});
var g=r.Observable.extend({init:function(K){var M=this;
r.Observable.fn.init.call(M);
this._hashTable=new l();
this.length=0;
if(J.isDefined(K)){if(a.isArray(K)){for(var L=0;
L<K.length;
L++){this.add(K[L]);
}}else{K.forEach(function(N,O){this.add(N,O);
},this);
}}},add:function(L,M){var K=this._hashTable.get(L);
if(!K){K=this._hashTable.add(L);
this.length++;
this.trigger("changed");
}K.value=M;
},set:function(K,L){this.add(K,L);
},get:function(L){var K=this._hashTable.get(L);
if(K){return K.value;
}throw new Error("Cannot find key "+L);
},containsKey:function(K){return this._hashTable.containsKey(K);
},remove:function(K){if(this.containsKey(K)){this.trigger("changed");
this.length--;
return this._hashTable.remove(K);
}},forEach:function(K,L){this._hashTable.forEach(function(M){K.call(L,M.key,M.value);
});
},forEachValue:function(K,L){this._hashTable.forEach(function(M){K.call(L,M.value);
});
},forEachKey:function(K,L){this._hashTable.forEach(function(M){K.call(L,M.key);
});
},keys:function(){var K=[];
this.forEachKey(function(L){K.push(L);
});
return K;
}});
var C=r.Class.extend({init:function(){this._tail=null;
this._head=null;
this.length=0;
},enqueue:function(L){var K={value:L,next:null};
if(!this._head){this._head=K;
this._tail=this._head;
}else{this._tail.next=K;
this._tail=this._tail.next;
}this.length++;
},dequeue:function(){if(this.length<1){throw new Error("The queue is empty.");
}var K=this._head.value;
this._head=this._head.next;
this.length--;
return K;
},contains:function(L){var K=this._head;
while(K){if(K.value===L){return true;
}K=K.next;
}return false;
}});
var G=r.Observable.extend({init:function(K){var L=this;
r.Observable.fn.init.call(L);
this._hashTable=new l();
this.length=0;
if(J.isDefined(K)){if(K instanceof l){K.forEach(function(M){this.add(M);
});
}else{if(K instanceof g){K.forEach(function(M,N){this.add({key:M,value:N});
},this);
}}}},contains:function(K){return this._hashTable.containsKey(K);
},add:function(L){var K=this._hashTable.get(L);
if(!K){this._hashTable.add(L,L);
this.length++;
this.trigger("changed");
}},get:function(K){if(this.contains(K)){return this._hashTable.get(K).value;
}else{return null;
}},hash:function(K){return this._hashTable._hash(K);
},remove:function(K){if(this.contains(K)){this._hashTable.remove(K);
this.length--;
this.trigger("changed");
}},forEach:function(L,K){this._hashTable.forEach(function(M){L(M.value);
},K);
},toArray:function(){var K=[];
this.forEach(function(L){K.push(L);
});
return K;
}});
var x=r.Class.extend({init:function(L,M){this.links=[];
this.outgoing=[];
this.incoming=[];
this.weight=1;
if(J.isDefined(L)){this.id=L;
}else{this.id=D();
}if(J.isDefined(M)){this.associatedShape=M;
var K=M.bounds();
this.width=K.width;
this.height=K.height;
this.x=K.x;
this.y=K.y;
}else{this.associatedShape=null;
}this.data=null;
this.type="Node";
this.shortForm="Node '"+this.id+"'";
this.isVirtual=false;
},isIsolated:function(){return J.isEmpty(this.links);
},bounds:function(K){if(!J.isDefined(K)){return new f.Rect(this.x,this.y,this.width,this.height);
}this.x=K.x;
this.y=K.y;
this.width=K.width;
this.height=K.height;
},isLinkedTo:function(K){var L=this;
return J.any(L.links,function(M){return M.getComplement(L)===K;
});
},getChildren:function(){if(this.outgoing.length===0){return[];
}var K=[];
for(var L=0,M=this.outgoing.length;
L<M;
L++){var N=this.outgoing[L];
K.push(N.getComplement(this));
}return K;
},getParents:function(){if(this.incoming.length===0){return[];
}var N=[];
for(var K=0,L=this.incoming.length;
K<L;
K++){var M=this.incoming[K];
N.push(M.getComplement(this));
}return N;
},clone:function(){var K=new x();
if(J.isDefined(this.weight)){K.weight=this.weight;
}if(J.isDefined(this.balance)){K.balance=this.balance;
}if(J.isDefined(this.owner)){K.owner=this.owner;
}K.associatedShape=this.associatedShape;
K.x=this.x;
K.y=this.y;
K.width=this.width;
K.height=this.height;
return K;
},adjacentTo:function(K){return this.isLinkedTo(K)!==null;
},removeLink:function(K){if(K.source===this){J.remove(this.links,K);
J.remove(this.outgoing,K);
K.source=null;
}if(K.target===this){J.remove(this.links,K);
J.remove(this.incoming,K);
K.target=null;
}},hasLinkTo:function(K){return J.any(this.outgoing,function(L){return L.target===K;
});
},degree:function(){return this.links.length;
},incidentWith:function(K){return c(this.links,K);
},getLinksWith:function(K){return J.all(this.links,function(L){return L.getComplement(this)===K;
},this);
},getNeighbors:function(){var K=[];
J.forEach(this.incoming,function(L){K.push(L.getComplement(this));
},this);
J.forEach(this.outgoing,function(L){K.push(L.getComplement(this));
},this);
return K;
}});
var s=r.Class.extend({init:function(M,O,L,K){if(J.isUndefined(M)){throw"The source of the new link is not set.";
}if(J.isUndefined(O)){throw"The target of the new link is not set.";
}var N,P;
if(J.isString(M)){N=new x(M);
}else{N=M;
}if(J.isString(O)){P=new x(O);
}else{P=O;
}this.source=N;
this.target=P;
this.source.links.push(this);
this.target.links.push(this);
this.source.outgoing.push(this);
this.target.incoming.push(this);
if(J.isDefined(L)){this.id=L;
}else{this.id=D();
}if(J.isDefined(K)){this.associatedConnection=K;
}else{this.associatedConnection=null;
}this.type="Link";
this.shortForm="Link '"+this.source.id+"->"+this.target.id+"'";
},getComplement:function(K){if(this.source!==K&&this.target!==K){throw"The given node is not incident with this link.";
}return this.source===K?this.target:this.source;
},getCommonNode:function(K){if(this.source===K.source||this.source===K.target){return this.source;
}if(this.target===K.source||this.target===K.target){return this.target;
}return null;
},isBridging:function(K,L){return this.source===K&&this.target===L||this.source===L&&this.target===K;
},getNodes:function(){return[this.source,this.target];
},incidentWith:function(K){return this.source===K||this.target===K;
},adjacentTo:function(K){return c(this.source.links,K)||c(this.target.links,K);
},changeSource:function(K){J.remove(this.source.links,this);
J.remove(this.source.outgoing,this);
K.links.push(this);
K.outgoing.push(this);
this.source=K;
},changeTarget:function(K){J.remove(this.target.links,this);
J.remove(this.target.incoming,this);
K.links.push(this);
K.incoming.push(this);
this.target=K;
},changesNodes:function(K,L){if(this.source===K){this.changeSource(L);
}else{if(this.target===K){this.changeTarget(L);
}}},reverse:function(){var K=this.source;
var L=this.target;
this.source=L;
J.remove(K.outgoing,this);
this.source.outgoing.push(this);
this.target=K;
J.remove(L.incoming,this);
this.target.incoming.push(this);
return this;
},directTo:function(K){if(this.source!==K&&this.target!==K){throw"The given node is not incident with this link.";
}if(this.target!==K){this.reverse();
}},createReverseEdge:function(){var K=this.clone();
K.reverse();
K.reversed=true;
return K;
},clone:function(){var K=new s(this.source,this.target);
return K;
}});
var k=r.Class.extend({init:function(K){this.links=[];
this.nodes=[];
this._nodeMap=new g();
this.diagram=null;
this._root=null;
if(J.isDefined(K)){if(J.isString(K)){this.id=K;
}else{this.diagram=K;
this.id=K.id;
}}else{this.id=D();
}this.bounds=new E();
this._hasCachedRelationships=false;
this.type="Graph";
},cacheRelationships:function(K){if(J.isUndefined(K)){K=false;
}if(this._hasCachedRelationships&&!K){return;
}for(var L=0,M=this.nodes.length;
L<M;
L++){var N=this.nodes[L];
N.children=this.getChildren(N);
N.parents=this.getParents(N);
}this._hasCachedRelationships=true;
},assignLevels:function(P,O,Q){if(!P){throw"Start node not specified.";
}if(J.isUndefined(O)){O=0;
}this.cacheRelationships();
if(J.isUndefined(Q)){Q=new g();
J.forEach(this.nodes,function(R){Q.add(R,false);
});
}Q.set(P,true);
P.level=O;
var L=P.children;
for(var M=0,N=L.length;
M<N;
M++){var K=L[M];
if(!K||Q.get(K)){continue;
}this.assignLevels(K,O+1,Q);
}},root:function(L){if(J.isUndefined(L)){if(!this._root){var K=J.first(this.nodes,function(M){return M.incoming.length===0;
});
if(K){return K;
}return J.first(this.nodes);
}else{return this._root;
}}else{this._root=L;
}},getConnectedComponents:function(){this.componentIndex=0;
this.setItemIndices();
var K=J.initArray(this.nodes.length,-1);
for(var O=0;
O<this.nodes.length;
O++){if(K[O]===-1){this._collectConnectedNodes(K,O);
this.componentIndex++;
}}var L=[],N;
for(N=0;
N<this.componentIndex;
++N){L[N]=new k();
}for(N=0;
N<K.length;
++N){var M=L[K[N]];
M.addNodeAndOutgoings(this.nodes[N]);
}L.sort(function(P,Q){return Q.nodes.length-P.nodes.length;
});
return L;
},_collectConnectedNodes:function(M,L){M[L]=this.componentIndex;
var K=this.nodes[L];
J.forEach(K.links,function(N){var O=N.getComplement(K);
var P=O.index;
if(M[P]===-1){this._collectConnectedNodes(M,P);
}},this);
},calcBounds:function(){if(this.isEmpty()){this.bounds=new E();
return this.bounds;
}var K=null;
for(var L=0,M=this.nodes.length;
L<M;
L++){var N=this.nodes[L];
if(!K){K=N.bounds();
}else{K=K.union(N.bounds());
}}this.bounds=K;
return this.bounds;
},getSpanningTree:function(T){var W=new k();
var O=new g(),U,V;
W.root=T.clone();
W.root.level=0;
W.root.id=T.id;
O.add(T,W.root);
T.level=0;
var Y=[];
var S=[];
W._addNode(W.root);
Y.push(T);
S.push(T);
var M=1;
while(S.length>0){var Q=S.pop();
for(var R=0;
R<Q.links.length;
R++){var N=Q.links[R];
var K=N.getComplement(Q);
if(c(Y,K)){continue;
}K.level=Q.level+1;
if(M<K.level+1){M=K.level+1;
}if(!c(S,K)){S.push(K);
}if(!c(Y,K)){Y.push(K);
}if(O.containsKey(Q)){U=O.get(Q);
}else{U=Q.clone();
U.level=Q.level;
U.id=Q.id;
O.add(Q,U);
}if(O.containsKey(K)){V=O.get(K);
}else{V=K.clone();
V.level=K.level;
V.id=K.id;
O.add(K,V);
}var P=new s(U,V);
W.addLink(P);
}}var X=[];
for(var L=0;
L<M;
L++){X.push([]);
}J.forEach(W.nodes,function(Z){X[Z.level].push(Z);
});
W.treeLevels=X;
W.cacheRelationships();
return W;
},takeRandomNode:function(K,L){if(J.isUndefined(K)){K=[];
}if(J.isUndefined(L)){L=4;
}if(this.nodes.length===0){return null;
}if(this.nodes.length===1){return c(K,this.nodes[0])?null:this.nodes[0];
}var M=a.grep(this.nodes,function(N){return !c(K,N)&&N.degree()<=L;
});
if(J.isEmpty(M)){return null;
}return M[J.randomInteger(0,M.length)];
},isEmpty:function(){return J.isEmpty(this.nodes);
},isHealthy:function(){return J.all(this.links,function(K){return c(this.nodes,K.source)&&c(this.nodes,K.target);
},this);
},getParents:function(K){if(!this.hasNode(K)){throw"The given node is not part of this graph.";
}return K.getParents();
},getChildren:function(K){if(!this.hasNode(K)){throw"The given node is not part of this graph.";
}return K.getChildren();
},addLink:function(O,P,N){if(J.isUndefined(O)){throw"The source of the link is not defined.";
}if(J.isUndefined(P)){if(J.isDefined(O.type)&&O.type==="Link"){this.addExistingLink(O);
return;
}else{throw"The target of the link is not defined.";
}}var K=this.getNode(O);
if(J.isUndefined(K)){K=this.addNode(O);
}var L=this.getNode(P);
if(J.isUndefined(L)){L=this.addNode(P);
}var M=new s(K,L);
if(J.isDefined(N)){M.owner=N;
}this.links.push(M);
return M;
},removeAllLinks:function(){while(this.links.length>0){var K=this.links[0];
this.removeLink(K);
}},addExistingLink:function(K){if(this.hasLink(K)){return;
}this.links.push(K);
if(this.hasNode(K.source.id)){var L=this.getNode(K.source.id);
K.changeSource(L);
}else{this.addNode(K.source);
}if(this.hasNode(K.target.id)){var M=this.getNode(K.target.id);
K.changeTarget(M);
}else{this.addNode(K.target);
}},hasLink:function(K){if(J.isString(K)){return J.any(this.links,function(L){return L.id===K;
});
}if(K.type==="Link"){return c(this.links,K);
}throw"The given object is neither an identifier nor a Link.";
},getNode:function(L){var K=L.id||L;
if(this._nodeMap.containsKey(K)){return this._nodeMap.get(K);
}},hasNode:function(L){var K=L.id||L;
return this._nodeMap.containsKey(K);
},_addNode:function(K){this.nodes.push(K);
this._nodeMap.add(K.id,K);
},_removeNode:function(K){J.remove(this.nodes,K);
this._nodeMap.remove(K.id);
},removeNode:function(P){var O=P;
if(J.isString(P)){O=this.getNode(P);
}if(J.isDefined(O)){var N=O.links;
O.links=[];
for(var K=0,L=N.length;
K<L;
K++){var M=N[K];
this.removeLink(M);
}this._removeNode(O);
}else{throw"The identifier should be a Node or the Id (string) of a node.";
}},areConnected:function(K,L){return J.any(this.links,function(M){return M.source==K&&M.target==L||M.source==L&&M.target==K;
});
},removeLink:function(K){J.remove(this.links,K);
J.remove(K.source.outgoing,K);
J.remove(K.source.links,K);
J.remove(K.target.incoming,K);
J.remove(K.target.links,K);
},addNode:function(M,K,N){var L=null;
if(!J.isDefined(M)){throw"No Node or identifier for a new Node is given.";
}if(J.isString(M)){if(this.hasNode(M)){return this.getNode(M);
}L=new x(M);
}else{if(this.hasNode(M)){return this.getNode(M);
}L=M;
}if(J.isDefined(K)){L.bounds(K);
}if(J.isDefined(N)){L.owner=N;
}this._addNode(L);
return L;
},addNodeAndOutgoings:function(L){if(!this.hasNode(L)){this._addNode(L);
}var K=L.outgoing;
L.outgoing=[];
J.forEach(K,function(M){this.addExistingLink(M);
},this);
},setItemIndices:function(){var K;
for(K=0;
K<this.nodes.length;
++K){this.nodes[K].index=K;
}for(K=0;
K<this.links.length;
++K){this.links[K].index=K;
}},clone:function(N){var K=new k();
var M=J.isDefined(N)&&N===true;
if(M){K.nodeMap=new g();
K.linkMap=new g();
}var L=new g();
J.forEach(this.nodes,function(P){var O=P.clone();
L.set(P,O);
K._addNode(O);
if(M){K.nodeMap.set(O,P);
}});
J.forEach(this.links,function(P){if(L.containsKey(P.source)&&L.containsKey(P.target)){var O=K.addLink(L.get(P.source),L.get(P.target));
if(M){K.linkMap.set(O,P);
}}});
return K;
},linearize:function(K){return k.Utils.linearize(this,K);
},depthFirstTraversal:function(M,K){if(J.isUndefined(M)){throw"You need to supply a starting node.";
}if(J.isUndefined(K)){throw"You need to supply an action.";
}if(!this.hasNode(M)){throw"The given start-node is not part of this graph";
}var L=this.getNode(M);
var N=[];
this._dftIterator(L,K,N);
},_dftIterator:function(P,K,Q){K(P);
Q.push(P);
var M=P.getChildren();
for(var N=0,O=M.length;
N<O;
N++){var L=M[N];
if(c(Q,L)){continue;
}this._dftIterator(L,K,Q);
}},breadthFirstTraversal:function(S,K){if(J.isUndefined(S)){throw"You need to supply a starting node.";
}if(J.isUndefined(K)){throw"You need to supply an action.";
}if(!this.hasNode(S)){throw"The given start-node is not part of this graph";
}var N=this.getNode(S);
var R=new C();
var T=[];
R.enqueue(N);
while(R.length>0){var Q=R.dequeue();
K(Q);
T.push(Q);
var M=Q.getChildren();
for(var O=0,P=M.length;
O<P;
O++){var L=M[O];
if(c(T,L)||c(R,L)){continue;
}R.enqueue(L);
}}},_stronglyConnectedComponents:function(N,U,Q,S,M,V,P){Q.add(U,P);
S.add(U,P);
P++;
V.push(U);
var K=U.getChildren(),T;
for(var O=0,R=K.length;
O<R;
O++){T=K[O];
if(!Q.containsKey(T)){this._stronglyConnectedComponents(N,T,Q,S,M,V,P);
S.add(U,Math.min(S.get(U),S.get(T)));
}else{if(c(V,T)){S.add(U,Math.min(S.get(U),Q.get(T)));
}}}if(S.get(U)===Q.get(U)){var L=[];
do{T=V.pop();
L.push(T);
}while(T!==U);
if(!N||L.length>1){M.push(L);
}}},findCycles:function(L){if(J.isUndefined(L)){L=true;
}var N=new g();
var P=new g();
var K=[];
var R=[];
for(var M=0,O=this.nodes.length;
M<O;
M++){var Q=this.nodes[M];
if(N.containsKey(Q)){continue;
}this._stronglyConnectedComponents(L,Q,N,P,K,R,0);
}return K;
},isAcyclic:function(){return J.isEmpty(this.findCycles());
},isSubGraph:function(K){var L=K.linearize();
var M=this.linearize();
return J.all(L,function(N){return c(M,N);
});
},makeAcyclic:function(){if(this.isEmpty()||this.nodes.length<=1||this.links.length<=1){return[];
}if(this.nodes.length==2){var aa=[];
if(this.links.length>1){var Y=this.links[0];
var Z=Y.source;
for(var O=0,T=this.links.length;
O<T;
O++){var V=this.links[O];
if(V.source==Z){continue;
}var ab=V.reverse();
aa.push(ab);
}}return aa;
}var L=this.clone(true);
var X=this.nodes.length;
var Q=new g();
var M=function(N){if(N.outgoing.length===0){return 2-X;
}else{if(N.incoming.length===0){return X-2;
}else{return N.outgoing.length-N.incoming.length;
}}};
var K=function(at,ar){var N=M(at,X);
if(!ar.containsKey(N)){ar.set(N,[]);
}ar.get(N).push(at);
};
J.forEach(L.nodes,function(N){K(N,Q);
});
var aj=[];
var an=[];
while(L.nodes.length>0){var ag,ak,P;
if(Q.containsKey(2-X)){var am=Q.get(2-X);
while(am.length>0){ak=am.pop();
for(var U=0;
U<ak.links.length;
U++){var al=ak.links[U];
ag=al.getComplement(ak);
P=M(ag,X);
J.remove(Q.get(P),ag);
ag.removeLink(al);
K(ag,Q);
}L._removeNode(ak);
an.unshift(ak);
}}if(Q.containsKey(X-2)){var ai=Q.get(X-2);
while(ai.length>0){ag=ai.pop();
for(var af=0;
af<ag.links.length;
af++){var ah=ag.links[af];
ak=ah.getComplement(ag);
P=M(ak,X);
J.remove(Q.get(P),ak);
ak.removeLink(ah);
K(ak,Q);
}aj.push(ag);
L._removeNode(ag);
}}if(L.nodes.length>0){for(var R=X-3;
R>2-X;
R--){if(Q.containsKey(R)&&Q.get(R).length>0){var W=Q.get(R);
var ap=W.pop();
for(var ad=0;
ad<ap.links.length;
ad++){var ae=ap.links[ad];
var ao=ae.getComplement(ap);
P=M(ao,X);
J.remove(Q.get(P),ao);
ao.removeLink(ae);
K(ao,Q);
}aj.push(ap);
L._removeNode(ap);
break;
}}}}aj=aj.concat(an);
var aq=new g();
for(var S=0;
S<this.nodes.length;
S++){aq.set(L.nodeMap.get(aj[S]),S);
}var ac=[];
J.forEach(this.links,function(N){if(aq.get(N.source)>aq.get(N.target)){N.reverse();
ac.push(N);
}});
return ac;
}});
k.Predefined={EightGraph:function(){return k.Utils.parse(["1->2","2->3","3->4","4->1","3->5","5->6","6->7","7->3"]);
},Mindmap:function(){return k.Utils.parse(["0->1","0->2","0->3","0->4","0->5","1->6","1->7","7->8","2->9","9->10","9->11","3->12","12->13","13->14","4->15","4->16","15->17","15->18","18->19","18->20","14->21","14->22","5->23","23->24","23->25","6->26"]);
},ThreeGraph:function(){return k.Utils.parse(["1->2","2->3","3->1"]);
},BinaryTree:function(K){if(J.isUndefined(K)){K=5;
}return k.Utils.createBalancedTree(K,2);
},Linear:function(K){if(J.isUndefined(K)){K=10;
}return k.Utils.createBalancedTree(K,1);
},Tree:function(K,L){return k.Utils.createBalancedTree(K,L);
},Forest:function(K,L,M){return k.Utils.createBalancedForest(K,L,M);
},Workflow:function(){return k.Utils.parse(["0->1","1->2","2->3","1->4","4->3","3->5","5->6","6->3","6->7","5->4"]);
},Grid:function(P,O){var K=new f.Graph();
if(P<=0&&O<=0){return K;
}for(var L=0;
L<P+1;
L++){var R=null;
for(var M=0;
M<O+1;
M++){var Q=new x(L.toString()+"."+M.toString());
K.addNode(Q);
if(R){K.addLink(R,Q);
}if(L>0){var N=K.getNode((L-1).toString()+"."+M.toString());
K.addLink(N,Q);
}R=Q;
}}return K;
}};
k.Utils={parse:function(L){var R,K=new f.Graph(),Q=L.slice();
for(var M=0,N=Q.length;
M<N;
M++){var P=Q[M];
if(J.isString(P)){if(P.indexOf("->")<0){throw"The link should be specified as 'a->b'.";
}var O=P.split("->");
if(O.length!=2){throw"The link should be specified as 'a->b'.";
}R=new s(O[0],O[1]);
K.addLink(R);
}if(J.isObject(P)){if(!R){throw"Specification found before Link definition.";
}r.deepExtend(R,P);
}}return K;
},linearize:function(L,K){if(J.isUndefined(L)){throw"Expected an instance of a Graph object in slot one.";
}if(J.isUndefined(K)){K=false;
}var O=[];
for(var M=0,N=L.links.length;
M<N;
M++){var P=L.links[M];
O.push(P.source.id+"->"+P.target.id);
if(K){O.push({id:P.id});
}}return O;
},_addShape:function(L,M,K,N){if(J.isUndefined(M)){M=new f.Point(0,0);
}if(J.isUndefined(K)){K=D();
}N=r.deepExtend({width:20,height:20,id:K,radius:10,fill:"#778899",data:"circle",undoable:false,x:M.x,y:M.y},N);
return L.addShape(N);
},_addConnection:function(K,L,N,M){return K.connect(L,N,M);
},createDiagramFromGraph:function(L,O,M,Y){if(J.isUndefined(L)){throw"The diagram surface is undefined.";
}if(J.isUndefined(O)){throw"No graph specification defined.";
}if(J.isUndefined(M)){M=true;
}if(J.isUndefined(Y)){Y=false;
}var ad=L.element.clientWidth||200;
var P=L.element.clientHeight||200;
var U=[],V,Z;
for(var Q=0,S=O.nodes.length;
Q<S;
Q++){V=O.nodes[Q];
var X=V.position;
if(J.isUndefined(X)){if(J.isDefined(V.x)&&J.isDefined(V.y)){X=new A(V.x,V.y);
}else{X=new A(J.randomInteger(10,ad-20),J.randomInteger(10,P-20));
}}var W={};
if(V.id==="0"){}else{if(Y){r.deepExtend(W,{width:Math.random()*150+20,height:Math.random()*80+50,data:"rectangle",fill:{color:"#778899"}});
}}Z=this._addShape(L,X,V.id,W);
var K=Z.bounds();
if(J.isDefined(K)){V.x=K.x;
V.y=K.y;
V.width=K.width;
V.height=K.height;
}U[V.id]=Z;
}for(var N=0;
N<O.links.length;
N++){var T=O.links[N];
var ab=U[T.source.id];
if(J.isUndefined(ab)){continue;
}var ac=U[T.target.id];
if(J.isUndefined(ac)){continue;
}this._addConnection(L,ab,ac,{id:T.id});
}if(M){var R=new L.SpringLayout(L);
R.layoutGraph(O,{limitToView:false});
for(var aa=0;
aa<O.nodes.length;
aa++){V=O.nodes[aa];
Z=U[V.id];
Z.bounds(new E(V.x,V.y,V.width,V.height));
}}},createBalancedTree:function(R,V){if(J.isUndefined(R)){R=3;
}if(J.isUndefined(V)){V=3;
}var L=new f.Graph(),K=-1,Q=[],S;
if(R<=0||V<=0){return L;
}var U=new x((++K).toString());
L.addNode(U);
L.root=U;
Q.push(U);
for(var M=0;
M<R;
M++){S=[];
for(var O=0;
O<Q.length;
O++){var T=Q[O];
for(var P=0;
P<V;
P++){var N=new x((++K).toString());
L.addLink(T,N);
S.push(N);
}}Q=S;
}return L;
},createBalancedForest:function(R,V,X){if(J.isUndefined(R)){R=3;
}if(J.isUndefined(V)){V=3;
}if(J.isUndefined(X)){X=5;
}var L=new f.Graph(),K=-1,Q=[],S;
if(R<=0||V<=0||X<=0){return L;
}for(var W=0;
W<X;
W++){var U=new x((++K).toString());
L.addNode(U);
Q=[U];
for(var M=0;
M<R;
M++){S=[];
for(var O=0;
O<Q.length;
O++){var T=Q[O];
for(var P=0;
P<V;
P++){var N=new x((++K).toString());
L.addLink(T,N);
S.push(N);
}}Q=S;
}}return L;
},createRandomConnectedGraph:function(S,O,N){if(J.isUndefined(S)){S=40;
}if(J.isUndefined(O)){O=4;
}if(J.isUndefined(N)){N=false;
}var L=new f.Graph(),K=-1;
if(S<=0){return L;
}var W=new x((++K).toString());
L.addNode(W);
if(S===1){return L;
}if(S>1){for(var M=1;
M<S;
M++){var T=L.takeRandomNode([],O);
if(!T){break;
}var R=L.addNode(M.toString());
L.addLink(T,R);
}if(!N&&S>1){var U=J.randomInteger(1,S);
for(var V=0;
V<U;
V++){var P=L.takeRandomNode([],O);
var Q=L.takeRandomNode([],O);
if(P&&Q&&!L.areConnected(P,Q)){L.addLink(P,Q);
}}}return L;
}},randomDiagram:function(K,P,N,M,O){var L=r.dataviz.diagram.Graph.Utils.createRandomConnectedGraph(P,N,M);
k.Utils.createDiagramFromGraph(K,L,false,O);
}};
r.deepExtend(f,{init:function(K){r.init(K,f.ui);
},Point:A,Intersect:n,Geometry:j,Rect:E,Size:H,RectAlign:F,Matrix:u,MatrixVector:v,normalVariable:y,randomId:D,Dictionary:g,HashTable:l,Queue:C,Set:G,Node:x,Link:s,Graph:k,PathDefiner:z});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("dataviz/diagram/svg",["kendo.drawing","dataviz/diagram/math"],b);
}(function(){(function(a,aa){var B=window.kendo,o=B.dataviz.diagram,i=B.Class,m=B.deepExtend,M=o.Point,O=o.Rect,I=o.Matrix,ab=o.Utils,z=ab.isNumber,A=ab.isString,J=o.MatrixVector,t=B.geometry,l=B.drawing,n=B.util.defined,y=a.inArray;
var Z="transparent",H={none:"none",arrowStart:"ArrowStart",filledCircle:"FilledCircle",arrowEnd:"ArrowEnd"},s=360,T="start",r="end",ad="width",w="height",ae="x",af="y";
o.Markers=H;
function p(ah,X){var d=this.options;
var Y=false;
var ai,g;
for(var ag=0;
ag<X.length;
ag++){g=X[ag];
ai=ah[g];
if(z(ai)&&d[g]!==ai){d[g]=ai;
Y=true;
}}return Y;
}var R=i.extend({init:function(d,g){this.x=d;
this.y=g;
},toMatrix:function(){return I.scaling(this.x,this.y);
},toString:function(){return B.format("scale({0},{1})",this.x,this.y);
},invert:function(){return new R(1/this.x,1/this.y);
}});
var W=i.extend({init:function(d,g){this.x=d;
this.y=g;
},toMatrixVector:function(){return new J(0,0,0,0,this.x,this.y);
},toMatrix:function(){return I.translation(this.x,this.y);
},toString:function(){return B.format("translate({0},{1})",this.x,this.y);
},plus:function(d){this.x+=d.x;
this.y+=d.y;
},times:function(d){this.x*=d;
this.y*=d;
},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y);
},normalize:function(){if(this.Length===0){return;
}this.times(1/this.length());
},invert:function(){return new W(-this.x,-this.y);
}});
var Q=i.extend({init:function(d,g,X){this.x=g||0;
this.y=X||0;
this.angle=d;
},toString:function(){if(this.x&&this.y){return B.format("rotate({0},{1},{2})",this.angle,this.x,this.y);
}else{return B.format("rotate({0})",this.angle);
}},toMatrix:function(){return I.rotation(this.angle,this.x,this.y);
},center:function(){return new M(this.x,this.y);
},invert:function(){return new Q(s-this.angle,this.x,this.y);
}});
Q.ZERO=new Q(0);
Q.create=function(d){return new Q(d.angle,d.x,d.y);
};
Q.parse=function(X){var Y=X.slice(1,X.length-1).split(","),d=Y[0],ag=Y[1],ah=Y[2];
var g=new Q(d,ag,ah);
return g;
};
var j=i.extend({init:function(ag,ah,X,Y,d,g){this.translate=new W(ag,ah);
if(X!==aa&&Y!==aa){this.scale=new R(X,Y);
}if(d!==aa){this.rotate=g?new Q(d,g.x,g.y):new Q(d);
}},toString:function(){var d=function(g){return g?g.toString():"";
};
return d(this.translate)+d(this.rotate)+d(this.scale);
},render:function(d){d._transform=this;
d._renderTransform();
},toMatrix:function(){var d=I.unit();
if(this.translate){d=d.times(this.translate.toMatrix());
}if(this.rotate){d=d.times(this.rotate.toMatrix());
}if(this.scale){d=d.times(this.scale.toMatrix());
}return d;
},invert:function(){var d=this.rotate?this.rotate.invert():aa,g=d?d.toMatrix():I.unit(),X=this.scale?this.scale.invert():aa,Y=X?X.toMatrix():I.unit();
var ai=new M(-this.translate.x,-this.translate.y);
ai=g.times(Y).apply(ai);
var ah=new W(ai.x,ai.y);
var ag=new j();
ag.translate=ah;
ag.rotate=d;
ag.scale=X;
return ag;
}});
var c={_setScale:function(){var d=this.options;
var X=this._originWidth;
var g=this._originHeight;
var Y=d.width/X;
var ag=d.height/g;
if(!z(Y)){Y=1;
}if(!z(ag)){ag=1;
}this._transform.scale=new R(Y,ag);
},_setTranslate:function(){var d=this.options;
var g=d.x||0;
var X=d.y||0;
this._transform.translate=new W(g,X);
},_initSize:function(){var d=this.options;
var g=false;
if(d.autoSize!==false&&(n(d.width)||n(d.height))){this._measure(true);
this._setScale();
g=true;
}if(n(d.x)||n(d.y)){this._setTranslate();
g=true;
}if(g){this._renderTransform();
}},_updateSize:function(d){var g=false;
if(this.options.autoSize!==false&&this._diffNumericOptions(d,[ad,w])){g=true;
this._measure(true);
this._setScale();
}if(this._diffNumericOptions(d,[ae,af])){g=true;
this._setTranslate();
}if(g){this._renderTransform();
}return g;
}};
var q=i.extend({init:function(g){var d=this;
d.options=m({},d.options,g);
d.id=d.options.id;
d._originSize=O.empty();
d._transform=new j();
},visible:function(d){return this.drawingContainer().visible(d);
},redraw:function(d){if(d&&d.id){this.id=d.id;
}},position:function(g,X){var d=this.options;
if(!n(g)){return new M(d.x,d.y);
}if(n(X)){d.x=g;
d.y=X;
}else{if(g instanceof M){d.x=g.x;
d.y=g.y;
}}this._transform.translate=new W(d.x,d.y);
this._renderTransform();
},rotate:function(d,g){if(n(d)){this._transform.rotate=new Q(d,g.x,g.y);
this._renderTransform();
}return this._transform.rotate||Q.ZERO;
},drawingContainer:function(){return this.drawingElement;
},_renderTransform:function(){var d=this._transform.toMatrix();
this.drawingContainer().transform(new t.Matrix(d.a,d.b,d.c,d.d,d.e,d.f));
},_hover:function(){},_diffNumericOptions:p,_measure:function(g){var X;
if(!this._measured||g){var d=this._boundingBox()||new t.Rect();
var Y=d.topLeft();
X=new O(Y.x,Y.y,d.width(),d.height());
this._originSize=X;
this._originWidth=X.width;
this._originHeight=X.height;
this._measured=true;
}else{X=this._originSize;
}return X;
},_boundingBox:function(){return this.drawingElement.rawBBox();
}});
var ac=q.extend({init:function(d){q.fn.init.call(this,d);
d=this.options;
d.fill=K(d.fill);
d.stroke=K(d.stroke);
},options:{stroke:{color:"gray",width:1},fill:{color:Z}},fill:function(d,g){this._fill({color:u(d),opacity:g});
},stroke:function(d,X,g){this._stroke({color:u(d),width:X,opacity:g});
},redraw:function(g){if(g){var X=g.stroke;
var d=g.fill;
if(X){this._stroke(K(X));
}if(d){this._fill(K(d));
}q.fn.redraw.call(this,g);
}},_hover:function(ag){var d=this.drawingElement;
var Y=this.options;
var X=Y.hover;
if(X&&X.fill){var g=ag?K(X.fill):Y.fill;
d.fill(g.color,g.opacity);
}},_stroke:function(X){var d=this.options;
m(d,{stroke:X});
X=d.stroke;
var g=null;
if(X.width>0){g={color:X.color,width:X.width,opacity:X.opacity,dashType:X.dashType};
}this.drawingElement.options.set("stroke",g);
},_fill:function(g){var ag=this.options;
m(ag,{fill:g||{}});
var d=ag.fill;
if(d.gradient){var X=d.gradient;
var Y=X.type==="radial"?l.RadialGradient:l.LinearGradient;
this.drawingElement.fill(new Y(X));
}else{this.drawingElement.fill(d.color,d.opacity);
}}});
var U=ac.extend({init:function(d){d=this._textColor(d);
ac.fn.init.call(this,d);
this._font();
this._initText();
this._initSize();
},options:{fontSize:15,fontFamily:"sans-serif",stroke:{width:0},fill:{color:"black"},autoSize:true},_initText:function(){var d=this.options;
this.drawingElement=new l.Text(n(d.text)?d.text:"",new t.Point(),{font:d.font});
this._fill();
this._stroke();
},_textColor:function(d){if(d&&d.color){d=m({},d,{fill:{color:d.color}});
}return d;
},_font:function(){var g=this.options;
if(g.fontFamily&&n(g.fontSize)){var d=[];
if(g.fontStyle){d.push(g.fontStyle);
}if(g.fontWeight){d.push(g.fontWeight);
}d.push(g.fontSize+(z(g.fontSize)?"px":""));
d.push(g.fontFamily);
g.font=d.join(" ");
}else{delete g.font;
}},content:function(d){return this.drawingElement.content(d);
},redraw:function(d){if(d){var g=false;
var X=this.options;
d=this._textColor(d);
ac.fn.redraw.call(this,d);
if(d.fontFamily||n(d.fontSize)||d.fontStyle||d.fontWeight){m(X,{fontFamily:d.fontFamily,fontSize:d.fontSize,fontStyle:d.fontStyle,fontWeight:d.fontWeight});
this._font();
this.drawingElement.options.set("font",X.font);
g=true;
}if(d.text){this.content(d.text);
g=true;
}if(!this._updateSize(d)&&g){this._initSize();
}}}});
m(U.fn,c);
var P=ac.extend({init:function(d){ac.fn.init.call(this,d);
this._initPath();
this._setPosition();
},_setPosition:function(){var d=this.options;
var g=d.x;
var X=d.y;
if(n(g)||n(X)){this.position(g||0,X||0);
}},redraw:function(d){if(d){ac.fn.redraw.call(this,d);
if(this._diffNumericOptions(d,[ad,w])){this._drawPath();
}if(this._diffNumericOptions(d,[ae,af])){this._setPosition();
}}},_initPath:function(){var d=this.options;
this.drawingElement=new l.Path({stroke:d.stroke,closed:true});
this._fill();
this._drawPath();
},_drawPath:function(){var d=this.drawingElement;
var X=S(this.options);
var Y=X.width;
var g=X.height;
d.segments.elements([k(0,0),k(Y,0),k(Y,g),k(0,g)]);
}});
var F=ac.extend({init:function(g){ac.fn.init.call(this,g);
var d=this.options.anchor;
this.anchor=new t.Point(d.x,d.y);
this.createElement();
},options:{stroke:{color:Z,width:0},fill:{color:"black"}},_transformToPath:function(g,d){var X=d.transform();
if(g&&X){g=g.transformCopy(X);
}return g;
},redraw:function(d){if(d){if(d.position){this.options.position=d.position;
}ac.fn.redraw.call(this,d);
}}});
var h=F.extend({options:{radius:4,anchor:{x:0,y:0}},createElement:function(){var d=this.options;
this.drawingElement=new l.Circle(new t.Circle(this.anchor,d.radius),{fill:d.fill,stroke:d.stroke});
},positionMarker:function(g){var d=this.options;
var Y=d.position;
var ag=g.segments;
var ah;
var X;
if(Y==T){ah=ag[0];
}else{ah=ag[ag.length-1];
}if(ah){X=this._transformToPath(ah.anchor(),g);
this.drawingElement.transform(t.transform().translate(X.x,X.y));
}}});
var b=F.extend({options:{path:"M 0 0 L 10 5 L 0 10 L 3 5 z",anchor:{x:10,y:5}},createElement:function(){var d=this.options;
this.drawingElement=l.Path.parse(d.path,{fill:d.fill,stroke:d.stroke});
},positionMarker:function(X){var Y=this._linePoints(X);
var ag=Y.start;
var g=Y.end;
var ah=t.transform();
if(ag){ah.rotate(E(ag,g),g);
}if(g){var d=this.anchor;
var ai=g.clone().translate(-d.x,-d.y);
ah.translate(ai.x,ai.y);
}this.drawingElement.transform(ah);
},_linePoints:function(Y){var X=this.options;
var ah=Y.segments;
var ai,d,aj;
if(X.position==T){aj=ah[0];
if(aj){d=aj.anchor();
ai=aj.controlOut();
var g=ah[1];
if(!ai&&g){ai=g.anchor();
}}}else{aj=ah[ah.length-1];
if(aj){d=aj.anchor();
ai=aj.controlIn();
var ag=ah[ah.length-2];
if(!ai&&ag){ai=ag.anchor();
}}}if(d){return{start:this._transformToPath(ai,Y),end:this._transformToPath(d,Y)};
}}});
var G={_getPath:function(g){var d=this.drawingElement;
if(d instanceof l.MultiPath){if(g==T){d=d.paths[0];
}else{d=d.paths[d.paths.length-1];
}}if(d&&d.segments.length){return d;
}},_normalizeMarkerOptions:function(g){var X=g.startCap;
var d=g.endCap;
if(A(X)){g.startCap={type:X};
}if(A(d)){g.endCap={type:d};
}},_removeMarker:function(g){var d=this._markers[g];
if(d){this.drawingContainer().remove(d.drawingElement);
delete this._markers[g];
}},_createMarkers:function(){var d=this.options;
this._normalizeMarkerOptions(d);
this._markers={};
this._markers[T]=this._createMarker(d.startCap,T);
this._markers[r]=this._createMarker(d.endCap,r);
},_createMarker:function(X,ag){var ah=(X||{}).type;
var Y=this._getPath(ag);
var g,d;
if(!Y){this._removeMarker(ag);
return;
}if(ah==H.filledCircle){g=h;
}else{if(ah==H.arrowStart||ah==H.arrowEnd){g=b;
}else{this._removeMarker(ag);
}}if(g){d=new g(m({},X,{position:ag}));
d.positionMarker(Y);
this.drawingContainer().append(d.drawingElement);
return d;
}},_positionMarker:function(X){var d=this._markers[X];
if(d){var g=this._getPath(X);
if(g){d.positionMarker(g);
}else{this._removeMarker(X);
}}},_capMap:{start:"startCap",end:"endCap"},_redrawMarker:function(ah,aj,X){this._normalizeMarkerOptions(X);
var ai=this.options;
var d=this._capMap[aj];
var ag=(ai[d]||{}).type;
var Y=X[d];
var g=false;
if(Y){ai[d]=m({},ai[d],Y);
if(Y.type&&ag!=Y.type){this._removeMarker(aj);
this._markers[aj]=this._createMarker(ai[d],aj);
g=true;
}else{if(this._markers[aj]){this._markers[aj].redraw(Y);
}}}else{if(ah&&!this._markers[aj]&&ai[d]){this._markers[aj]=this._createMarker(ai[d],aj);
g=true;
}}return g;
},_redrawMarkers:function(g,d){if(!this._redrawMarker(g,T,d)&&g){this._positionMarker(T);
}if(!this._redrawMarker(g,r,d)&&g){this._positionMarker(r);
}}};
var L=ac.extend({init:function(d){ac.fn.init.call(this,d);
this.container=new l.Group();
this._createElements();
this._initSize();
},options:{autoSize:true},drawingContainer:function(){return this.container;
},data:function(g){var d=this.options;
if(g){if(d.data!=g){d.data=g;
this._setData(g);
this._initSize();
this._redrawMarkers(true,{});
}}else{return d.data;
}},redraw:function(g){if(g){ac.fn.redraw.call(this,g);
var X=this.options;
var d=g.data;
if(n(d)&&X.data!=d){X.data=d;
this._setData(d);
if(!this._updateSize(g)){this._initSize();
}this._redrawMarkers(true,g);
}else{this._updateSize(g);
this._redrawMarkers(false,g);
}}},_createElements:function(){var d=this.options;
this.drawingElement=l.Path.parse(d.data||"",{stroke:d.stroke});
this._fill();
this.container.append(this.drawingElement);
this._createMarkers();
},_setData:function(d){var g=this.drawingElement;
var X=l.Path.parse(d||"");
var Y=X.paths.slice(0);
X.paths.elements([]);
g.paths.elements(Y);
}});
m(L.fn,c);
m(L.fn,G);
var D=ac.extend({init:function(d){ac.fn.init.call(this,d);
this.container=new l.Group();
this._initPath();
this._createMarkers();
},drawingContainer:function(){return this.container;
},redraw:function(g){if(g){g=g||{};
var d=g.from;
var X=g.to;
if(d){this.options.from=d;
}if(X){this.options.to=X;
}if(d||X){this._drawPath();
this._redrawMarkers(true,g);
}else{this._redrawMarkers(false,g);
}ac.fn.redraw.call(this,g);
}},_initPath:function(){var g=this.options;
var d=this.drawingElement=new l.Path({stroke:g.stroke});
this._fill();
this._drawPath();
this.container.append(d);
},_drawPath:function(){var X=this.options;
var d=this.drawingElement;
var g=X.from||new M();
var Y=X.to||new M();
d.segments.elements([k(g.x,g.y),k(Y.x,Y.y)]);
}});
m(D.fn,G);
var N=ac.extend({init:function(d){ac.fn.init.call(this,d);
this.container=new l.Group();
this._initPath();
this._createMarkers();
},drawingContainer:function(){return this.container;
},points:function(g){var d=this.options;
if(g){d.points=g;
this._updatePath();
}else{return d.points;
}},redraw:function(d){if(d){var g=d.points;
ac.fn.redraw.call(this,d);
if(g&&this._pointsDiffer(g)){this.points(g);
this._redrawMarkers(true,d);
}else{this._redrawMarkers(false,d);
}}},_initPath:function(){var d=this.options;
this.drawingElement=new l.Path({stroke:d.stroke});
this._fill();
this.container.append(this.drawingElement);
if(d.points){this._updatePath();
}},_pointsDiffer:function(Y){var d=this.options.points;
var g=d.length!==Y.length;
if(!g){for(var X=0;
X<Y.length;
X++){if(d[X].x!==Y[X].x||d[X].y!==Y[X].y){g=true;
break;
}}}return g;
},_updatePath:function(){var d=this.drawingElement;
var X=this.options;
var ag=X.points;
var ah=[];
var Y;
for(var g=0;
g<ag.length;
g++){Y=ag[g];
ah.push(k(Y.x,Y.y));
}d.segments.elements(ah);
},options:{points:[]}});
m(N.fn,G);
var x=q.extend({init:function(d){q.fn.init.call(this,d);
this._initImage();
},redraw:function(d){if(d){if(d.source){this.drawingElement.src(d.source);
}if(this._diffNumericOptions(d,[ad,w,ae,af])){this.drawingElement.rect(this._rect());
}q.fn.redraw.call(this,d);
}},_initImage:function(){var d=this.options;
var g=this._rect();
this.drawingElement=new l.Image(d.source,g,{});
},_rect:function(){var X=S(this.options);
var d=new t.Point(X.x,X.y);
var g=new t.Size(X.width,X.height);
return new t.Rect(d,g);
}});
var v=q.extend({init:function(d){this.children=[];
q.fn.init.call(this,d);
this.drawingElement=new l.Group();
this._initSize();
},options:{autoSize:false},append:function(d){this.drawingElement.append(d.drawingContainer());
this.children.push(d);
this._childrenChange=true;
},remove:function(d){if(this._remove(d)){this._childrenChange=true;
}},_remove:function(g){var d=y(g,this.children);
if(d>=0){this.drawingElement.removeAt(d);
this.children.splice(d,1);
return true;
}},clear:function(){this.drawingElement.clear();
this.children=[];
this._childrenChange=true;
},toFront:function(X){var g;
for(var d=0;
d<X.length;
d++){g=X[d];
if(this._remove(g)){this.append(g);
}}},toBack:function(d){this._reorderChildren(d,0);
},toIndex:function(g,d){this._reorderChildren(g,d);
},_reorderChildren:function(am,aj){var ag=this.drawingElement;
var g=ag.children.slice(0);
var d=this.children;
var Y=z(aj);
var ah,ai,ak,X,al;
for(ah=0;
ah<am.length;
ah++){al=am[ah];
X=al.drawingContainer();
ai=y(al,d);
if(ai>=0){g.splice(ai,1);
d.splice(ai,1);
ak=Y?aj:aj[ah];
g.splice(ak,0,X);
d.splice(ak,0,al);
}}ag.clear();
ag.append.apply(ag,g);
},redraw:function(d){if(d){if(this._childrenChange){this._childrenChange=false;
if(!this._updateSize(d)){this._initSize();
}}else{this._updateSize(d);
}q.fn.redraw.call(this,d);
}},_boundingBox:function(){var X=this.children;
var d;
var ag,g;
for(var Y=0;
Y<X.length;
Y++){ag=X[Y];
if(ag.visible()&&ag._includeInBBox!==false){g=ag.drawingContainer().clippedBBox(null);
if(g){if(d){d=t.Rect.union(d,g);
}else{d=g;
}}}}return d;
}});
m(v.fn,c);
var C=v.extend({init:function(g,d){this.children=[];
q.fn.init.call(this,d);
this.drawingElement=new l.Layout(V(g),d);
this._initSize();
},rect:function(g){if(g){this.drawingElement.rect(V(g));
}else{var d=this.drawingElement.rect();
if(d){return new O(d.origin.x,d.origin.y,d.size.width,d.size.height);
}}},reflow:function(){this.drawingElement.reflow();
},redraw:function(d){B.deepExtend(this.drawingElement.options,d);
v.fn.redraw.call(this,d);
}});
var f=ac.extend({init:function(d){ac.fn.init.call(this,d);
this._initCircle();
this._initSize();
},redraw:function(g){if(g){var d=this.options;
if(g.center){m(d,{center:g.center});
this._center.move(d.center.x,d.center.y);
}if(this._diffNumericOptions(g,["radius"])){this._circle.setRadius(d.radius);
}this._updateSize(g);
ac.fn.redraw.call(this,g);
}},_initCircle:function(){var X=this.options;
var ag=X.width;
var g=X.height;
var Y=X.radius;
if(!n(Y)){if(!n(ag)){ag=g;
}if(!n(g)){g=ag;
}X.radius=Y=Math.min(ag,g)/2;
}var d=X.center||{x:Y,y:Y};
this._center=new t.Point(d.x,d.y);
this._circle=new t.Circle(this._center,Y);
this.drawingElement=new l.Circle(this._circle,{stroke:X.stroke});
this._fill();
}});
m(f.fn,c);
var e=i.extend({init:function(d,g){g=g||{};
this.element=d;
this.surface=l.Surface.create(d,g);
if(B.isFunction(this.surface.translate)){this.translate=this._translate;
}this.drawingElement=new l.Group();
this._viewBox=new O(0,0,g.width,g.height);
this.size(this._viewBox);
},bounds:function(){var d=this.drawingElement.clippedBBox();
return new O(0,0,d.width(),d.height());
},size:function(d){var g=this._viewBox;
if(n(d)){g.width=d.width;
g.height=d.height;
this.surface.setSize(d);
}return{width:g.width,height:g.height};
},_translate:function(g,X){var d=this._viewBox;
if(n(g)&&n(X)){d.x=g;
d.y=X;
this.surface.translate({x:g,y:X});
}return{x:d.x,y:d.y};
},draw:function(){this.surface.draw(this.drawingElement);
},append:function(d){this.drawingElement.append(d.drawingContainer());
return this;
},remove:function(d){this.drawingElement.remove(d.drawingContainer());
},insertBefore:function(){},clear:function(){this.drawingElement.clear();
},destroy:function(d){this.surface.destroy();
if(d){a(this.element).remove();
}}});
function S(d){return{x:d.x||0,y:d.y||0,width:d.width||0,height:d.height||0};
}function K(g){if(g){var d=g;
if(A(d)){d={color:d};
}if(d.color){d.color=u(d.color);
}return d;
}}function u(g){var d;
if(g!=Z){d=new l.Color(g).toHex();
}else{d=g;
}return d;
}function E(g,X){var Y=X.x-g.x;
var ag=X.y-g.y;
var d=B.util.deg(Math.atan2(ag,Y));
return d;
}function k(d,g){return new l.Segment(new t.Point(d,g));
}function V(d){if(d){return new t.Rect([d.x,d.y],[d.width,d.height]);
}}B.deepExtend(o,{init:function(d){B.init(d,o.ui);
},diffNumericOptions:p,Element:q,Scale:R,Translation:W,Rotation:Q,Circle:f,Group:v,Rectangle:P,Canvas:e,Path:L,Layout:C,Line:D,MarkerBase:F,ArrowMarker:b,CircleMarker:h,Polyline:N,CompositeTransform:j,TextBlock:U,Image:x,VisualBase:ac});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("dataviz/diagram/services",["kendo.drawing","dataviz/diagram/svg"],b);
}(function(){(function(a,aF){var S=window.kendo,v=S.dataviz,C=v.diagram,k=S.Class,J=C.Group,aj=C.Rect,ak=C.Rectangle,aH=C.Utils,P=aH.isUndefined,ae=C.Point,j=C.Circle,ay=C.Ticker,w=S.deepExtend,aa=S.ui.Movable,g=S.support.browser,z=S.util.defined,O=a.inArray,ai=a.proxy;
var u={arrow:"default",grip:"pointer",cross:"pointer",add:"pointer",move:"move",select:"pointer",south:"s-resize",east:"e-resize",west:"w-resize",north:"n-resize",rowresize:"row-resize",colresize:"col-resize"},L=10,e="Auto",aC="Top",am="Right",U="Left",f="Bottom",y=10,x=10,F="dragStart",D="drag",E="dragEnd",R="itemRotate",Q="itemBoundsChange",X=5,W=5,Y="mouseEnter",Z="mouseLeave",aK="zoomStart",aJ="zoomEnd",aq=-20000,ap=20000,H=0.9,I=0.9300000000000001,aI=5,aE="transparent",ac="pan",an="rotated",av="source",aw="target",K={"-1":av,"1":aw};
C.Cursors=u;
var ah=S.Class.extend({init:function(aL){this.layoutState=aL;
this.diagram=aL.diagram;
},initState:function(){this.froms=[];
this.tos=[];
this.subjects=[];
function aL(aN,aM){var aO=this.diagram.getShapeById(aN);
if(aO){this.subjects.push(aO);
this.froms.push(aO.bounds().topLeft());
this.tos.push(aM.topLeft());
}}this.layoutState.nodeMap.forEach(aL,this);
},update:function(aM){if(this.subjects.length<=0){return;
}for(var aL=0;
aL<this.subjects.length;
aL++){this.subjects[aL].position(new ae(this.froms[aL].x+(this.tos[aL].x-this.froms[aL].x)*aM,this.froms[aL].y+(this.tos[aL].y-this.froms[aL].y)*aM));
}}});
var T=k.extend({init:function(aN,aM,aL){if(P(aL)){this.animate=false;
}else{this.animate=aL;
}this._initialState=aN;
this._finalState=aM;
this.title="Diagram layout";
},undo:function(){this.setState(this._initialState);
},redo:function(){this.setState(this._finalState);
},setState:function(aM){var aL=aM.diagram;
if(this.animate){aM.linkMap.forEach(function(aP,aQ){var aO=aL.getShapeById(aP);
aO.visible(false);
if(aO){aO.points(aQ);
}});
var aN=new ay();
aN.addAdapter(new ah(aM));
aN.onComplete(function(){aM.linkMap.forEach(function(aP){var aO=aL.getShapeById(aP);
aO.visible(true);
});
});
aN.play();
}else{aM.nodeMap.forEach(function(aP,aO){var aQ=aL.getShapeById(aP);
if(aQ){aQ.position(aO.topLeft());
}});
aM.linkMap.forEach(function(aP,aQ){var aO=aL.getShapeById(aP);
if(aO){aO.points(aQ);
}});
}}});
var l=k.extend({init:function(aL){this.units=[];
this.title="Composite unit";
if(aL!==aF){this.units.push(aL);
}},add:function(aL){this.units.push(aL);
},undo:function(){for(var aL=0;
aL<this.units.length;
aL++){this.units[aL].undo();
}},redo:function(){for(var aL=0;
aL<this.units.length;
aL++){this.units[aL].redo();
}}});
var p=k.extend({init:function(aL,aM,aN){this.item=aL;
this._redoSource=aM;
this._redoTarget=aN;
if(z(aM)){this._undoSource=aL.source();
}if(z(aN)){this._undoTarget=aL.target();
}this.title="Connection Editing";
},undo:function(){if(this._undoSource!==aF){this.item._updateConnector(this._undoSource,"source");
}if(this._undoTarget!==aF){this.item._updateConnector(this._undoTarget,"target");
}this.item.updateModel();
},redo:function(){if(this._redoSource!==aF){this.item._updateConnector(this._redoSource,"source");
}if(this._redoTarget!==aF){this.item._updateConnector(this._redoTarget,"target");
}this.item.updateModel();
}});
var o=k.extend({init:function(aL,aM,aN){this.item=aL;
this._undoSource=aM;
this._undoTarget=aN;
this._redoSource=aL.source();
this._redoTarget=aL.target();
this.title="Connection Editing";
},undo:function(){this.item._updateConnector(this._undoSource,"source");
this.item._updateConnector(this._undoTarget,"target");
this.item.updateModel();
},redo:function(){this.item._updateConnector(this._redoSource,"source");
this.item._updateConnector(this._redoTarget,"target");
this.item.updateModel();
}});
var A=k.extend({init:function(aL){this.connection=aL;
this.diagram=aL.diagram;
this.targetConnector=aL.targetConnector;
this.title="Delete connection";
},undo:function(){this.diagram._addConnection(this.connection,false);
},redo:function(){this.diagram.remove(this.connection,false);
}});
var B=k.extend({init:function(aL){this.shape=aL;
this.diagram=aL.diagram;
this.title="Deletion";
},undo:function(){this.diagram._addShape(this.shape,false);
this.shape.select(false);
},redo:function(){this.shape.select(false);
this.diagram.remove(this.shape,false);
}});
var aD=k.extend({init:function(aO,aP,aL){this.shapes=aO;
this.undoStates=aP;
this.title="Transformation";
this.redoStates=[];
this.adorner=aL;
for(var aM=0;
aM<this.shapes.length;
aM++){var aN=this.shapes[aM];
this.redoStates.push(aN.bounds());
}},undo:function(){for(var aL=0;
aL<this.shapes.length;
aL++){var aM=this.shapes[aL];
aM.bounds(this.undoStates[aL]);
if(aM.hasOwnProperty("layout")){aM.layout(aM,this.redoStates[aL],this.undoStates[aL]);
}aM.updateModel();
}if(this.adorner){this.adorner.refreshBounds();
this.adorner.refresh();
}},redo:function(){for(var aL=0;
aL<this.shapes.length;
aL++){var aM=this.shapes[aL];
aM.bounds(this.redoStates[aL]);
if(aM.hasOwnProperty("layout")){aM.layout(aM,this.undoStates[aL],this.redoStates[aL]);
}aM.updateModel();
}if(this.adorner){this.adorner.refreshBounds();
this.adorner.refresh();
}}});
var b=k.extend({init:function(aL,aM){this.connection=aL;
this.diagram=aM;
this.title="New connection";
},undo:function(){this.diagram.remove(this.connection,false);
},redo:function(){this.diagram._addConnection(this.connection,false);
}});
var c=k.extend({init:function(aM,aL){this.shape=aM;
this.diagram=aL;
this.title="New shape";
},undo:function(){this.diagram.deselect();
this.diagram.remove(this.shape,false);
},redo:function(){this.diagram._addShape(this.shape,false);
}});
var ad=k.extend({init:function(aN,aM,aL){this.initial=aN;
this.finalPos=aM;
this.diagram=aL;
this.title="Pan Unit";
},undo:function(){this.diagram.pan(this.initial);
},redo:function(){this.diagram.pan(this.finalPos);
}});
var ao=k.extend({init:function(aL,aO,aP){this.shapes=aO;
this.undoRotates=aP;
this.title="Rotation";
this.redoRotates=[];
this.redoAngle=aL._angle;
this.adorner=aL;
this.center=aL._innerBounds.center();
for(var aM=0;
aM<this.shapes.length;
aM++){var aN=this.shapes[aM];
this.redoRotates.push(aN.rotate().angle);
}},undo:function(){var aL,aM;
for(aL=0;
aL<this.shapes.length;
aL++){aM=this.shapes[aL];
aM.rotate(this.undoRotates[aL],this.center,false);
if(aM.hasOwnProperty("layout")){aM.layout(aM);
}aM.updateModel();
}if(this.adorner){this.adorner._initialize();
this.adorner.refresh();
}},redo:function(){var aL,aM;
for(aL=0;
aL<this.shapes.length;
aL++){aM=this.shapes[aL];
aM.rotate(this.redoRotates[aL],this.center,false);
if(aM.hasOwnProperty("layout")){aM.layout(aM);
}aM.updateModel();
}if(this.adorner){this.adorner._initialize();
this.adorner.refresh();
}}});
var aA=k.extend({init:function(aL,aN,aM){this.diagram=aL;
this.indices=aM;
this.items=aN;
this.title="Rotate Unit";
},undo:function(){this.diagram._toIndex(this.items,this.indices);
},redo:function(){this.diagram.toFront(this.items,false);
}});
var az=k.extend({init:function(aL,aN,aM){this.diagram=aL;
this.indices=aM;
this.items=aN;
this.title="Rotate Unit";
},undo:function(){this.diagram._toIndex(this.items,this.indices);
},redo:function(){this.diagram.toBack(this.items,false);
}});
var aG=S.Observable.extend({init:function(aL){S.Observable.fn.init.call(this,aL);
this.bind(this.events,aL);
this.stack=[];
this.index=0;
this.capacity=100;
},events:["undone","redone"],begin:function(){this.composite=new l();
},cancel:function(){this.composite=aF;
},commit:function(aL){if(this.composite.units.length>0){this._restart(this.composite,aL);
}this.composite=aF;
},addCompositeItem:function(aL){if(this.composite){this.composite.add(aL);
}else{this.add(aL);
}},add:function(aM,aL){this._restart(aM,aL);
},pop:function(){if(this.index>0){this.stack.pop();
this.index--;
}},count:function(){return this.stack.length;
},undo:function(){if(this.index>0){this.index--;
this.stack[this.index].undo();
this.trigger("undone");
}},redo:function(){if(this.stack.length>0&&this.index<this.stack.length){this.stack[this.index].redo();
this.index++;
this.trigger("redone");
}},_restart:function(aL,aM){this.stack.splice(this.index,this.stack.length-this.index);
this.stack.push(aL);
if(aM!==false){this.redo();
}else{this.index++;
}if(this.stack.length>this.capacity){this.stack.splice(0,this.stack.length-this.capacity);
this.index=this.capacity;
}},clear:function(){this.stack=[];
this.index=0;
}});
var G=k.extend({init:function(aL){this.toolService=aL;
},start:function(){},move:function(){},end:function(){},tryActivate:function(){return false;
},getCursor:function(){return u.arrow;
}});
var ar=G.extend({init:function(aQ){var aP=this;
var aN=S.support.mobileOS?I:H;
G.fn.init.call(aP,aQ);
var aM=aP.toolService.diagram,aL=aM.canvas;
var aO=aM.scroller=aP.scroller=a(aM.scrollable).kendoMobileScroller({friction:aN,velocityMultiplier:aI,mousewheelScrolling:false,zoom:false,scroll:ai(aP._move,aP)}).data("kendoMobileScroller");
if(aL.translate){aP.movableCanvas=new aa(aL.element);
}var aR=function(aS,aU,aT){aS.makeVirtual();
aS.virtualSize(aU||aq,aT||ap);
};
aR(aO.dimensions.x);
aR(aO.dimensions.y);
aO.disable();
},tryActivate:function(aO,aM){var aP=this.toolService;
var aN=aP.diagram.options.pannable;
var aL=aM.ctrlKey;
if(z(aN.key)){if(!aN.key||aN.key=="none"){aL=ab(aM)&&!z(aP.hoveredItem);
}else{aL=aM[aN.key+"Key"];
}}return aN!==false&&aL&&!z(aP.hoveredAdorner)&&!z(aP._hoveredConnector);
},start:function(){this.scroller.enable();
},move:function(){},_move:function(aL){var aP=this,aN=aP.toolService.diagram,aM=aN.canvas,aO=new ae(aL.scrollLeft,aL.scrollTop);
if(aM.translate){aN._storePan(aO.times(-1));
aP.movableCanvas.moveTo(aO);
aM.translate(aO.x,aO.y);
}else{aO=aO.plus(aN._pan.times(-1));
}aN.trigger(ac,{pan:aO});
},end:function(){this.scroller.disable();
},getCursor:function(){return u.move;
}});
var af=k.extend({init:function(aL){this.toolService=aL;
},tryActivate:function(){return true;
},start:function(aO,aN){var aP=this.toolService,aL=aP.diagram,aM=aP.hoveredItem;
if(aM){aP.selectSingle(aM,aN);
if(aM.adorner){this.adorner=aM.adorner;
this.handle=this.adorner._hitTest(aO);
}}if(!this.handle){this.handle=aL._resizingAdorner._hitTest(aO);
if(this.handle){this.adorner=aL._resizingAdorner;
}}if(this.adorner){if(!this.adorner.isDragHandle(this.handle)||!aL.trigger(F,{shapes:this.adorner.shapes,connections:[]})){this.adorner.start(aO);
}else{aP.startPoint=aO;
aP.end(aO);
}}},move:function(aL){if(this.adorner){this.adorner.move(this.handle,aL);
if(this.adorner.isDragHandle(this.handle)){this.toolService.diagram.trigger(D,{shapes:this.adorner.shapes,connections:[]});
}}},end:function(){var aM=this.toolService.diagram,aL=this.adorner,aN;
if(aL){if(!aL.isDragHandle(this.handle)||!aM.trigger(E,{shapes:aL.shapes,connections:[]})){aN=aL.stop();
if(aN){aM.undoRedoService.add(aN,false);
}}else{aL.cancel();
}}this.adorner=aF;
this.handle=aF;
},getCursor:function(aL){return this.toolService.hoveredItem?this.toolService.hoveredItem._getCursor(aL):u.arrow;
}});
var at=k.extend({init:function(aL){this.toolService=aL;
},tryActivate:function(aN,aM){var aP=this.toolService;
var aO=aP.diagram.options.selectable;
var aL=aO&&aO.multiple!==false;
if(aL){if(aO.key&&aO.key!="none"){aL=aM[aO.key+"Key"];
}else{aL=ab(aM);
}}return aL&&!z(aP.hoveredItem)&&!z(aP.hoveredAdorner);
},start:function(aM){var aL=this.toolService.diagram;
aL.deselect();
aL.selector.start(aM);
},move:function(aM){var aL=this.toolService.diagram;
aL.selector.move(aM);
},end:function(aO,aN){var aL=this.toolService.diagram,aM=this.toolService.hoveredItem;
var aP=aL.selector.bounds();
if((!aM||!aM.isSelected)&&!aN.ctrlKey){aL.deselect();
}if(!aP.isEmpty()){aL.selectArea(aP);
}aL.selector.end();
},getCursor:function(){return u.arrow;
}});
var r=k.extend({init:function(aL){this.toolService=aL;
this.type="ConnectionTool";
},tryActivate:function(){return this.toolService._hoveredConnector;
},start:function(aP,aO){var aQ=this.toolService,aN=aQ.diagram,aM=aQ._hoveredConnector,aL=aN._createConnection({},aM._c,aP);
if(h(aL)&&!aN.trigger(F,{shapes:[],connections:[aL],connectionHandle:aw})&&aN._addConnection(aL)){aQ._connectionManipulation(aL,aM._c.shape,true);
aQ._removeHover();
aQ.selectSingle(aQ.activeConnection,aO);
}else{aL.source(null);
aQ.end(aP);
}},move:function(aM){var aN=this.toolService;
var aL=aN.activeConnection;
aL.target(aM);
aN.diagram.trigger(D,{shapes:[],connections:[aL],connectionHandle:aw});
return true;
},end:function(aP){var aR=this.toolService,aN=aR.diagram,aL=aR.activeConnection,aO=aR.hoveredItem,aM=aR._hoveredConnector,aQ;
if(!aL){return;
}if(aM&&aM._c!=aL.sourceConnector){aQ=aM._c;
}else{if(aO&&aO instanceof C.Shape){aQ=aO.getConnector(e)||aO.getConnector(aP);
}else{aQ=aP;
}}aL.target(aQ);
if(!aN.trigger(E,{shapes:[],connections:[aL],connectionHandle:aw})){aL.updateModel();
aN._syncConnectionChanges();
}else{aN.remove(aL,false);
aN.undoRedoService.pop();
}aR._connectionManipulation();
},getCursor:function(){return u.arrow;
}});
var n=k.extend({init:function(aL){this.toolService=aL;
this.type="ConnectionTool";
},tryActivate:function(aP,aO){var aR=this.toolService,aL=aR.diagram,aQ=aL.options.selectable,aN=aR.hoveredItem,aM=aQ!==false&&aN&&aN.path&&!(aN.isSelected&&aO.ctrlKey);
if(aM){this._c=aN;
}return aM;
},start:function(aQ,aO){var aR=this.toolService;
var aM=this._c;
aR.selectSingle(aM,aO);
var aL=aM.adorner;
var aN,aP;
if(aL){aN=aL._hitTest(aQ);
aP=K[aN];
}if(h(aM)&&aL&&!aR.diagram.trigger(F,{shapes:[],connections:[aM],connectionHandle:aP})){this.handle=aN;
this.handleName=aP;
aL.start(aQ);
}else{aR.startPoint=aQ;
aR.end(aQ);
}},move:function(aM){var aL=this._c.adorner;
if(h(this._c)&&aL){aL.move(this.handle,aM);
this.toolService.diagram.trigger(D,{shapes:[],connections:[this._c],connectionHandle:this.handleName});
return true;
}},end:function(aO){var aM=this._c;
var aL=aM.adorner;
var aP=this.toolService;
var aN=aP.diagram;
if(aL){if(h(aM)){var aQ=aL.stop(aO);
if(!aN.trigger(E,{shapes:[],connections:[aM],connectionHandle:this.handleName})){aN.undoRedoService.add(aQ,false);
aM.updateModel();
aN._syncConnectionChanges();
}else{aQ.undo();
}}}},getCursor:function(){return u.move;
}});
function ax(aL,aM){return aM.charCodeAt(0)==aL||aM.toUpperCase().charCodeAt(0)==aL;
}var aB=k.extend({init:function(aL){this.diagram=aL;
this.tools=[new ar(this),new n(this),new r(this),new at(this),new af(this)];
this.activeTool=aF;
},start:function(aM,aL){aL=w({},aL);
if(this.activeTool){this.activeTool.end(aM,aL);
}this._updateHoveredItem(aM);
this._activateTool(aM,aL);
this.activeTool.start(aM,aL);
this._updateCursor(aM);
this.diagram.focus();
this.diagram.canvas.surface.suspendTracking();
this.startPoint=aM;
return true;
},move:function(aM,aL){aL=w({},aL);
var aN=true;
if(this.activeTool){aN=this.activeTool.move(aM,aL);
}if(aN){this._updateHoveredItem(aM);
}this._updateCursor(aM);
return true;
},end:function(aM,aL){aL=w({},aL);
if(this.activeTool){this.activeTool.end(aM,aL);
}this.diagram.canvas.surface.resumeTracking();
this.activeTool=aF;
this._updateCursor(aM);
return true;
},keyDown:function(aM,aN){var aL=this.diagram;
aN=w({ctrlKey:false,metaKey:false,altKey:false},aN);
if((aN.ctrlKey||aN.metaKey)&&!aN.altKey){if(ax(aM,"a")){aL.selectAll();
aL._destroyToolBar();
return true;
}else{if(ax(aM,"z")){aL.undo();
aL._destroyToolBar();
return true;
}else{if(ax(aM,"y")){aL.redo();
aL._destroyToolBar();
return true;
}else{if(ax(aM,"c")){aL.copy();
aL._destroyToolBar();
}else{if(ax(aM,"x")){aL.cut();
aL._destroyToolBar();
}else{if(ax(aM,"v")){aL.paste();
aL._destroyToolBar();
}else{if(ax(aM,"l")){aL.layout();
aL._destroyToolBar();
}else{if(ax(aM,"d")){aL._destroyToolBar();
aL.copy();
aL.paste();
}}}}}}}}}else{if(aM===46||aM===8){var aO=this.diagram._triggerRemove(aL.select());
if(aO.length){this.diagram.remove(aO,true);
this.diagram._syncChanges();
this.diagram._destroyToolBar();
}return true;
}else{if(aM===27){this._discardNewConnection();
aL.deselect();
aL._destroyToolBar();
return true;
}}}},wheel:function(aP,aN){var aM=this.diagram,aL=aN.delta,aQ=aM.zoom(),aO=aM.options,aS=aO.zoomRate,aR={point:aP,meta:aN,zoom:aQ};
if(aM.trigger(aK,aR)){return;
}if(aL<0){aQ+=aS;
}else{aQ-=aS;
}aQ=S.dataviz.round(Math.max(aO.zoomMin,Math.min(aO.zoomMax,aQ)),2);
aR.zoom=aQ;
aM.zoom(aQ,aR);
aM.trigger(aJ,aR);
return true;
},setTool:function(aM,aL){aM.toolService=this;
this.tools[aL]=aM;
},selectSingle:function(aN,aO){var aM=this.diagram;
var aP=aM.options.selectable;
if(aP&&!aN.isSelected&&aN.options.selectable!==false){var aL=aO.ctrlKey&&aP.multiple!==false;
aM.select(aN,{addToSelection:aL});
}},_discardNewConnection:function(){if(this.newConnection){this.diagram.remove(this.newConnection);
this.newConnection=aF;
}},_activateTool:function(aN,aM){for(var aL=0;
aL<this.tools.length;
aL++){var aO=this.tools[aL];
if(aO.tryActivate(aN,aM)){this.activeTool=aO;
break;
}}},_updateCursor:function(aN){var aM=this.diagram.element;
var aL=this.activeTool?this.activeTool.getCursor(aN):this.hoveredAdorner?this.hoveredAdorner._getCursor(aN):this.hoveredItem?this.hoveredItem._getCursor(aN):u.arrow;
aM.css({cursor:aL});
if(g.msie&&g.version==7){aM[0].style.cssText=aM[0].style.cssText;
}},_connectionManipulation:function(aL,aM,aN){this.activeConnection=aL;
this.disabledShape=aM;
if(aN){this.newConnection=this.activeConnection;
}else{this.newConnection=aF;
}},_updateHoveredItem:function(aN){var aM=this._hitTest(aN);
var aL=this.diagram;
if(aM!=this.hoveredItem&&(!this.disabledShape||aM!=this.disabledShape)){if(this.hoveredItem){aL.trigger(Z,{item:this.hoveredItem});
this.hoveredItem._hover(false);
}if(aM&&aM.options.enable){aL.trigger(Y,{item:aM});
this.hoveredItem=aM;
this.hoveredItem._hover(true);
}else{this.hoveredItem=aF;
}}},_removeHover:function(){if(this.hoveredItem){this.hoveredItem._hover(false);
this.hoveredItem=aF;
}},_hitTest:function(aP){var aM,aL=this.diagram,aO,aN;
if(this._hoveredConnector){this._hoveredConnector._hover(false);
this._hoveredConnector=aF;
}if(aL._connectorsAdorner._visible){aM=aL._connectorsAdorner._hitTest(aP);
if(aM){return aM;
}}aM=this.diagram._resizingAdorner._hitTest(aP);
if(aM){this.hoveredAdorner=aL._resizingAdorner;
if(aM.x!==0||aM.y!==0){return;
}aM=aF;
}else{this.hoveredAdorner=aF;
}if(!this.activeTool||this.activeTool.type!=="ConnectionTool"){var aQ=[];
for(aN=0;
aN<aL._selectedItems.length;
aN++){aO=aL._selectedItems[aN];
if(aO instanceof C.Connection){aQ.push(aO);
}}aM=this._hitTestItems(aQ,aP);
}return aM||this._hitTestElements(aP);
},_hitTestElements:function(aQ){var aN=this.diagram;
var aR=this._hitTestItems(aN.shapes,aQ);
var aL=this._hitTestItems(aN.connections,aQ);
var aO;
if((!this.activeTool||this.activeTool.type!="ConnectionTool")&&aR&&aL&&!M(aR,aQ)){var aP=aN.mainLayer;
var aS=O(aR.visual,aP.children);
var aM=O(aL.visual,aP.children);
aO=aS>aM?aR:aL;
}return aO||aR||aL;
},_hitTestItems:function(aL,aP){var aN,aO,aM;
for(aN=aL.length-1;
aN>=0;
aN--){aO=aL[aN];
aM=aO._hitTest(aP);
if(aM){return aM;
}}}});
var q=S.Class.extend({init:function(){}});
var V=q.extend({init:function(aL){var aM=this;
q.fn.init.call(aM);
this.connection=aL;
},hitTest:function(aL){var aM=this.getBounds().inflate(L);
if(!aM.contains(aL)){return false;
}return C.Geometry.distanceToPolyline(aL,this.connection.allPoints())<L;
},getBounds:function(){var aP=this.connection.allPoints(),aR=aP[0],aM=aP[aP.length-1],aQ=Math.max(aR.x,aM.x),aO=Math.min(aR.x,aM.x),aS=Math.min(aR.y,aM.y),aL=Math.max(aR.y,aM.y);
for(var aN=1;
aN<aP.length-1;
++aN){aQ=Math.max(aQ,aP[aN].x);
aO=Math.min(aO,aP[aN].x);
aS=Math.min(aS,aP[aN].y);
aL=Math.max(aL,aP[aN].y);
}return new aj(aO,aS,aQ-aO,aL-aS);
}});
var ag=V.extend({init:function(aL){var aM=this;
V.fn.init.call(aM);
this.connection=aL;
},route:function(){}});
var i=V.extend({SAME_SIDE_DISTANCE_RATIO:5,init:function(aL){var aM=this;
V.fn.init.call(aM);
this.connection=aL;
},routePoints:function(aO,aL,aN,aP){var aM;
if(aN&&aP){aM=this._connectorPoints(aO,aL,aN,aP);
}else{aM=this._floatingPoints(aO,aL,aN);
}return aM;
},route:function(){var aN=this.connection._resolvedSourceConnector;
var aP=this.connection._resolvedTargetConnector;
var aO=this.connection.sourcePoint();
var aL=this.connection.targetPoint();
var aM=this.routePoints(aO,aL,aN,aP);
this.connection.points(aM);
},_connectorSides:[{name:"Top",axis:"y",boundsPoint:"topLeft",secondarySign:1},{name:"Left",axis:"x",boundsPoint:"topLeft",secondarySign:1},{name:"Bottom",axis:"y",boundsPoint:"bottomRight",secondarySign:-1},{name:"Right",axis:"x",boundsPoint:"bottomRight",secondarySign:-1}],_connectorSide:function(aN,aW){var aR=aN.position();
var aS=aN.shape.bounds(an);
var aM={topLeft:aS.topLeft(),bottomRight:aS.bottomRight()};
var aV=this._connectorSides;
var aP=S.util.MAX_NUM;
var aU;
var aQ;
var aL;
var aT;
for(var aO=0;
aO<aV.length;
aO++){aT=aV[aO];
aL=aT.axis;
aU=Math.round(Math.abs(aR[aL]-aM[aT.boundsPoint][aL]));
if(aU<aP){aP=aU;
aQ=aT;
}else{if(aU===aP&&(aR[aL]-aW[aL])*aT.secondarySign>(aR[aQ.axis]-aW[aQ.axis])*aQ.secondarySign){aQ=aT;
}}}return aQ.name;
},_sameSideDistance:function(aM){var aL=aM.shape.bounds(an);
return Math.min(aL.width,aL.height)/this.SAME_SIDE_DISTANCE_RATIO;
},_connectorPoints:function(aU,aN,aS,aV){var aT=this._connectorSide(aS,aN);
var aW=this._connectorSide(aV,aU);
var aL=aN.x-aU.x;
var aM=aN.y-aU.y;
var aR=this._sameSideDistance(aS);
var aQ=[];
var aO,aP;
if(aT===aC||aT==f){if(aW==aC||aW==f){if(aT==aW){if(aT==aC){aP=Math.min(aU.y,aN.y)-aR;
}else{aP=Math.max(aU.y,aN.y)+aR;
}aQ=[new ae(aU.x,aP),new ae(aN.x,aP)];
}else{aQ=[new ae(aU.x,aU.y+aM/2),new ae(aN.x,aU.y+aM/2)];
}}else{aQ=[new ae(aU.x,aN.y)];
}}else{if(aW==U||aW==am){if(aT==aW){if(aT==U){aO=Math.min(aU.x,aN.x)-aR;
}else{aO=Math.max(aU.x,aN.x)+aR;
}aQ=[new ae(aO,aU.y),new ae(aO,aN.y)];
}else{aQ=[new ae(aU.x+aL/2,aU.y),new ae(aU.x+aL/2,aU.y+aM)];
}}else{aQ=[new ae(aN.x,aU.y)];
}}return aQ;
},_floatingPoints:function(aW,aO,aU){var aV=aU?this._connectorSide(aU,aO):null;
var aL=this._startHorizontal(aW,aO,aV);
var aR=[aW,aW,aO,aO];
var aM=aO.x-aW.x;
var aN=aO.y-aW.y;
var aQ=aR.length;
var aS;
var aT;
for(var aP=1;
aP<aQ-1;
++aP){if(aL){if(aP%2!==0){aS=aM/(aQ/2);
aT=0;
}else{aS=0;
aT=aN/((aQ-1)/2);
}}else{if(aP%2!==0){aS=0;
aT=aN/(aQ/2);
}else{aS=aM/((aQ-1)/2);
aT=0;
}}aR[aP]=new ae(aR[aP-1].x+aS,aR[aP-1].y+aT);
}aP--;
if(aL&&aP%2!==0||!aL&&aP%2===0){aR[aQ-2]=new ae(aR[aQ-1].x,aR[aQ-2].y);
}else{aR[aQ-2]=new ae(aR[aQ-2].x,aR[aQ-1].y);
}return[aR[1],aR[2]];
},_startHorizontal:function(aO,aL,aN){var aM;
if(aN!==null&&(aN===am||aN===U)){aM=true;
}else{aM=Math.abs(aO.x-aL.x)>Math.abs(aO.y-aL.y);
}return aM;
}});
var d=k.extend({init:function(aL,aM){var aN=this;
aN.diagram=aL;
aN.options=w({},aN.options,aM);
aN.visual=new J();
aN.diagram._adorners.push(aN);
},refresh:function(){}});
var m=d.extend({init:function(aL,aN){var aP=this,aM;
aP.connection=aL;
aM=aP.connection.diagram;
aP._ts=aM.toolService;
d.fn.init.call(aP,aM,aN);
var aO=aP.connection.sourcePoint();
var aQ=aP.connection.targetPoint();
aP.spVisual=new j(w(aP.options.handles,{center:aO}));
aP.epVisual=new j(w(aP.options.handles,{center:aQ}));
aP.visual.append(aP.spVisual);
aP.visual.append(aP.epVisual);
},options:{handles:{}},_getCursor:function(){return u.move;
},start:function(aL){this.handle=this._hitTest(aL);
this.startPoint=aL;
this._initialSource=this.connection.source();
this._initialTarget=this.connection.target();
switch(this.handle){case -1:if(this.connection.targetConnector){this._ts._connectionManipulation(this.connection,this.connection.targetConnector.shape);
}break;
case 1:if(this.connection.sourceConnector){this._ts._connectionManipulation(this.connection,this.connection.sourceConnector.shape);
}break;
}},move:function(aM,aN){switch(aM){case -1:this.connection.source(aN);
break;
case 1:this.connection.target(aN);
break;
default:var aL=aN.minus(this.startPoint);
this.startPoint=aN;
if(!this.connection.sourceConnector){this.connection.source(this.connection.sourcePoint().plus(aL));
}if(!this.connection.targetConnector){this.connection.target(this.connection.targetPoint().plus(aL));
}break;
}this.refresh();
return true;
},stop:function(aM){var aO=this.diagram.toolService,aL=aO.hoveredItem,aN;
if(aO._hoveredConnector){aN=aO._hoveredConnector._c;
}else{if(aL&&aL instanceof C.Shape){aN=aL.getConnector(e)||aL.getConnector(aM);
}else{aN=aM;
}}if(this.handle===-1){this.connection.source(aN);
}else{if(this.handle===1){this.connection.target(aN);
}}this.handle=aF;
this._ts._connectionManipulation();
return new o(this.connection,this._initialSource,this._initialTarget);
},_hitTest:function(aM){var aQ=this.connection.sourcePoint();
var aT=this.connection.targetPoint();
var aN=this.options.handles.width/2+L;
var aO=this.options.handles.height/2+L;
var aR=aQ.distanceTo(aM);
var aU=aT.distanceTo(aM);
var aP=new aj(aQ.x,aQ.y).inflate(aN,aO).contains(aM);
var aS=new aj(aT.x,aT.y).inflate(aN,aO).contains(aM);
var aL=0;
if(aP&&(!aS||aR<aU)){aL=-1;
}else{if(aS&&(!aP||aU<aR)){aL=1;
}}return aL;
},refresh:function(){this.spVisual.redraw({center:this.diagram.modelToLayer(this.connection.sourcePoint())});
this.epVisual.redraw({center:this.diagram.modelToLayer(this.connection.targetPoint())});
}});
var s=d.extend({init:function(aL,aM){var aN=this;
d.fn.init.call(aN,aL,aM);
aN._refreshHandler=function(aO){if(aO.item==aN.shape){aN.refresh();
}};
},show:function(aO){var aP=this,aN,aM,aL;
aP._visible=true;
aP.shape=aO;
aP.diagram.bind(Q,aP._refreshHandler);
aN=aO.connectors.length;
aP.connectors=[];
aP.visual.clear();
for(aM=0;
aM<aN;
aM++){aL=new t(aO.connectors[aM]);
aP.connectors.push(aL);
aP.visual.append(aL.visual);
}aP.visual.visible(true);
aP.refresh();
},destroy:function(){var aL=this;
aL.diagram.unbind(Q,aL._refreshHandler);
aL.shape=aF;
aL._visible=aF;
aL.visual.visible(false);
},_hitTest:function(aN){var aL,aM;
for(aM=0;
aM<this.connectors.length;
aM++){aL=this.connectors[aM];
if(aL._hitTest(aN)){aL._hover(true);
this.diagram.toolService._hoveredConnector=aL;
break;
}}},refresh:function(){if(this.shape){var aL=this.shape.bounds();
aL=this.diagram.modelToLayer(aL);
this.visual.position(aL.topLeft());
a.each(this.connectors,function(){this.refresh();
});
}}});
function N(aM,aL){var aN;
if(aM.x==-1&&aM.y==-1){aN=aL.bottomRight();
}else{if(aM.x==1&&aM.y==1){aN=aL.topLeft();
}else{if(aM.x==-1&&aM.y==1){aN=aL.topRight();
}else{if(aM.x==1&&aM.y==-1){aN=aL.bottomLeft();
}else{if(aM.x===0&&aM.y==-1){aN=aL.bottom();
}else{if(aM.x===0&&aM.y==1){aN=aL.top();
}else{if(aM.x==1&&aM.y===0){aN=aL.left();
}else{if(aM.x==-1&&aM.y===0){aN=aL.right();
}}}}}}}}return aN;
}var al=d.extend({init:function(aL,aM){var aN=this;
d.fn.init.call(aN,aL,aM);
aN._manipulating=false;
aN.map=[];
aN.shapes=[];
aN._initSelection();
aN._createHandles();
aN.redraw();
aN.diagram.bind("select",function(aO){aN._initialize(aO.selected);
});
aN._refreshHandler=function(){if(!aN._internalChange){aN.refreshBounds();
aN.refresh();
}};
aN._rotatedHandler=function(){if(aN.shapes.length==1){aN._angle=aN.shapes[0].rotate().angle;
}aN._refreshHandler();
};
aN.diagram.bind(Q,aN._refreshHandler).bind(R,aN._rotatedHandler);
aN.refreshBounds();
aN.refresh();
},options:{handles:{fill:{color:"#fff"},stroke:{color:"#282828"},height:7,width:7,hover:{fill:{color:"#282828"},stroke:{color:"#282828"}}},selectable:{stroke:{color:"#778899",width:1,dashType:"dash"},fill:{color:aE}},offset:10},_initSelection:function(){var aO=this;
var aL=aO.diagram;
var aN=aL.options.selectable;
var aM=w({},aO.options.selectable,aN);
aO.rect=new ak(aM);
aO.visual.append(aO.rect);
},_resizable:function(){return this.options.editable&&this.options.editable.resize!==false;
},_handleOptions:function(){return(this.options.editable.resize||{}).handles||this.options.handles;
},_createHandles:function(){var aL,aM,aO,aN;
if(this._resizable()){aL=this._handleOptions();
for(aN=-1;
aN<=1;
aN++){for(aO=-1;
aO<=1;
aO++){if(aN!==0||aO!==0){aM=new ak(aL);
aM.drawingElement._hover=ai(this._hover,this);
this.map.push({x:aN,y:aO,visual:aM});
this.visual.append(aM);
}}}}},bounds:function(aL){if(aL){this._innerBounds=aL.clone();
this._bounds=this.diagram.modelToLayer(aL).inflate(this.options.offset,this.options.offset);
}else{return this._bounds;
}},_hitTest:function(aQ){var aR=this.diagram.modelToLayer(aQ),aP,aO,aM,aN=this.map.length,aL;
if(this._angle){aR=aR.clone().rotate(this._bounds.center(),this._angle);
}if(this._resizable()){for(aP=0;
aP<aN;
aP++){aL=this.map[aP];
aO=new ae(aL.x,aL.y);
aM=this._getHandleBounds(aO);
aM.offset(this._bounds.x,this._bounds.y);
if(aM.contains(aR)){return aO;
}}}if(this._bounds.contains(aR)){return new ae(0,0);
}},_getHandleBounds:function(aN){if(this._resizable()){var aM=this._handleOptions(),aP=aM.width,aL=aM.height,aO=new aj(0,0,aP,aL);
if(aN.x<0){aO.x=-aP/2;
}else{if(aN.x===0){aO.x=Math.floor(this._bounds.width/2)-aP/2;
}else{if(aN.x>0){aO.x=this._bounds.width+1-aP/2;
}}}if(aN.y<0){aO.y=-aL/2;
}else{if(aN.y===0){aO.y=Math.floor(this._bounds.height/2)-aL/2;
}else{if(aN.y>0){aO.y=this._bounds.height+1-aL/2;
}}}return aO;
}},_getCursor:function(aN){var aM=this._hitTest(aN);
if(aM&&aM.x>=-1&&aM.x<=1&&aM.y>=-1&&aM.y<=1&&this._resizable()){var aL=this._angle;
if(aL){aL=360-aL;
aM.rotate(new ae(0,0),aL);
aM=new ae(Math.round(aM.x),Math.round(aM.y));
}if(aM.x==-1&&aM.y==-1){return"nw-resize";
}if(aM.x==1&&aM.y==1){return"se-resize";
}if(aM.x==-1&&aM.y==1){return"sw-resize";
}if(aM.x==1&&aM.y==-1){return"ne-resize";
}if(aM.x===0&&aM.y==-1){return"n-resize";
}if(aM.x===0&&aM.y==1){return"s-resize";
}if(aM.x==1&&aM.y===0){return"e-resize";
}if(aM.x==-1&&aM.y===0){return"w-resize";
}}return this._manipulating?u.move:u.select;
},_initialize:function(){var aO=this,aL,aM,aN=aO.diagram.select();
aO.shapes=[];
for(aL=0;
aL<aN.length;
aL++){aM=aN[aL];
if(aM instanceof C.Shape){aO.shapes.push(aM);
aM._rotationOffset=new ae();
}}aO._angle=aO.shapes.length==1?aO.shapes[0].rotate().angle:0;
aO._startAngle=aO._angle;
aO._rotates();
aO._positions();
aO.refreshBounds();
aO.refresh();
aO.redraw();
},_rotates:function(){var aN=this,aL,aM;
aN.initialRotates=[];
for(aL=0;
aL<aN.shapes.length;
aL++){aM=aN.shapes[aL];
aN.initialRotates.push(aM.rotate().angle);
}},_positions:function(){var aN=this,aL,aM;
aN.initialStates=[];
for(aL=0;
aL<aN.shapes.length;
aL++){aM=aN.shapes[aL];
aN.initialStates.push(aM.bounds());
}},_hover:function(aQ,aL){if(this._resizable()){var aN=this._handleOptions(),aO=aN.hover,aP=aN.stroke,aM=aN.fill;
if(aQ&&aH.isDefined(aO.stroke)){aP=w({},aP,aO.stroke);
}if(aQ&&aH.isDefined(aO.fill)){aM=aO.fill;
}aL.stroke(aP.color,aP.width,aP.opacity);
aL.fill(aM.color,aM.opacity);
}},start:function(aM){this._sp=aM;
this._cp=aM;
this._lp=aM;
this._manipulating=true;
this._internalChange=true;
this.shapeStates=[];
for(var aL=0;
aL<this.shapes.length;
aL++){var aN=this.shapes[aL];
this.shapeStates.push(aN.bounds());
}},redraw:function(){var aM,aL,aN=this._resizable();
for(aM=0;
aM<this.map.length;
aM++){aL=this.map[aM];
aL.visual.visible(aN);
}},angle:function(aL){if(z(aL)){this._angle=aL;
}return this._angle;
},rotate:function(){var aL=this._innerBounds.center();
var aM=this.angle();
this._internalChange=true;
for(var aN=0;
aN<this.shapes.length;
aN++){var aO=this.shapes[aN];
aM=(aM+this.initialRotates[aN]-this._startAngle)%360;
aO.rotate(aM,aL);
}this.refresh();
},move:function(aT,aY){var aQ,aR,aS=new ae(),aP=new ae(),aM,aN,a1,aU,aL,aV,aO=0,a2,aZ,a0;
if(aT.y===-2&&aT.x===-1){aN=this._innerBounds.center();
this._angle=this._truncateAngle(aH.findAngle(aN,aY));
for(aU=0;
aU<this.shapes.length;
aU++){a1=this.shapes[aU];
aL=(this._angle+this.initialRotates[aU]-this._startAngle)%360;
a1.rotate(aL,aN);
if(a1.hasOwnProperty("layout")){a1.layout(a1);
}this._rotating=true;
}this.refresh();
}else{if(this.shouldSnap()){var a3=this._truncateDistance(aY.minus(this._lp));
if(a3.x===0&&a3.y===0){this._cp=aY;
return;
}aQ=a3;
this._lp=new ae(this._lp.x+a3.x,this._lp.y+a3.y);
}else{aQ=aY.minus(this._cp);
}if(this.isDragHandle(aT)){aP=aS=aQ;
aR=true;
}else{if(this._angle){aQ.rotate(new ae(0,0),this._angle);
}if(aT.x==-1){aS.x=aQ.x;
}else{if(aT.x==1){aP.x=aQ.x;
}}if(aT.y==-1){aS.y=aQ.y;
}else{if(aT.y==1){aP.y=aQ.y;
}}}if(!aR){a2=N(aT,this._innerBounds);
aZ=(this._innerBounds.width+aQ.x*aT.x)/this._innerBounds.width;
a0=(this._innerBounds.height+aQ.y*aT.y)/this._innerBounds.height;
}for(aU=0;
aU<this.shapes.length;
aU++){a1=this.shapes[aU];
aM=a1.bounds();
if(aR){if(!h(a1)){continue;
}aV=this._displaceBounds(aM,aS,aP,aR);
}else{aV=aM.clone();
aV.scale(aZ,a0,a2,this._innerBounds.center(),a1.rotate().angle);
var aW=aV.center();
aW.rotate(aM.center(),-this._angle);
aV=new aj(aW.x-aV.width/2,aW.y-aV.height/2,aV.width,aV.height);
}if(aV.width>=a1.options.minWidth&&aV.height>=a1.options.minHeight){var aX=aM;
a1.bounds(aV);
if(a1.hasOwnProperty("layout")){a1.layout(a1,aX,aV);
}if(aX.width!==aV.width||aX.height!==aV.height){a1.rotate(a1.rotate().angle);
}aO+=1;
}}if(aO){if(aO==aU){aV=this._displaceBounds(this._innerBounds,aS,aP,aR);
this.bounds(aV);
}else{this.refreshBounds();
}this.refresh();
}this._positions();
}this._cp=aY;
},isDragHandle:function(aL){return aL.x===0&&aL.y===0;
},cancel:function(){var aM=this.shapes;
var aN=this.shapeStates;
for(var aL=0;
aL<aM.length;
aL++){aM[aL].bounds(aN[aL]);
}this.refreshBounds();
this.refresh();
this._manipulating=aF;
this._internalChange=aF;
this._rotating=aF;
},_truncatePositionToGuides:function(aL){if(this.diagram.ruler){return this.diagram.ruler.truncatePositionToGuides(aL);
}return aL;
},_truncateSizeToGuides:function(aL){if(this.diagram.ruler){return this.diagram.ruler.truncateSizeToGuides(aL);
}return aL;
},_truncateAngle:function(aL){var aM=this.snapOptions();
var aN=Math.max(aM.angle||x,W);
return aM?Math.floor(aL%360/aN)*aN:aL%360;
},_truncateDistance:function(aL){if(aL instanceof C.Point){return new C.Point(this._truncateDistance(aL.x),this._truncateDistance(aL.y));
}else{var aM=this.snapOptions()||{};
var aN=Math.max(aM.size||y,X);
return aM?Math.floor(aL/aN)*aN:aL;
}},snapOptions:function(){var aL=this.diagram.options.editable;
var aM=((aL||{}).drag||{}).snap||{};
return aM;
},shouldSnap:function(){var aM=this.diagram.options.editable;
var aL=(aM||{}).drag;
var aN=(aL||{}).snap;
return aM!==false&&aL!==false&&aN!==false;
},_displaceBounds:function(aL,aP,aN,aO){var aS=aL.topLeft().plus(aP),aM=aL.bottomRight().plus(aN),aQ=aj.fromPoints(aS,aM),aR;
if(!aO){aR=aQ.center();
aR.rotate(aL.center(),-this._angle);
aQ=new aj(aR.x-aQ.width/2,aR.y-aQ.height/2,aQ.width,aQ.height);
}return aQ;
},stop:function(){var aO,aM,aN;
if(this._cp!=this._sp){if(this._rotating){aO=new ao(this,this.shapes,this.initialRotates);
this._rotating=false;
}else{if(this._diffStates()){if(this.diagram.ruler){for(aM=0;
aM<this.shapes.length;
aM++){aN=this.shapes[aM];
var aL=aN.bounds();
aL=this._truncateSizeToGuides(this._truncatePositionToGuides(aL));
aN.bounds(aL);
this.refreshBounds();
this.refresh();
}}for(aM=0;
aM<this.shapes.length;
aM++){aN=this.shapes[aM];
aN.updateModel();
}aO=new aD(this.shapes,this.shapeStates,this);
this.diagram._syncShapeChanges();
}}}this._manipulating=aF;
this._internalChange=aF;
this._rotating=aF;
return aO;
},_diffStates:function(){var aM=this.shapes;
var aN=this.shapeStates;
for(var aL=0;
aL<aM.length;
aL++){if(!aM[aL].bounds().equals(aN[aL])){return true;
}}return false;
},refreshBounds:function(){var aL=this.shapes.length==1?this.shapes[0].bounds().clone():this.diagram.boundingBox(this.shapes,true);
this.bounds(aL);
},refresh:function(){var aO=this,aL,aM;
if(this.shapes.length>0){aM=this.bounds();
this.visual.visible(true);
this.visual.position(aM.topLeft());
a.each(this.map,function(){aL=aO._getHandleBounds(new ae(this.x,this.y));
this.visual.position(aL.topLeft());
});
this.visual.position(aM.topLeft());
var aN=new ae(aM.width/2,aM.height/2);
this.visual.rotate(this._angle,aN);
this.rect.redraw({width:aM.width,height:aM.height});
if(this.rotationThumb){var aP=this.options.editable.rotate.thumb;
this._rotationThumbBounds=new aj(aM.center().x,aM.y+aP.y,0,0).inflate(aP.width);
this.rotationThumb.redraw({x:aM.width/2-aP.width/2});
}}else{this.visual.visible(false);
}}});
var au=k.extend({init:function(aL){var aM=aL.options.selectable;
this.options=w({},this.options,aM);
this.visual=new ak(this.options);
this.diagram=aL;
},options:{stroke:{color:"#778899",width:1,dashType:"dash"},fill:{color:aE}},start:function(aL){this._sp=this._ep=aL;
this.refresh();
this.diagram._adorn(this,true);
},end:function(){this._sp=this._ep=aF;
this.diagram._adorn(this,false);
},bounds:function(aL){if(aL){this._bounds=aL;
}return this._bounds;
},move:function(aL){this._ep=aL;
this.refresh();
},refresh:function(){if(this._sp){var aL=aj.fromPoints(this.diagram.modelToLayer(this._sp),this.diagram.modelToLayer(this._ep));
this.bounds(aj.fromPoints(this._sp,this._ep));
this.visual.position(aL.topLeft());
this.visual.redraw({height:aL.height+1,width:aL.width+1});
}}});
var t=k.extend({init:function(aL){this.options=w({},aL.options);
this._c=aL;
this.visual=new j(this.options);
this.refresh();
},_hover:function(aP){var aN=this.options,aM=aN.hover,aO=aN.stroke,aL=aN.fill;
if(aP&&aH.isDefined(aM.stroke)){aO=w({},aO,aM.stroke);
}if(aP&&aH.isDefined(aM.fill)){aL=aM.fill;
}this.visual.redraw({stroke:aO,fill:aL});
},refresh:function(){var aL=this._c.shape.diagram.modelToView(this._c.position()),aM=aL.minus(this._c.shape.bounds("transformed").topLeft()),aN=new aj(aL.x,aL.y,0,0);
aN.inflate(this.options.width/2,this.options.height/2);
this._visualBounds=aN;
this.visual.redraw({center:new ae(aM.x,aM.y)});
},_hitTest:function(aL){var aM=this._c.shape.diagram.modelToView(aL);
return this._visualBounds.contains(aM);
}});
function h(aM){var aL=aM.options.editable;
return aL&&aL.drag!==false;
}function M(aQ,aN){var aL,aO,aP;
for(var aM=0;
aM<aQ.connectors.length;
aM++){aL=aQ.connectors[aM];
aO=aL.position();
aP=new aj(aO.x,aO.y);
aP.inflate(L,L);
if(aP.contains(aN)){return aL;
}}}function ab(aL){return aL.ctrlKey===false&&aL.altKey===false&&aL.shiftKey===false;
}w(C,{CompositeUnit:l,TransformUnit:aD,PanUndoUnit:ad,AddShapeUnit:c,AddConnectionUnit:b,DeleteShapeUnit:B,DeleteConnectionUnit:A,ConnectionEditAdorner:m,ConnectionTool:r,ConnectorVisual:t,UndoRedoService:aG,ResizingAdorner:al,Selector:au,ToolService:aB,ConnectorsAdorner:s,LayoutUndoUnit:T,ConnectionEditUnit:p,ToFrontUnit:aA,ToBackUnit:az,ConnectionRouterBase:q,PolylineRouter:ag,CascadingRouter:i,SelectionTool:at,ScrollerTool:ar,PointerTool:af,ConnectionEditTool:n,RotateUnit:ao});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("dataviz/diagram/layout",["dataviz/diagram/math"],b);
}(function(){(function(a,y){var l=window.kendo,e=l.dataviz.diagram,i=e.Graph,q=e.Node,p=e.Link,c=l.deepExtend,u=e.Size,s=e.Rect,g=e.Dictionary,t=e.Set,k=e.Graph,z=e.Utils,r=e.Point,h=1e-06,d=Math.PI/180,b=z.contains,j=a.grep;
var n=l.Class.extend({defaultOptions:{type:"Tree",subtype:"Down",roots:null,animate:false,limitToView:false,friction:0.9,nodeDistance:50,iterations:300,horizontalSeparation:90,verticalSeparation:50,underneathVerticalTopOffset:15,underneathHorizontalOffset:15,underneathVerticalSeparation:15,grid:{width:1500,offsetX:50,offsetY:50,componentSpacingX:20,componentSpacingY:20},layerSeparation:50,layeredIterations:2,startRadialAngle:0,endRadialAngle:360,radialSeparation:150,radialFirstLevelSeparation:200,keepComponentsInOneRadialLayout:false,ignoreContainers:true,layoutContainerChildren:false,ignoreInvisible:true,animateTransitions:false},init:function(){},gridLayoutComponents:function(C){if(!C){throw"No components supplied.";
}z.forEach(C,function(Q){Q.calcBounds();
});
C.sort(function(Q,R){return R.bounds.width-Q.bounds.width;
});
var H=this.options.grid.width,I=this.options.grid.componentSpacingX,J=this.options.grid.componentSpacingY,F=0,M=this.options.grid.offsetX,N=this.options.grid.offsetY,O=M,P=N,G,K=[],L=[];
while(C.length>0){if(O>=H){O=M;
P+=F+J;
F=0;
}var B=C.pop();
this.moveToOffset(B,new r(O,P));
for(G=0;
G<B.nodes.length;
G++){L.push(B.nodes[G]);
}for(G=0;
G<B.links.length;
G++){K.push(B.links[G]);
}var A=B.bounds;
var D=A.height;
if(D<=0||isNaN(D)){D=0;
}var E=A.width;
if(E<=0||isNaN(E)){E=0;
}if(D>=F){F=D;
}O+=E+I;
}return{nodes:L,links:K};
},moveToOffset:function(B,K){var E,F,A=B.bounds,C=K.x-A.x,D=K.y-A.y;
for(E=0;
E<B.nodes.length;
E++){var I=B.nodes[E];
var J=I.bounds();
if(J.width===0&&J.height===0&&J.x===0&&J.y===0){J=new s(0,0,0,0);
}J.x+=C;
J.y+=D;
I.bounds(J);
}for(E=0;
E<B.links.length;
E++){var G=B.links[E];
if(G.points){var H=[];
var L=G.points;
for(F=0;
F<L.length;
F++){var M=L[F];
M.x+=C;
M.y+=D;
H.push(M);
}G.points=H;
}}this.currentHorizontalOffset+=A.width+this.options.grid.offsetX;
return new r(C,D);
},transferOptions:function(A){this.options=l.deepExtend({},this.defaultOptions);
if(z.isUndefined(A)){return;
}this.options=l.deepExtend(this.options,A||{});
}});
var f=l.Class.extend({init:function(A){this.nodeMap=new g();
this.shapeMap=new g();
this.nodes=[];
this.edges=[];
this.edgeMap=new g();
this.finalNodes=[];
this.finalLinks=[];
this.ignoredConnections=[];
this.ignoredShapes=[];
this.hyperMap=new g();
this.hyperTree=new i();
this.finalGraph=null;
this.diagram=A;
},convert:function(A){if(z.isUndefined(this.diagram)){throw"No diagram to convert.";
}this.options=l.deepExtend({ignoreInvisible:true,ignoreContainers:true,layoutContainerChildren:false},A||{});
this.clear();
this._renormalizeShapes();
this._renormalizeConnections();
this.finalNodes=new g(this.nodes);
this.finalLinks=new g(this.edges);
this.finalGraph=new i();
this.finalNodes.forEach(function(B){this.finalGraph.addNode(B);
},this);
this.finalLinks.forEach(function(B){this.finalGraph.addExistingLink(B);
},this);
return this.finalGraph;
},mapConnection:function(A){return this.edgeMap.get(A.id);
},mapShape:function(A){return this.nodeMap.get(A.id);
},getEdge:function(A,B){return z.first(A.links,function(C){return C.getComplement(A)===B;
});
},clear:function(){this.finalGraph=null;
this.hyperTree=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new k():null;
this.hyperMap=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new g():null;
this.nodeMap=new g();
this.shapeMap=new g();
this.nodes=[];
this.edges=[];
this.edgeMap=new g();
this.ignoredConnections=[];
this.ignoredShapes=[];
this.finalNodes=[];
this.finalLinks=[];
},listToRoot:function(A){var B=[];
var C=A.container;
if(!C){return B;
}B.push(C);
while(C.parentContainer){C=C.parentContainer;
B.push(C);
}B.reverse();
return B;
},firstNonIgnorableContainer:function(A){if(A.isContainer&&!this._isIgnorableItem(A)){return A;
}return !A.parentContainer?null:this.firstNonIgnorableContainer(A.parentContainer);
},isContainerConnection:function(A,B){if(A.isContainer&&this.isDescendantOf(A,B)){return true;
}return B.isContainer&&this.isDescendantOf(B,A);
},isDescendantOf:function(F,A){if(!F.isContainer){throw"Expecting a container.";
}if(F===A){return false;
}if(b(F.children,A)){return true;
}var C=[];
for(var D=0,E=F.children.length;
D<E;
D++){var B=F.children[D];
if(B.isContainer&&this.isDescendantOf(B,A)){C.push(B);
}}return C.length>0;
},isIgnorableItem:function(A){if(this.options.ignoreInvisible){if(A.isCollapsed&&this._isVisible(A)){return false;
}if(!A.isCollapsed&&this._isVisible(A)){return false;
}return true;
}else{return A.isCollapsed&&!this._isTop(A);
}},isShapeMapped:function(A){return A.isCollapsed&&!this._isVisible(A)&&!this._isTop(A);
},leastCommonAncestor:function(A,C){if(!A){throw"Parameter should not be null.";
}if(!C){throw"Parameter should not be null.";
}if(!this.hyperTree){throw"No hypertree available.";
}var B=this.listToRoot(A);
var D=this.listToRoot(C);
var E=null;
if(z.isEmpty(B)||z.isEmpty(D)){return this.hyperTree.root.data;
}var G=B[0];
var H=D[0];
var F=0;
while(G===H){E=B[F];
F++;
if(F>=B.length||F>=D.length){break;
}G=B[F];
H=D[F];
}if(!E){return this.hyperTree.root.data;
}else{return j(this.hyperTree.nodes,function(I){return I.data.container===E;
});
}},_isTop:function(A){return !A.parentContainer;
},_isVisible:function(A){if(!A.visible()){return false;
}return !A.parentContainer?A.visible():this._isVisible(A.parentContainer);
},_isCollapsed:function(A){if(A.isContainer&&A.isCollapsed){return true;
}return A.parentContainer&&this._isCollapsed(A.parentContainer);
},_renormalizeShapes:function(){if(this.options.ignoreContainers){for(var A=0,B=this.diagram.shapes.length;
A<B;
A++){var D=this.diagram.shapes[A];
if(this.options.ignoreInvisible&&!this._isVisible(D)||D.isContainer){this.ignoredShapes.push(D);
continue;
}var C=new q(D.id,D);
C.isVirtual=false;
this.nodeMap.add(D.id,C);
this.nodes.push(C);
}}else{throw"Containers are not supported yet, but stay tuned.";
}},_renormalizeConnections:function(){if(this.diagram.connections.length===0){return;
}for(var B=0,C=this.diagram.connections.length;
B<C;
B++){var A=this.diagram.connections[B];
if(this.isIgnorableItem(A)){this.ignoredConnections.push(A);
continue;
}var G=!A.sourceConnector?null:A.sourceConnector.shape;
var E=!A.targetConnector?null:A.targetConnector.shape;
if(!G||!E){this.ignoredConnections.push(A);
continue;
}if(b(this.ignoredShapes,G)&&!this.shapeMap.containsKey(G)){this.ignoredConnections.push(A);
continue;
}if(b(this.ignoredShapes,E)&&!this.shapeMap.containsKey(E)){this.ignoredConnections.push(A);
continue;
}if(this.shapeMap.containsKey(G)){G=this.shapeMap[G];
}if(this.shapeMap.containsKey(E)){E=this.shapeMap[E];
}var H=this.mapShape(G);
var F=this.mapShape(E);
if(H===F||this.areConnectedAlready(H,F)){this.ignoredConnections.push(A);
continue;
}if(H===null||F===null){throw"A shape was not mapped to a node.";
}if(this.options.ignoreContainers){if(H.isVirtual||F.isVirtual){this.ignoredConnections.push(A);
continue;
}var D=new p(H,F,A.id,A);
this.edgeMap.add(A.id,D);
this.edges.push(D);
}else{throw"Containers are not supported yet, but stay tuned.";
}}},areConnectedAlready:function(B,A){return z.any(this.edges,function(C){return C.source===B&&C.target===A||C.source===A&&C.target===B;
});
}});
var v=n.extend({init:function(A){var B=this;
n.fn.init.call(B);
if(z.isUndefined(A)){throw"Diagram is not specified.";
}this.diagram=A;
},layout:function(G){this.transferOptions(G);
var A=new f(this.diagram);
var E=A.convert(G);
if(E.isEmpty()){return;
}var C=E.getConnectedComponents();
if(z.isEmpty(C)){return;
}for(var F=0;
F<C.length;
F++){var B=C[F];
this.layoutGraph(B,G);
}var D=this.gridLayoutComponents(C);
return new e.LayoutState(this.diagram,D);
},layoutGraph:function(A,D){if(z.isDefined(D)){this.transferOptions(D);
}this.graph=A;
var C=this.options.nodeDistance*9;
this.temperature=C;
var B=this._expectedBounds();
this.width=B.width;
this.height=B.height;
for(var E=0;
E<this.options.iterations;
E++){this.refineStage=E>=this.options.iterations*5/6;
this.tick();
this.temperature=this.refineStage?C/30:C*(1-E/(2*this.options.iterations));
}},tick:function(){var A;
for(A=0;
A<this.graph.nodes.length;
A++){this._repulsion(this.graph.nodes[A]);
}for(A=0;
A<this.graph.links.length;
A++){this._attraction(this.graph.links[A]);
}for(A=0;
A<this.graph.nodes.length;
A++){var B=this.graph.nodes[A];
var C=Math.sqrt(B.dx*B.dx+B.dy*B.dy);
if(C===0){return;
}B.x+=Math.min(C,this.temperature)*B.dx/C;
B.y+=Math.min(C,this.temperature)*B.dy/C;
if(this.options.limitToView){B.x=Math.min(this.width,Math.max(B.width/2,B.x));
B.y=Math.min(this.height,Math.max(B.height/2,B.y));
}}},_shake:function(B){var C=Math.random()*this.options.nodeDistance/4;
var A=Math.random()*2*Math.PI;
B.x+=C*Math.cos(A);
B.y-=C*Math.sin(A);
},_InverseSquareForce:function(A,H,G){var D;
if(!this.refineStage){D=Math.pow(A,2)/Math.pow(this.options.nodeDistance,2);
}else{var B=H.x-G.x;
var C=H.y-G.y;
var J=H.width/2;
var F=H.height/2;
var I=G.width/2;
var E=G.height/2;
D=Math.pow(B,2)/Math.pow(J+I+this.options.nodeDistance,2)+Math.pow(C,2)/Math.pow(F+E+this.options.nodeDistance,2);
}return D*4/3;
},_SquareForce:function(A,C,B){return 1/this._InverseSquareForce(A,C,B);
},_repulsion:function(A){A.dx=0;
A.dy=0;
z.forEach(this.graph.nodes,function(C){if(C===A){return;
}while(A.x===C.x&&A.y===C.y){this._shake(C);
}var E=A.x-C.x;
var F=A.y-C.y;
var B=Math.sqrt(E*E+F*F);
var D=this._SquareForce(B,A,C)*2;
A.dx+=E/B*D;
A.dy+=F/B*D;
},this);
},_attraction:function(E){var G=E.target;
var F=E.source;
if(F===G){return;
}while(F.x===G.x&&F.y===G.y){this._shake(G);
}var H=F.x-G.x;
var I=F.y-G.y;
var B=Math.sqrt(H*H+I*I);
var A=this._InverseSquareForce(B,F,G)*5;
var C=H/B*A;
var D=I/B*A;
G.dx+=C;
G.dy+=D;
F.dx-=C;
F.dy-=D;
},_expectedBounds:function(){var F,D=this.graph.nodes.length,E=1.5,C=4;
if(D===0){return F;
}F=z.fold(this.graph.nodes,function(K,J){var I=J.width*J.height;
if(I>0){K+=Math.sqrt(I);
return K;
}return 0;
},0,this);
var A=F/D;
var G=A*Math.ceil(Math.sqrt(D));
var H=G*Math.sqrt(E);
var B=G/Math.sqrt(E);
return{width:H*C,height:B*C};
}});
var x=l.Class.extend({init:function(A){this.center=null;
this.options=A;
},layout:function(B,A){this.graph=B;
if(!this.graph.nodes||this.graph.nodes.length===0){return;
}if(!b(this.graph.nodes,A)){throw"The given root is not in the graph.";
}this.center=A;
this.graph.cacheRelationships();
this.layoutSwitch();
},layoutLeft:function(C){this.setChildrenDirection(this.center,"Left",false);
this.setChildrenLayout(this.center,"Default",false);
var A=0,G=0,I,B,D;
for(B=0;
B<C.length;
B++){D=C[B];
D.TreeDirection="Left";
var F=this.measure(D,u.Empty);
G=Math.max(G,F.Width);
A+=F.height+this.options.verticalSeparation;
}A-=this.options.verticalSeparation;
var H=this.center.x-this.options.horizontalSeparation;
I=this.center.y+(this.center.height-A)/2;
for(B=0;
B<C.length;
B++){D=C[B];
var E=new r(H-D.Size.width,I);
this.arrange(D,E);
I+=D.Size.height+this.options.verticalSeparation;
}},layoutRight:function(E){this.setChildrenDirection(this.center,"Right",false);
this.setChildrenLayout(this.center,"Default",false);
var A=0,G=0,I,B,C;
for(B=0;
B<E.length;
B++){C=E[B];
C.TreeDirection="Right";
var F=this.measure(C,u.Empty);
G=Math.max(G,F.Width);
A+=F.height+this.options.verticalSeparation;
}A-=this.options.verticalSeparation;
var H=this.center.x+this.options.horizontalSeparation+this.center.width;
I=this.center.y+(this.center.height-A)/2;
for(B=0;
B<E.length;
B++){C=E[B];
var D=new r(H,I);
this.arrange(C,D);
I+=C.Size.height+this.options.verticalSeparation;
}},layoutUp:function(E){this.setChildrenDirection(this.center,"Up",false);
this.setChildrenLayout(this.center,"Default",false);
var F=0,H,B,A;
for(A=0;
A<E.length;
A++){B=E[A];
B.TreeDirection="Up";
var D=this.measure(B,u.Empty);
F+=D.width+this.options.horizontalSeparation;
}F-=this.options.horizontalSeparation;
var G=this.center.x+this.center.width/2-F/2;
for(A=0;
A<E.length;
A++){B=E[A];
H=this.center.y-this.options.verticalSeparation-B.Size.height;
var C=new r(G,H);
this.arrange(B,C);
G+=B.Size.width+this.options.horizontalSeparation;
}},layoutDown:function(A){var C,B;
this.setChildrenDirection(this.center,"Down",false);
this.setChildrenLayout(this.center,"Default",false);
var F=0,H;
for(B=0;
B<A.length;
B++){C=A[B];
C.treeDirection="Down";
var E=this.measure(C,u.Empty);
F+=E.width+this.options.horizontalSeparation;
}F-=this.options.horizontalSeparation;
var G=this.center.x+this.center.width/2-F/2;
H=this.center.y+this.options.verticalSeparation+this.center.height;
for(B=0;
B<A.length;
B++){C=A[B];
var D=new r(G,H);
this.arrange(C,D);
G+=C.Size.width+this.options.horizontalSeparation;
}},layoutRadialTree:function(){this.setChildrenDirection(this.center,"Radial",false);
this.setChildrenLayout(this.center,"Default",false);
this.previousRoot=null;
var B=this.options.startRadialAngle*d;
var A=this.options.endRadialAngle*d;
if(A<=B){throw"Final angle should not be less than the start angle.";
}this.maxDepth=0;
this.origin=new r(this.center.x,this.center.y);
this.calculateAngularWidth(this.center,0);
if(this.maxDepth>0){this.radialLayout(this.center,this.options.radialFirstLevelSeparation,B,A);
}this.center.Angle=A-B;
},tipOverTree:function(A,F){if(z.isUndefined(F)){F=0;
}this.setChildrenDirection(this.center,"Down",false);
this.setChildrenLayout(this.center,"Default",false);
this.setChildrenLayout(this.center,"Underneath",false,F);
var G=0,I,C,B;
for(B=0;
B<A.length;
B++){C=A[B];
C.TreeDirection="Down";
var E=this.measure(C,u.Empty);
G+=E.width+this.options.horizontalSeparation;
}G-=this.options.horizontalSeparation;
G-=A[A.length-1].width;
G+=A[A.length-1].associatedShape.bounds().width;
var H=this.center.x+this.center.width/2-G/2;
I=this.center.y+this.options.verticalSeparation+this.center.height;
for(B=0;
B<A.length;
B++){C=A[B];
var D=new r(H,I);
this.arrange(C,D);
H+=C.Size.width+this.options.horizontalSeparation;
}},calculateAngularWidth:function(H,C){if(C>this.maxDepth){this.maxDepth=C;
}var A=0,I=1000,E=1000,D=C===0?0:Math.sqrt(I*I+E*E)/C;
if(H.children.length>0){for(var F=0,G=H.children.length;
F<G;
F++){var B=H.children[F];
A+=this.calculateAngularWidth(B,C+1);
}A=Math.max(D,A);
}else{A=D;
}H.sectorAngle=A;
return A;
},sortChildren:function(J){var B=0,G;
if(J.parents.length>1){throw"Node is not part of a tree.";
}var L=J.parents[0];
if(L){var M=new r(L.x,L.y);
var K=new r(J.x,J.y);
B=this.normalizeAngle(Math.atan2(M.y-K.y,M.x-K.x));
}var F=J.children.length;
if(F===0){return null;
}var A=[];
var H=[];
for(G=0;
G<F;
++G){var C=J.children[G];
var I=new r(C.x,C.y);
H[G]=G;
A[G]=this.normalizeAngle(-B+Math.atan2(I.y-I.y,I.x-I.x));
}z.bisort(A,H);
var E=[];
var D=J.children;
for(G=0;
G<F;
++G){E.push(D[H[G]]);
}return E;
},normalizeAngle:function(A){while(A>Math.PI*2){A-=2*Math.PI;
}while(A<0){A+=Math.PI*2;
}return A;
},radialLayout:function(J,L,N,F){var D=F-N;
var E=D/2;
var K=J.sectorAngle;
var G=0;
var M=this.sortChildren(J);
for(var H=0,I=M.length;
H<I;
H++){var B=M[H];
var C=B;
var A=C.sectorAngle/K;
if(B.children.length>0){this.radialLayout(B,L+this.options.radialSeparation,N+G*D,N+(G+A)*D);
}this.setPolarLocation(B,L,N+G*D+A*E);
C.angle=A*D;
G+=A;
}},setPolarLocation:function(B,C,A){B.x=this.origin.x+C*Math.cos(A);
B.y=this.origin.y+C*Math.sin(A);
B.BoundingRectangle=new s(B.x,B.y,B.width,B.height);
},setChildrenDirection:function(C,A,B){var D=C.treeDirection;
this.graph.depthFirstTraversal(C,function(E){E.treeDirection=A;
});
if(!B){C.treeDirection=D;
}},setChildrenLayout:function(C,B,A,E){if(z.isUndefined(E)){E=0;
}var D=C.childrenLayout;
if(E>0){this.graph.assignLevels(C);
this.graph.depthFirstTraversal(C,function(F){if(F.level>=E+1){F.childrenLayout=B;
}});
}else{this.graph.depthFirstTraversal(C,function(F){F.childrenLayout=B;
});
if(!A){C.childrenLayout=D;
}}},measure:function(F,C){var L=0,D=0,I;
var H=new u(0,0);
if(!F){throw"";
}var A=F.associatedShape.bounds();
var K=A.width;
var J=A.height;
if(F.parents.length!==1){throw"Node not in a spanning tree.";
}var G=F.parents[0];
if(F.treeDirection==="Undefined"){F.treeDirection=G.treeDirection;
}if(z.isEmpty(F.children)){H=new u(Math.abs(K)<h?50:K,Math.abs(J)<h?25:J);
}else{if(F.children.length===1){switch(F.treeDirection){case"Radial":I=this.measure(F.children[0],C);
L=K+this.options.radialSeparation*Math.cos(F.AngleToParent)+I.width;
D=J+Math.abs(this.options.radialSeparation*Math.sin(F.AngleToParent))+I.height;
break;
case"Left":case"Right":switch(F.childrenLayout){case"TopAlignedWithParent":break;
case"BottomAlignedWithParent":break;
case"Underneath":I=this.measure(F.children[0],C);
L=K+I.width+this.options.underneathHorizontalOffset;
D=J+this.options.underneathVerticalTopOffset+I.height;
break;
case"Default":I=this.measure(F.children[0],C);
L=K+this.options.horizontalSeparation+I.width;
D=Math.max(J,I.height);
break;
default:throw"Unhandled TreeDirection in the Radial layout measuring.";
}break;
case"Up":case"Down":switch(F.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=this.measure(F.children[0],C);
L=Math.max(K,I.width+this.options.underneathHorizontalOffset);
D=J+this.options.underneathVerticalTopOffset+I.height;
break;
case"Default":I=this.measure(F.children[0],C);
D=J+this.options.verticalSeparation+I.height;
L=Math.max(K,I.width);
break;
default:throw"Unhandled TreeDirection in the Down layout measuring.";
}break;
default:throw"Unhandled TreeDirection in the layout measuring.";
}H=new u(L,D);
}else{var E,B;
switch(F.treeDirection){case"Left":case"Right":switch(F.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":L=K;
D=J+this.options.underneathVerticalTopOffset;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L=Math.max(L,I.width+this.options.underneathHorizontalOffset);
D+=I.height+this.options.underneathVerticalSeparation;
}D-=this.options.underneathVerticalSeparation;
break;
case"Default":L=K;
D=0;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L=Math.max(L,K+this.options.horizontalSeparation+I.width);
D+=I.height+this.options.verticalSeparation;
}D-=this.options.verticalSeparation;
break;
default:throw"Unhandled TreeDirection in the Right layout measuring.";
}break;
case"Up":case"Down":switch(F.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":L=K;
D=J+this.options.underneathVerticalTopOffset;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L=Math.max(L,I.width+this.options.underneathHorizontalOffset);
D+=I.height+this.options.underneathVerticalSeparation;
}D-=this.options.underneathVerticalSeparation;
break;
case"Default":L=0;
D=0;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L+=I.width+this.options.horizontalSeparation;
D=Math.max(D,I.height+this.options.verticalSeparation+J);
}L-=this.options.horizontalSeparation;
break;
default:throw"Unhandled TreeDirection in the Down layout measuring.";
}break;
default:throw"Unhandled TreeDirection in the layout measuring.";
}H=new u(L,D);
}}F.SectorAngle=Math.sqrt(L*L/4+D*D/4);
F.Size=H;
return H;
},arrange:function(E,G){var D,H,B,F,C,A=E.associatedShape.bounds();
var K=A.width;
var J=A.height;
if(z.isEmpty(E.children)){E.x=G.x;
E.y=G.y;
E.BoundingRectangle=new s(G.x,G.y,K,J);
}else{var L,M;
var I;
switch(E.treeDirection){case"Left":switch(E.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=G;
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
M=G.y+J+this.options.underneathVerticalTopOffset;
for(D=0;
D<F.children.length;
D++){F=F.children[D];
L=I.x-F.associatedShape.width-this.options.underneathHorizontalOffset;
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.underneathVerticalSeparation;
}break;
case"Default":I=new r(G.x+E.Size.width-K,G.y+(E.Size.height-J)/2);
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=I.x-this.options.horizontalSeparation;
M=G.y;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L-F.Size.width,M);
this.arrange(F,H);
M+=F.Size.height+this.options.verticalSeparation;
}break;
default:throw"Unsupported TreeDirection";
}break;
case"Right":switch(E.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=G;
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=G.x+K+this.options.underneathHorizontalOffset;
M=G.y+J+this.options.underneathVerticalTopOffset;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.underneathVerticalSeparation;
}break;
case"Default":I=new r(G.x,G.y+(E.Size.height-J)/2);
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=G.x+K+this.options.horizontalSeparation;
M=G.y;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.verticalSeparation;
}break;
default:throw"Unsupported TreeDirection";
}break;
case"Up":I=new r(G.x+(E.Size.width-K)/2,G.y+E.Size.height-J);
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
if(Math.abs(I.x-G.x)<h){C=0;
for(D=0;
D<E.children.length;
D++){B=E.children[D];
C+=B.Size.width+this.options.horizontalSeparation;
}C-=this.options.horizontalSeparation;
L=G.x+(K-C)/2;
}else{L=G.x;
}for(D=0;
D<E.children.length;
D++){F=E.children[D];
M=I.y-this.options.verticalSeparation-F.Size.height;
H=new r(L,M);
this.arrange(F,H);
L+=F.Size.width+this.options.horizontalSeparation;
}break;
case"Down":switch(E.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=G;
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=G.x+this.options.underneathHorizontalOffset;
M=G.y+J+this.options.underneathVerticalTopOffset;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.underneathVerticalSeparation;
}break;
case"Default":I=new r(G.x+(E.Size.width-K)/2,G.y);
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
if(Math.abs(I.x-G.x)<h){C=0;
for(D=0;
D<E.children.length;
D++){B=E.children[D];
C+=B.Size.width+this.options.horizontalSeparation;
}C-=this.options.horizontalSeparation;
L=G.x+(K-C)/2;
}else{L=G.x;
}for(D=0;
D<E.children.length;
D++){F=E.children[D];
M=I.y+this.options.verticalSeparation+J;
H=new r(L,M);
this.arrange(F,H);
L+=F.Size.width+this.options.horizontalSeparation;
}break;
default:throw"Unsupported TreeDirection";
}break;
case"None":break;
default:throw"Unsupported TreeDirection";
}}},layoutSwitch:function(){if(!this.center){return;
}if(z.isEmpty(this.center.children)){return;
}var F=this.options.subtype;
if(z.isUndefined(F)){F="Down";
}var E,D,B,C;
var A=this.center.children;
switch(F.toLowerCase()){case"radial":case"radialtree":this.layoutRadialTree();
break;
case"mindmaphorizontal":case"mindmap":E=this.center.children;
if(this.center.children.length===1){this.layoutRight(E);
}else{C=A.length/2;
D=j(this.center.children,function(G){return z.indexOf(A,G)<C;
});
B=j(this.center.children,function(G){return z.indexOf(A,G)>=C;
});
this.layoutLeft(D);
this.layoutRight(B);
}break;
case"mindmapvertical":E=this.center.children;
if(this.center.children.length===1){this.layoutDown(E);
}else{C=A.length/2;
D=j(this.center.children,function(G){return z.indexOf(A,G)<C;
});
B=j(this.center.children,function(G){return z.indexOf(A,G)>=C;
});
this.layoutUp(D);
this.layoutDown(B);
}break;
case"right":this.layoutRight(this.center.children);
break;
case"left":this.layoutLeft(this.center.children);
break;
case"up":case"bottom":this.layoutUp(this.center.children);
break;
case"down":case"top":this.layoutDown(this.center.children);
break;
case"tipover":case"tipovertree":if(this.options.tipOverTreeStartLevel<0){throw"The tip-over level should be a positive integer.";
}this.tipOverTree(this.center.children,this.options.tipOverTreeStartLevel);
break;
case"undefined":case"none":break;
}}});
var w=n.extend({init:function(A){var B=this;
n.fn.init.call(B);
if(z.isUndefined(A)){throw"No diagram specified.";
}this.diagram=A;
},layout:function(C){this.transferOptions(C);
var A=new f(this.diagram);
this.graph=A.convert();
var B=this.layoutComponents();
return new e.LayoutState(this.diagram,B);
},layoutComponents:function(){if(this.graph.isEmpty()){return;
}var B=this.graph.getConnectedComponents();
if(z.isEmpty(B)){return;
}var D=new x(this.options);
var H=[];
for(var C=0;
C<B.length;
C++){var A=B[C];
var G=this.getTree(A);
if(!G){throw"Failed to find a spanning tree for the component.";
}var E=G.root;
var F=G.tree;
D.layout(F,E);
H.push(F);
}return this.gridLayoutComponents(H);
},getTree:function(B){var G=null;
if(this.options.roots&&this.options.roots.length>0){for(var C=0,E=B.nodes.length;
C<E;
C++){var F=B.nodes[C];
for(var D=0;
D<this.options.roots.length;
D++){var A=this.options.roots[D];
if(A===F.associatedShape){G=F;
break;
}}}}if(!G){G=B.root();
if(!G){throw"Unable to find a root for the tree.";
}}return this.getTreeForRoot(B,G);
},getTreeForRoot:function(A,B){var C=A.getSpanningTree(B);
if(z.isUndefined(C)||C.isEmpty()){return null;
}return{tree:C,root:C.root};
}});
var m=n.extend({init:function(A){var B=this;
n.fn.init.call(B);
if(z.isUndefined(A)){throw"Diagram is not specified.";
}this.diagram=A;
},layout:function(G){this.transferOptions(G);
var A=new f(this.diagram);
var E=A.convert(G);
if(E.isEmpty()){return;
}var C=E.getConnectedComponents();
if(z.isEmpty(C)){return;
}for(var F=0;
F<C.length;
F++){var B=C[F];
this.layoutGraph(B,G);
}var D=this.gridLayoutComponents(C);
return new e.LayoutState(this.diagram,D);
},_initRuntimeProperties:function(){for(var A=0;
A<this.graph.nodes.length;
A++){var B=this.graph.nodes[A];
B.layer=-1;
B.downstreamLinkCount=0;
B.upstreamLinkCount=0;
B.isVirtual=false;
B.uBaryCenter=0;
B.dBaryCenter=0;
B.upstreamPriority=0;
B.downstreamPriority=0;
B.gridPosition=0;
}},_prepare:function(B){var A=[],C,D,H;
var G=new g();
var F=0;
var O,K,N;
z.forEach(B.nodes,function(P){if(P.incoming.length===0){G.set(P,0);
A.push(P);
}});
while(A.length>0){K=A.shift();
for(C=0;
C<K.outgoing.length;
C++){H=K.outgoing[C];
N=H.target;
if(G.containsKey(N)){O=Math.max(G.get(K)+1,G.get(N));
}else{O=G.get(K)+1;
}G.set(N,O);
if(O>F){F=O;
}if(!b(A,N)){A.push(N);
}}}var M=G.keys();
M.sort(function(P,R){var Q=G.get(P);
var S=G.get(R);
return z.sign(S-Q);
});
for(var J=0;
J<M.length;
++J){var L=M[J];
var I=Number.MAX_VALUE;
if(L.outgoing.length===0){continue;
}for(D=0;
D<L.outgoing.length;
++D){H=L.outgoing[D];
I=Math.min(I,G.get(H.target));
}if(I>1){G.set(L,I-1);
}}this.layers=[];
var E;
for(C=0;
C<F+1;
C++){E=[];
E.linksTo={};
this.layers.push(E);
}G.forEach(function(Q,P){Q.layer=P;
this.layers[P].push(Q);
},this);
for(D=0;
D<this.layers.length;
D++){E=this.layers[D];
for(C=0;
C<E.length;
C++){E[C].gridPosition=C;
}}},layoutGraph:function(A,B){if(z.isUndefined(A)){throw"No graph given or graph analysis of the diagram failed.";
}if(z.isDefined(B)){this.transferOptions(B);
}this.graph=A;
A.setItemIndices();
var C=A.makeAcyclic();
this._initRuntimeProperties();
this._prepare(A,B);
this._dummify();
this._optimizeCrossings();
this._swapPairs();
this.arrangeNodes();
this._moveThingsAround();
this._dedummify();
z.forEach(C,function(D){if(D.points){D.points.reverse();
}});
},setMinDist:function(C,E,D){var B=C.layer;
var A=C.layerIndex;
this.minDistances[B][A]=D;
},getMinDist:function(F,I){var A=0,B=F.layerIndex,C=I.layerIndex,E=F.layer,H=Math.min(B,C),G=Math.max(B,C);
for(var D=H;
D<G;
++D){A+=this.minDistances[E][D];
}return A;
},placeLeftToRight:function(G){var H=new g(),I,L;
for(var A=0;
A<this.layers.length;
++A){var B=G[A];
if(!B){continue;
}for(I=0;
I<B.length;
I++){L=B[I];
if(!H.containsKey(L)){this.placeLeft(L,H,A);
}}var C=Number.POSITIVE_INFINITY;
for(I=0;
I<B.length;
I++){L=B[I];
var M=this.rightSibling(L);
if(M&&this.nodeLeftClass.get(M)!==A){C=Math.min(C,H.get(M)-H.get(L)-this.getMinDist(L,M));
}}if(C===Number.POSITIVE_INFINITY){var E=[];
for(I=0;
I<B.length;
I++){L=B[I];
var K=[];
z.addRange(K,this.upNodes.get(L));
z.addRange(K,this.downNodes.get(L));
for(var F=0;
F<K.length;
F++){var J=K[F];
if(this.nodeLeftClass.get(J)<A){E.push(H.get(J)-H.get(L));
}}}E.sort();
if(E.length===0){C=0;
}else{if(E.length%2===1){C=E[this.intDiv(E.length,2)];
}else{C=(E[this.intDiv(E.length,2)-1]+E[this.intDiv(E.length,2)])/2;
}}}for(I=0;
I<B.length;
I++){L=B[I];
H.set(L,H.get(L)+C);
}}return H;
},placeRightToLeft:function(L){var M=new g(),H,K;
for(var A=0;
A<this.layers.length;
++A){var B=L[A];
if(!B){continue;
}for(H=0;
H<B.length;
H++){K=B[H];
if(!M.containsKey(K)){this.placeRight(K,M,A);
}}var C=Number.NEGATIVE_INFINITY;
for(H=0;
H<B.length;
H++){K=B[H];
var G=this.leftSibling(K);
if(G&&this.nodeRightClass.get(G)!==A){C=Math.max(C,M.get(G)-M.get(K)+this.getMinDist(G,K));
}}if(C===Number.NEGATIVE_INFINITY){var E=[];
for(H=0;
H<B.length;
H++){K=B[H];
var J=[];
z.addRange(J,this.upNodes.get(K));
z.addRange(J,this.downNodes.get(K));
for(var F=0;
F<J.length;
F++){var I=J[F];
if(this.nodeRightClass.get(I)<A){E.push(M.get(K)-M.get(I));
}}}E.sort();
if(E.length===0){C=0;
}else{if(E.length%2===1){C=E[this.intDiv(E.length,2)];
}else{C=(E[this.intDiv(E.length,2)-1]+E[this.intDiv(E.length,2)])/2;
}}}for(H=0;
H<B.length;
H++){K=B[H];
M.set(K,M.get(K)+C);
}}return M;
},_getLeftWing:function(){var A={value:null};
var B=this.computeClasses(A,1);
this.nodeLeftClass=A.value;
return B;
},_getRightWing:function(){var B={value:null};
var A=this.computeClasses(B,-1);
this.nodeRightClass=B.value;
return A;
},computeClasses:function(L,B){var A=0,K=L.value=new g();
for(var E=0;
E<this.layers.length;
++E){A=E;
var F=this.layers[E];
for(var G=B===1?0:F.length-1;
0<=G&&G<F.length;
G+=B){var I=F[G];
if(!K.containsKey(I)){K.set(I,A);
if(I.isVirtual){var H=this._nodesInLink(I);
for(var D=0;
D<H.length;
D++){var J=H[D];
K.set(J,A);
}}}else{A=K.get(I);
}}}var M=[];
for(var C=0;
C<this.layers.length;
C++){M.push(null);
}K.forEach(function(O,N){if(M[N]===null){M[N]=[];
}M[N].push(O);
});
return M;
},_isVerticalLayout:function(){return this.options.subtype.toLowerCase()==="up"||this.options.subtype.toLowerCase()==="down"||this.options.subtype.toLowerCase()==="vertical";
},_isHorizontalLayout:function(){return this.options.subtype.toLowerCase()==="right"||this.options.subtype.toLowerCase()==="left"||this.options.subtype.toLowerCase()==="horizontal";
},_isIncreasingLayout:function(){return this.options.subtype.toLowerCase()==="right"||this.options.subtype.toLowerCase()==="down";
},_moveThingsAround:function(){var G,J,Q,K,P,aa;
for(J=0;
J<this.layers.length;
++J){K=this.layers[J];
K.sort(this._gridPositionComparer);
}this.minDistances=[];
for(J=0;
J<this.layers.length;
++J){K=this.layers[J];
this.minDistances[J]=[];
for(P=0;
P<K.length;
++P){Q=K[P];
Q.layerIndex=P;
this.minDistances[J][P]=this.options.nodeDistance;
if(P<K.length-1){if(this._isVerticalLayout()){this.minDistances[J][P]+=(Q.width+K[P+1].width)/2;
}else{this.minDistances[J][P]+=(Q.height+K[P+1].height)/2;
}}}}this.downNodes=new g();
this.upNodes=new g();
z.forEach(this.graph.nodes,function(ac){this.downNodes.set(ac,[]);
this.upNodes.set(ac,[]);
},this);
z.forEach(this.graph.links,function(ae){var af=ae.source;
var ac=ae.target;
var ad=null,ag=null;
if(af.layer>ac.layer){ad=ae.source;
ag=ae.target;
}else{ag=ae.source;
ad=ae.target;
}this.downNodes.get(ag).push(ad);
this.upNodes.get(ad).push(ag);
},this);
this.downNodes.forEachValue(function(ac){ac.sort(this._gridPositionComparer);
},this);
this.upNodes.forEachValue(function(ac){ac.sort(this._gridPositionComparer);
},this);
for(J=0;
J<this.layers.length-1;
++J){K=this.layers[J];
for(aa=0;
aa<K.length-1;
aa++){var B=K[aa];
if(!B.isVirtual){continue;
}var A=this.downNodes.get(B)[0];
if(!A.isVirtual){continue;
}for(P=aa+1;
P<K.length;
++P){Q=K[P];
if(!Q.isVirtual){continue;
}var D=this.downNodes.get(Q)[0];
if(!D.isVirtual){continue;
}if(A.gridPosition>D.gridPosition){var U=A.gridPosition;
A.gridPosition=D.gridPosition;
D.gridPosition=U;
var H=A.layerIndex;
var I=D.layerIndex;
this.layers[J+1][H]=D;
this.layers[J+1][I]=A;
A.layerIndex=I;
D.layerIndex=H;
}}}}var M=this._getLeftWing();
var W=this._getRightWing();
var N=this.placeLeftToRight(M);
var X=this.placeRightToLeft(W);
var ab=new g();
z.forEach(this.graph.nodes,function(ac){ab.set(ac,(N.get(ac)+X.get(ac))/2);
});
var S=new g();
var T=new g();
for(J=0;
J<this.layers.length;
++J){K=this.layers[J];
var Z=-1,Y=-1;
for(P=0;
P<K.length;
++P){Q=K[P];
S.set(Q,0);
T.set(Q,false);
if(Q.isVirtual){if(Z===-1){Z=P;
}else{if(Z===P-1){Z=P;
}else{Y=P;
S.set(K[Z],0);
if(ab.get(Q)-ab.get(K[Z])===this.getMinDist(K[Z],Q)){T.set(K[Z],true);
}else{T.set(K[Z],false);
}Z=P;
}}}}}var C=[1,-1];
z.forEach(C,function(ac){var ag=ac===1?0:this.layers.length-1;
for(var ad=ag;
0<=ad&&ad<this.layers.length;
ad+=ac){var ae=this.layers[ad];
var ak=this._firstVirtualNode(ae);
var aj=null;
var af=null;
if(ak!==-1){aj=ae[ak];
af=[];
for(G=0;
G<ak;
G++){af.push(ae[G]);
}}else{aj=null;
af=ae;
}if(af.length>0){this._sequencer(ab,null,aj,ac,af);
for(G=0;
G<af.length-1;
++G){this.setMinDist(af[G],af[G+1],ab.get(af[G+1])-ab.get(af[G]));
}if(aj){this.setMinDist(af[af.length-1],aj,ab.get(aj)-ab.get(af[af.length-1]));
}}while(aj){var ah=this.nextVirtualNode(ae,aj);
if(!ah){ak=aj.layerIndex;
af=[];
for(G=ak+1;
G<ae.length;
G++){af.push(ae[G]);
}if(af.length>0){this._sequencer(ab,aj,null,ac,af);
for(G=0;
G<af.length-1;
++G){this.setMinDist(af[G],af[G+1],ab.get(af[G+1])-ab.get(af[G]));
}this.setMinDist(aj,af[0],ab.get(af[0])-ab.get(aj));
}}else{if(S.get(aj)===ac){ak=aj.layerIndex;
var ai=ah.layerIndex;
af=[];
for(G=ak+1;
G<ai;
G++){af.push(ae[G]);
}if(af.length>0){this._sequencer(ab,aj,ah,ac,af);
}T.set(aj,true);
}}aj=ah;
}this.adjustDirections(ad,ac,S,T);
}},this);
var E=this._isIncreasingLayout()?0:this.layers.length-1;
var V=function(ad,ac){if(ac._isIncreasingLayout()){return ad<ac.layers.length;
}else{return ad>=0;
}};
var L=this._isIncreasingLayout()?+1:-1,R=0;
function O(ae,ac){var ad=Number.MIN_VALUE;
for(var af=0;
af<ae.length;
++af){var ag=ae[af];
if(ac._isVerticalLayout()){ad=Math.max(ad,ag.height);
}else{ad=Math.max(ad,ag.width);
}}return ad;
}for(G=E;
V(G,this);
G+=L){K=this.layers[G];
var F=O(K,this);
for(P=0;
P<K.length;
++P){Q=K[P];
if(this._isVerticalLayout()){Q.x=ab.get(Q);
Q.y=R+F/2;
}else{Q.x=R+F/2;
Q.y=ab.get(Q);
}}R+=this.options.layerSeparation+F;
}},adjustDirections:function(I,B,N,P){if(I+B<0||I+B>=this.layers.length){return;
}var Q=null,R=null;
var J=this.layers[I+B];
for(var K=0;
K<J.length;
++K){var L=J[K];
if(L.isVirtual){var M=this.getNeighborOnLayer(L,I);
if(M.isVirtual){if(Q){var O=P.get(R);
var A=this.layers[I];
var D=R.layerIndex;
var E=M.layerIndex;
for(var C=D+1;
C<E;
++C){if(A[C].isVirtual){O=O&&P.get(A[C]);
}}if(O){N.set(Q,B);
var G=Q.layerIndex;
var H=L.layerIndex;
for(var F=G+1;
F<H;
++F){if(J[F].isVirtual){N.set(J[F],B);
}}}}Q=L;
R=M;
}}}},getNeighborOnLayer:function(C,A){var B=this.upNodes.get(C)[0];
if(B.layer===A){return B;
}B=this.downNodes.get(C)[0];
if(B.layer===A){return B;
}return null;
},_sequencer:function(G,F,E,A,C){if(C.length===1){this._sequenceSingle(G,F,E,A,C[0]);
}if(C.length>1){var B=C.length,D=this.intDiv(B,2);
this._sequencer(G,F,E,A,C.slice(0,D));
this._sequencer(G,F,E,A,C.slice(D));
this.combineSequences(G,F,E,A,C);
}},_sequenceSingle:function(G,F,E,A,D){var C=A===-1?this.downNodes.get(D):this.upNodes.get(D);
var B=C.length;
if(B!==0){if(B%2===1){G.set(D,G.get(C[this.intDiv(B,2)]));
}else{G.set(D,(G.get(C[this.intDiv(B,2)-1])+G.get(C[this.intDiv(B,2)]))/2);
}if(F){G.set(D,Math.max(G.get(D),G.get(F)+this.getMinDist(F,D)));
}if(E){G.set(D,Math.min(G.get(D),G.get(E)-this.getMinDist(D,E)));
}}},combineSequences:function(R,Q,P,B,N){var K=N.length,O=this.intDiv(K,2);
var D=[],C,A,G,I,H,J;
for(C=0;
C<O;
++C){A=0;
I=B===-1?this.downNodes.get(N[C]):this.upNodes.get(N[C]);
for(G=0;
G<I.length;
++G){H=I[G];
if(R.get(H)>=R.get(N[C])){A++;
}else{A--;
D.push({k:R.get(H)+this.getMinDist(N[C],N[O-1]),v:2});
}}D.push({k:R.get(N[C])+this.getMinDist(N[C],N[O-1]),v:A});
}if(Q){D.push({k:R.get(Q)+this.getMinDist(Q,N[O-1]),v:Number.MAX_VALUE});
}D.sort(this._positionDescendingComparer);
var L=[];
for(C=O;
C<K;
++C){A=0;
I=B===-1?this.downNodes.get(N[C]):this.upNodes.get(N[C]);
for(G=0;
G<I.length;
++G){H=I[G];
if(R.get(H)<=R.get(N[C])){A++;
}else{A--;
L.push({k:R.get(H)-this.getMinDist(N[C],N[O]),v:2});
}}L.push({k:R.get(N[C])-this.getMinDist(N[C],N[O]),v:A});
}if(P){L.push({k:R.get(P)-this.getMinDist(P,N[O]),v:Number.MAX_VALUE});
}L.sort(this._positionAscendingComparer);
var E=0,M=0;
var F=this.getMinDist(N[O-1],N[O]);
while(R.get(N[O])-R.get(N[O-1])<F){if(E<M){if(D.length===0){R.set(N[O-1],R.get(N[O])-F);
break;
}else{J=D.shift();
E=E+J.v;
R.set(N[O-1],J.k);
R.set(N[O-1],Math.max(R.get(N[O-1]),R.get(N[O])-F));
}}else{if(L.length===0){R.set(N[O],R.get(N[O-1])+F);
break;
}else{J=L.shift();
M=M+J.v;
R.set(N[O],J.k);
R.set(N[O],Math.min(R.get(N[O]),R.get(N[O-1])+F));
}}}for(C=O-2;
C>=0;
C--){R.set(N[C],Math.min(R.get(N[C]),R.get(N[O-1])-this.getMinDist(N[C],N[O-1])));
}for(C=O+1;
C<K;
C++){R.set(N[C],Math.max(R.get(N[C]),R.get(N[O])+this.getMinDist(N[C],N[O])));
}},placeLeft:function(C,B,A){var D=Number.NEGATIVE_INFINITY;
z.forEach(this._getComposite(C),function(F){var E=this.leftSibling(F);
if(E&&this.nodeLeftClass.get(E)===this.nodeLeftClass.get(F)){if(!B.containsKey(E)){this.placeLeft(E,B,A);
}D=Math.max(D,B.get(E)+this.getMinDist(E,F));
}},this);
if(D===Number.NEGATIVE_INFINITY){D=0;
}z.forEach(this._getComposite(C),function(E){B.set(E,D);
});
},placeRight:function(A,D,C){var B=Number.POSITIVE_INFINITY;
z.forEach(this._getComposite(A),function(F){var E=this.rightSibling(F);
if(E&&this.nodeRightClass.get(E)===this.nodeRightClass.get(F)){if(!D.containsKey(E)){this.placeRight(E,D,C);
}B=Math.min(B,D.get(E)-this.getMinDist(F,E));
}},this);
if(B===Number.POSITIVE_INFINITY){B=0;
}z.forEach(this._getComposite(A),function(E){D.set(E,B);
});
},leftSibling:function(C){var A=this.layers[C.layer],B=C.layerIndex;
return B===0?null:A[B-1];
},rightSibling:function(C){var A=this.layers[C.layer];
var B=C.layerIndex;
return B===A.length-1?null:A[B+1];
},_getComposite:function(A){return A.isVirtual?this._nodesInLink(A):[A];
},arrangeNodes:function(){var B,D,G,E,H;
for(D=0;
D<this.layers.length;
D++){E=this.layers[D];
for(G=0;
G<E.length;
G++){H=E[G];
H.upstreamPriority=H.upstreamLinkCount;
H.downstreamPriority=H.downstreamLinkCount;
}}var F=2;
for(var C=0;
C<F;
C++){for(B=this.layers.length-1;
B>=1;
B--){this.layoutLayer(false,B);
}for(B=0;
B<this.layers.length-1;
B++){this.layoutLayer(true,B);
}}var A=Number.MAX_VALUE;
for(D=0;
D<this.layers.length;
D++){E=this.layers[D];
for(G=0;
G<E.length;
G++){H=E[G];
A=Math.min(A,H.gridPosition);
}}if(A<0){for(D=0;
D<this.layers.length;
D++){E=this.layers[D];
for(G=0;
G<E.length;
G++){H=E[G];
H.gridPosition=H.gridPosition-A;
}}}},layoutLayer:function(B,D){var C;
var A;
if(B){A=this.layers[C=D+1];
}else{A=this.layers[C=D-1];
}var F=[];
for(var E=0;
E<A.length;
E++){F.push(A[E]);
}F.sort(function(G,I){var H=(G.upstreamPriority+G.downstreamPriority)/2;
var J=(I.upstreamPriority+I.downstreamPriority)/2;
if(Math.abs(H-J)<0.0001){return 0;
}if(H<J){return 1;
}return -1;
});
z.forEach(F,function(G){var I=G.gridPosition;
var H=this.calcBaryCenter(G);
var J=(G.upstreamPriority+G.downstreamPriority)/2;
if(Math.abs(I-H)<0.0001){return;
}if(Math.abs(I-H)<0.25+0.0001){return;
}if(I<H){while(I<H){if(!this.moveRight(G,A,J)){break;
}I=G.gridPosition;
}}else{while(I>H){if(!this.moveLeft(G,A,J)){break;
}I=G.gridPosition;
}}},this);
if(C>0){this.calcDownData(C-1);
}if(C<this.layers.length-1){this.calcUpData(C+1);
}},moveRight:function(C,B,D){var A=z.indexOf(B,C);
if(A===B.length-1){C.gridPosition=C.gridPosition+0.5;
return true;
}var E=B[A+1];
var F=(E.upstreamPriority+E.downstreamPriority)/2;
if(E.gridPosition>C.gridPosition+1){C.gridPosition=C.gridPosition+0.5;
return true;
}if(F>D||Math.abs(F-D)<0.0001){return false;
}if(this.moveRight(E,B,D)){C.gridPosition=C.gridPosition+0.5;
return true;
}return false;
},moveLeft:function(E,B,F){var A=z.indexOf(B,E);
if(A===0){E.gridPosition=E.gridPosition-0.5;
return true;
}var C=B[A-1];
var D=(C.upstreamPriority+C.downstreamPriority)/2;
if(C.gridPosition<E.gridPosition-1){E.gridPosition=E.gridPosition-0.5;
return true;
}if(D>F||Math.abs(D-F)<0.0001){return false;
}if(this.moveLeft(C,B,F)){E.gridPosition=E.gridPosition-0.5;
return true;
}return false;
},mapVirtualNode:function(B,A){this.nodeToLinkMap.set(B,A);
if(!this.linkToNodeMap.containsKey(A)){this.linkToNodeMap.set(A,[]);
}this.linkToNodeMap.get(A).push(B);
},_nodesInLink:function(A){return this.linkToNodeMap.get(this.nodeToLinkMap.get(A));
},_dummify:function(){this.linkToNodeMap=new g();
this.nodeToLinkMap=new g();
var G,R,L,M,S,K,E,F,J=this.graph.links.slice(0);
var H=this.layers;
var A=function(W,U,V){H[W].linksTo[U]=H[W].linksTo[U]||[];
H[W].linksTo[U].push(V);
};
for(F=0;
F<J.length;
F++){var I=J[F];
var N=I.source;
var B=I.target;
var O=N.layer;
var C=B.layer;
var P=N.gridPosition;
var D=B.gridPosition;
var T=(D-P)/Math.abs(C-O);
var Q=N;
if(O-C>1){for(E=O-1;
E>C;
E--){L=new q();
L.x=N.x;
L.y=N.y;
L.width=N.width/100;
L.height=N.height/100;
G=H[E];
R=(E-C)*T+P;
if(R>G.length){R=G.length;
}if(P>=H[O].length-1&&D>=H[C].length-1){R=G.length;
}else{if(P===0&&D===0){R=0;
}}L.layer=E;
L.uBaryCenter=0;
L.dBaryCenter=0;
L.upstreamLinkCount=0;
L.downstreamLinkCount=0;
L.gridPosition=R;
L.isVirtual=true;
z.insert(G,L,R);
for(S=R+1;
S<G.length;
S++){M=G[S];
M.gridPosition=M.gridPosition+1;
}K=new p(Q,L);
K.depthOfDumminess=0;
A(E-1,E,K);
Q=L;
this.graph._addNode(L);
this.graph.addLink(K);
L.index=this.graph.nodes.length-1;
this.mapVirtualNode(L,I);
}A(C-1,C,K);
I.changeSource(Q);
I.depthOfDumminess=O-C-1;
}else{if(O-C<-1){for(E=O+1;
E<C;
E++){L=new q();
L.x=N.x;
L.y=N.y;
L.width=N.width/100;
L.height=N.height/100;
G=H[E];
R=(E-O)*T+P;
if(R>G.length){R=G.length;
}if(P>=H[O].length-1&&D>=H[C].length-1){R=G.length;
}else{if(P===0&&D===0){R=0;
}}L.layer=E;
L.uBaryCenter=0;
L.dBaryCenter=0;
L.upstreamLinkCount=0;
L.downstreamLinkCount=0;
L.gridPosition=R;
L.isVirtual=true;
R&=R;
z.insert(G,L,R);
for(S=R+1;
S<G.length;
S++){M=G[S];
M.gridPosition=M.gridPosition+1;
}K=new p(Q,L);
K.depthOfDumminess=0;
A(E-1,E,K);
Q=L;
this.graph._addNode(L);
this.graph.addLink(K);
L.index=this.graph.nodes.length-1;
this.mapVirtualNode(L,I);
}A(C-1,C,I);
I.changeSource(Q);
I.depthOfDumminess=C-O-1;
}else{A(O,C,I);
}}}},_dedummify:function(){var B=true;
while(B){B=false;
for(var D=0;
D<this.graph.links.length;
D++){var E=this.graph.links[D];
if(!E.depthOfDumminess){continue;
}var G=[];
G.unshift({x:E.target.x,y:E.target.y});
G.unshift({x:E.source.x,y:E.source.y});
var I=E;
var C=E.depthOfDumminess;
for(var A=0;
A<C;
A++){var F=I.source;
var H=F.incoming[0];
G.unshift({x:H.source.x,y:H.source.y});
I=H;
}E.changeSource(I.source);
E.depthOfDumminess=0;
if(G.length>2){G.splice(0,1);
G.splice(G.length-1);
E.points=G;
}else{E.points=[];
}B=true;
break;
}}},_optimizeCrossings:function(){var D=-1,A;
var C=3;
var B=0;
while(D!==0){if(B++>C){break;
}D=0;
for(A=this.layers.length-1;
A>=1;
A--){D+=this.optimizeLayerCrossings(false,A);
}for(A=0;
A<this.layers.length-1;
A++){D+=this.optimizeLayerCrossings(true,A);
}}},calcUpData:function(D){if(D===0){return;
}var A=this.layers[D],B,C,E;
var J=new t();
var H=this.layers[D-1];
for(B=0;
B<H.length;
B++){J.add(H[B]);
}for(B=0;
B<A.length;
B++){var F=A[B];
var G=0;
var I=0;
for(C=0;
C<F.incoming.length;
C++){E=F.incoming[C];
if(J.contains(E.source)){I++;
G+=E.source.gridPosition;
}}for(C=0;
C<F.outgoing.length;
C++){E=F.outgoing[C];
if(J.contains(E.target)){I++;
G+=E.target.gridPosition;
}}if(I>0){F.uBaryCenter=G/I;
F.upstreamLinkCount=I;
}else{F.uBaryCenter=B;
F.upstreamLinkCount=0;
}}},calcDownData:function(E){if(E===this.layers.length-1){return;
}var A=this.layers[E],C,D,F;
var B=new t();
var I=this.layers[E+1];
for(C=0;
C<I.length;
C++){B.add(I[C]);
}for(C=0;
C<A.length;
C++){var G=A[C];
var H=0;
var J=0;
for(D=0;
D<G.incoming.length;
D++){F=G.incoming[D];
if(B.contains(F.source)){J++;
H+=F.source.gridPosition;
}}for(D=0;
D<G.outgoing.length;
D++){F=G.outgoing[D];
if(B.contains(F.target)){J++;
H+=F.target.gridPosition;
}}if(J>0){G.dBaryCenter=H/J;
G.downstreamLinkCount=J;
}else{G.dBaryCenter=C;
G.downstreamLinkCount=0;
}}},optimizeLayerCrossings:function(B,F){var D;
var A;
if(B){A=this.layers[D=F+1];
}else{A=this.layers[D=F-1];
}var I=A.slice(0);
if(B){this.calcUpData(D);
}else{this.calcDownData(D);
}var J=this;
A.sort(function(L,N){var M=J.calcBaryCenter(L),O=J.calcBaryCenter(N);
if(Math.abs(M-O)<0.0001){if(L.degree()===N.degree()){return J.compareByIndex(L,N);
}else{if(L.degree()<N.degree()){return 1;
}}return -1;
}var K=(O-M)*1000;
if(K>0){return -1;
}else{if(K<0){return 1;
}}return J.compareByIndex(L,N);
});
var C,G=0;
for(C=0;
C<A.length;
C++){if(A[C]!==I[C]){G++;
}}if(G>0){var E=0;
for(C=0;
C<A.length;
C++){var H=A[C];
H.gridPosition=E++;
}}return G;
},_swapPairs:function(){var J=this.options.layeredIterations;
var G=0;
while(true){if(G++>J){break;
}var E=G%4<=1;
var R=G%4===1;
for(var H=E?0:this.layers.length-1;
E?H<=this.layers.length-1:H>=0;
H+=E?1:-1){var I=this.layers[H];
var F=false;
var A=true;
var K=0;
for(var L=0;
L<I.length-1;
L++){var S=0;
var D=0;
var C=0;
if(A){if(H!==0){S=this.countLinksCrossingBetweenTwoLayers(H-1,H);
}if(H!==this.layers.length-1){D=this.countLinksCrossingBetweenTwoLayers(H,H+1);
}if(E){S*=2;
}else{D*=2;
}C=S+D;
}else{C=K;
}if(C===0){continue;
}var M=I[L];
var O=I[L+1];
var N=M.gridPosition;
var P=O.gridPosition;
I[L]=O;
I[L+1]=M;
M.gridPosition=P;
O.gridPosition=N;
S=0;
if(H!==0){S=this.countLinksCrossingBetweenTwoLayers(H-1,H);
}D=0;
if(H!==this.layers.length-1){D=this.countLinksCrossingBetweenTwoLayers(H,H+1);
}if(E){S*=2;
}else{D*=2;
}var B=S+D;
var Q=false;
if(R){Q=B>=C;
}else{Q=B>C;
}if(Q){M=I[L];
O=I[L+1];
N=M.gridPosition;
P=O.gridPosition;
I[L]=O;
I[L+1]=M;
M.gridPosition=P;
O.gridPosition=N;
K=C;
A=false;
}else{F=true;
A=true;
}}if(F){if(H!==this.layers.length-1){this.calcUpData(H+1);
}if(H!==0){this.calcDownData(H-1);
}}}}},countLinksCrossingBetweenTwoLayers:function(Q,B){var H=this.layers[Q].linksTo[B];
var F,G,I,K,M,O,C,D;
var A=0;
var E=H.length;
for(C=0;
C<E;
C++){F=H[C];
for(D=C+1;
D<E;
D++){G=H[D];
if(F.target.layer===B){I=F.source;
K=F.target;
}else{I=F.target;
K=F.source;
}if(G.target.layer===B){M=G.source;
O=G.target;
}else{M=G.target;
O=G.source;
}var J=I.gridPosition;
var L=K.gridPosition;
var N=M.gridPosition;
var P=O.gridPosition;
if((J-N)*(L-P)<0){A++;
}}}return A;
},calcBaryCenter:function(C){var E=C.upstreamLinkCount;
var B=C.downstreamLinkCount;
var D=C.uBaryCenter;
var A=C.dBaryCenter;
if(E>0&&B>0){return(D+A)/2;
}if(E>0){return D;
}if(B>0){return A;
}return 0;
},_gridPositionComparer:function(A,B){if(A.gridPosition<B.gridPosition){return -1;
}if(A.gridPosition>B.gridPosition){return 1;
}return 0;
},_positionAscendingComparer:function(A,B){return A.k<B.k?-1:A.k>B.k?1:0;
},_positionDescendingComparer:function(A,B){return A.k<B.k?1:A.k>B.k?-1:0;
},_firstVirtualNode:function(B){for(var A=0;
A<B.length;
A++){if(B[A].isVirtual){return A;
}}return -1;
},compareByIndex:function(C,D){var A=C.index;
var B=D.index;
if(A<B){return 1;
}if(A>B){return -1;
}return 0;
},intDiv:function(B,A){return(B-B%A)/A;
},nextVirtualNode:function(B,C){var D=C.layerIndex;
for(var A=D+1;
A<B.length;
++A){if(B[A].isVirtual){return B[A];
}}return null;
}});
var o=l.Class.extend({init:function(A,B){if(z.isUndefined(A)){throw"No diagram given";
}this.diagram=A;
this.nodeMap=new g();
this.linkMap=new g();
this.capture(B?B:A);
},capture:function(C){var G,H,I,D,A,E,F;
if(C instanceof e.Graph){for(D=0;
D<C.nodes.length;
D++){G=C.nodes[D];
I=G.associatedShape;
this.nodeMap.set(I.visual.id,new s(G.x,G.y,G.width,G.height));
}for(D=0;
D<C.links.length;
D++){E=C.links[D];
A=E.associatedConnection;
this.linkMap.set(A.visual.id,E.points());
}}else{if(C instanceof Array){H=C;
for(D=0;
D<H.length;
D++){G=H[D];
I=G.associatedShape;
if(I){this.nodeMap.set(I.visual.id,new s(G.x,G.y,G.width,G.height));
}}}else{if(C.hasOwnProperty("links")&&C.hasOwnProperty("nodes")){H=C.nodes;
F=C.links;
for(D=0;
D<H.length;
D++){G=H[D];
I=G.associatedShape;
if(I){this.nodeMap.set(I.visual.id,new s(G.x,G.y,G.width,G.height));
}}for(D=0;
D<F.length;
D++){E=F[D];
A=E.associatedConnection;
if(A){this.linkMap.set(A.visual.id,E.points);
}}}else{var J=this.diagram.shapes;
var B=this.diagram.connections;
for(D=0;
D<J.length;
D++){I=J[D];
this.nodeMap.set(I.visual.id,I.bounds());
}for(D=0;
D<B.length;
D++){A=B[D];
this.linkMap.set(A.visual.id,A.points());
}}}}}});
c(e,{init:function(A){l.init(A,e.ui);
},SpringLayout:v,TreeLayout:w,GraphAdapter:f,LayeredLayout:m,LayoutBase:n,LayoutState:o});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("dataviz/diagram/dom",["kendo.data","kendo.draganddrop","kendo.toolbar","kendo.editable","kendo.window","kendo.dropdownlist","kendo.dataviz.core","kendo.dataviz.themes","dataviz/diagram/svg","dataviz/diagram/services","dataviz/diagram/layout"],b);
}(function(){(function(a,bb){var z=kendo.dataviz,V=kendo.drawing,ad=kendo.geometry,O=z.diagram,be=kendo.ui.Widget,k=kendo.Class,aQ=a.proxy,A=kendo.deepExtend,aa=a.extend,ag=kendo.data.HierarchicalDataSource,f=O.Canvas,ae=O.Group,aU=O.Rectangle,j=O.Circle,p=O.CompositeTransform,aT=O.Rect,aL=O.Path,N=O.DeleteShapeUnit,M=O.DeleteConnectionUnit,a3=O.TextBlock,ah=O.Image,aM=O.Point,al=O.Intersect,s=O.ConnectionEditAdorner,bc=O.UndoRedoService,a6=O.ToolService,aZ=O.Selector,aV=O.ResizingAdorner,v=O.ConnectorsAdorner,y=O.Cursors,bd=O.Utils,aJ=kendo.Observable,a4=O.ToBackUnit,a5=O.ToFrontUnit,aN=O.PolylineRouter,h=O.CascadingRouter,at=bd.isUndefined,ao=bd.isDefined,L=kendo.util.defined,am=a.isArray,ap=kendo.isFunction,ar=bd.isString,aq=a.isPlainObject,ax=Math;
var aI=".kendoDiagram",g="cascading",au="itemBoundsChange",i="change",m="click",S="drag",T="dragEnd",U="dragStart",aD="mouseEnter",aE="mouseLeave",Z="error",c="Auto",a7="Top",aW="Right",aw="Left",d="Bottom",az=9007199254740992,aY="select",av="itemRotate",aK="pan",bj="zoomStart",bi="zoomEnd",aH="none",C=600,B=600,I="rectangle",J=100,E=100,G=20,F=20,H=0,D="Yellow",ay=Number.MAX_VALUE,aA=-Number.MAX_VALUE,b="absolute",a8="transformed",aX="rotated",ba="transparent",bf="width",af="height",bg="x",bh="y",aF="DOMMouseScroll"+aI+" mousewheel"+aI,aC=0.05,aB=5,e='<a class="k-button k-button-icontext #=className#" href="\\#"><span class="#=iconClass# #=imageClass#"></span>#=text#</a>',r=5;
O.DefaultConnectors=[{name:a7},{name:d},{name:aw},{name:aW},{name:c,position:function(X){return X.getPosition("center");
}}];
var K={cancel:{text:"Cancel",imageClass:"k-i-cancel",className:"k-diagram-cancel",iconClass:"k-icon"},update:{text:"Update",imageClass:"k-i-update",className:"k-diagram-update",iconClass:"k-icon"}};
O.shapeDefaults=function(Y){var X={type:I,path:"",autoSize:true,visual:null,x:H,y:H,minWidth:G,minHeight:F,width:J,height:E,hover:{},editable:{connect:true,tools:[]},connectors:O.DefaultConnectors,rotation:{angle:0}};
bd.simpleExtend(X,Y);
return X;
};
function aG(Y){var bk=Y.originalEvent,X=0;
if(bk.wheelDelta){X=-bk.wheelDelta/40;
X=X>0?ax.ceil(X):ax.floor(X);
}else{if(bk.detail){X=bk.detail;
}}return X;
}function an(X){return X.options.name.toLowerCase()===c.toLowerCase();
}function o(bn,Y){var bm=az,bo,X;
for(var bl=0;
bl<Y.length;
bl++){X=Y[bl];
if(!an(X)){var bk=bn.distanceTo(X.position());
if(bk<bm){bm=bk;
bo=X;
}}}return bo;
}function ak(Y,bp){var bk,bl=[],bo;
var X=Y.drawingContainer().children;
var bn=X.length;
for(bk=0;
bk<bp.length;
bk++){bo=bp[bk];
for(var bm=0;
bm<bn;
bm++){if(X[bm]==bo.drawingContainer()){bl.push(bm);
break;
}}}return bl;
}var Q=aJ.extend({init:function(X){var Y=this;
Y.dataItem=(X||{}).dataItem;
aJ.fn.init.call(Y);
Y.options=A({id:O.randomId()},Y.options,X);
Y.isSelected=false;
Y.visual=new ae({id:Y.options.id,autoSize:Y.options.autoSize});
Y.id=Y.options.id;
Y._template();
},options:{hover:{},cursor:y.grip,content:{align:"center middle"},selectable:true,serializable:true,enable:true},_getCursor:function(X){if(this.adorner){return this.adorner._getCursor(X);
}return this.options.cursor;
},visible:function(X){if(at(X)){return this.visual.visible();
}else{this.visual.visible(X);
}},bounds:function(){},refresh:function(){this.visual.redraw();
},position:function(X){this.options.x=X.x;
this.options.y=X.y;
this.visual.position(X);
},toString:function(){return this.options.id;
},serialize:function(){var X=A({},{options:this.options});
if(this.dataItem){X.dataItem=this.dataItem.toString();
}return X;
},_content:function(X){if(X!==bb){var bl=this.options;
if(O.Utils.isString(X)){bl.content.text=X;
}else{A(bl.content,X);
}var Y=bl.content;
var bk=this._contentVisual;
if(!bk){this._createContentVisual(Y);
}else{this._updateContentVisual(Y);
}}return this.options.content.text;
},_createContentVisual:function(X){if(X.text){this._contentVisual=new a3(X);
this._contentVisual._includeInBBox=false;
this.visual.append(this._contentVisual);
}},_updateContentVisual:function(X){this._contentVisual.redraw(X);
},_hitTest:function(Y){var X=this.bounds();
return this.visible()&&X.contains(Y)&&this.options.enable;
},_template:function(){var bk=this;
if(bk.options.content.template){var X=bk.dataItem||{},Y=kendo.template(bk.options.content.template,{paramName:"dataItem"});
bk.options.content.text=Y(X);
}},_canSelect:function(){return this.options.selectable!==false;
},toJSON:function(){return{id:this.options.id};
}});
var u=k.extend({init:function(Y,X){this.options=A({},this.options,X);
this.connections=[];
this.shape=Y;
},options:{width:7,height:7,fill:{color:D},hover:{}},position:function(){if(this.options.position){return this.options.position(this.shape);
}else{return this.shape.getPosition(this.options.name);
}},toJSON:function(){return{shapeId:this.shape.toString(),connector:this.options.name};
}});
u.parse=function(X,bn){var bo=bn.split(":"),bk=bo[0],bl=bo[1]||c;
for(var Y=0;
Y<X.shapes.length;
Y++){var bm=X.shapes[Y];
if(bm.options.id==bk){return bm.getConnector(bl.trim());
}}};
var a0=Q.extend({init:function(Y,X){var bk=this;
Q.fn.init.call(bk,Y);
this.diagram=X;
this.updateOptionsFromModel();
Y=bk.options;
bk.connectors=[];
bk.type=Y.type;
bk.createShapeVisual();
bk.updateBounds();
bk.content(bk.content());
bk._createConnectors();
},options:O.shapeDefaults(),_setOptionsFromModel:function(X){var Y=ac(X||this.dataItem);
this.options=A({},this.options,Y);
this.redrawVisual();
},updateOptionsFromModel:function(bk,Y){if(this.diagram&&this.diagram._isEditable){var bl=ac(bk||this.dataItem);
if(bk&&Y){if(!z.inArray(Y,["x","y","width","height"])){if(this.options.visual){this._redrawVisual();
}else{if(bl.type){this.options=A({},this.options,bl);
this._redrawVisual();
}}if(this.options.content){this._template();
this.content(this.options.content);
}}else{var X=this.bounds();
X[Y]=bk[Y];
this.bounds(X);
}}else{this.options=A({},this.options,bl);
}}},_redrawVisual:function(){this.visual.clear();
this._contentVisual=null;
this.options.dataItem=this.dataItem;
this.createShapeVisual();
this.updateBounds();
},redrawVisual:function(){this._redrawVisual();
if(this.options.content){this._template();
this.content(this.options.content);
}},updateModel:function(bl){var Y=this.diagram;
if(Y&&Y._isEditable){var X=this._bounds;
var bk=this.dataItem;
if(bk){Y._suspendModelRefresh();
if(L(bk.x)&&X.x!==bk.x){bk.set("x",X.x);
}if(L(bk.y)&&X.y!==bk.y){bk.set("y",X.y);
}if(L(bk.width)&&X.width!==bk.width){bk.set("width",X.width);
}if(L(bk.height)&&X.height!==bk.height){bk.set("height",X.height);
}this.dataItem=bk;
Y._resumeModelRefresh();
if(bl){Y._syncShapeChanges();
}}}},updateBounds:function(){var X=this.visual._measure(true);
var Y=this.options;
this.bounds(new aT(Y.x,Y.y,X.width,X.height));
this._rotate();
this._alignContent();
},content:function(X){var Y=this._content(X);
this._alignContent();
return Y;
},_alignContent:function(){var bm=this.options.content||{};
var bo=this._contentVisual;
if(bo&&bm.align){var bk=this.visual._measure();
var Y=new O.RectAlign(bk);
var bl=bo.drawingElement.bbox(null);
var bn=new aT(0,0,bl.width(),bl.height());
var X=Y.align(bn,bm.align);
bo.position(X.topLeft());
}},_createConnectors:function(){var bm=this.options,bl=bm.connectors.length,Y=bm.connectorDefaults,X,bk;
for(bk=0;
bk<bl;
bk++){X=new u(this,A({},Y,bm.connectors[bk]));
this.connectors.push(X);
}},bounds:function(bk){var X;
if(bk){if(ar(bk)){switch(bk){case a8:X=this._transformedBounds();
break;
case b:X=this._transformedBounds();
var Y=this.diagram._pan;
X.x+=Y.x;
X.y+=Y.y;
break;
case aX:X=this._rotatedBounds();
break;
default:X=this._bounds;
}}else{this._setBounds(bk);
this._triggerBoundsChange();
if(!(this.diagram&&this.diagram._layouting)){this.refreshConnections();
}}}else{X=this._bounds;
}return X;
},_setBounds:function(bk){var Y=this.options;
var bl=bk.topLeft();
var bn=Y.x=bl.x;
var bo=Y.y=bl.y;
var bm=Y.width=ax.max(bk.width,Y.minWidth);
var X=Y.height=ax.max(bk.height,Y.minHeight);
this._bounds=new aT(bn,bo,bm,X);
this.visual.redraw({x:bn,y:bo,width:bm,height:X});
},position:function(X){if(X){this.bounds(new aT(X.x,X.y,this._bounds.width,this._bounds.height));
}else{return this._bounds.topLeft();
}},clone:function(){var X=this.serialize();
X.options.id=O.randomId();
if(this.diagram&&this.diagram._isEditable&&L(this.dataItem)){X.options.dataItem=n(this.dataItem);
}return new a0(X.options);
},select:function(bl){var Y=this.diagram,bk,X;
if(at(bl)){bl=true;
}if(this._canSelect()){if(this.isSelected!=bl){bk=[];
X=[];
this.isSelected=bl;
if(this.isSelected){Y._selectedItems.push(this);
bk.push(this);
}else{bd.remove(Y._selectedItems,this);
X.push(this);
}if(!Y._internalSelection){Y._selectionChanged(bk,X);
}return true;
}}},rotate:function(X,bk,bp){var bn=this.visual.rotate();
if(X!==bb){if(bp!==false&&this.diagram&&this.diagram.undoRedoService&&X!==bn.angle){this.diagram.undoRedoService.add(new O.RotateUnit(this.diagram._resizingAdorner,[this],[bn.angle]),false);
}var Y=this.bounds(),bo=new aM(Y.width/2,Y.height/2),bl,bm;
if(bk){bl=X-bn.angle;
bm=Y.center().rotate(bk,360-bl).minus(bo);
this._rotationOffset=this._rotationOffset.plus(bm.minus(Y.topLeft()));
this.position(bm);
}this.visual.rotate(X,bo);
this.options.rotation.angle=X;
if(this.diagram&&this.diagram._connectorsAdorner){this.diagram._connectorsAdorner.refresh();
}this.refreshConnections();
if(this.diagram){this.diagram.trigger(av,{item:this});
}}return bn;
},connections:function(bq){var bn=[],bl,bm,X,Y,bk;
for(bl=0;
bl<this.connectors.length;
bl++){bk=this.connectors[bl];
Y=bk.connections;
for(bm=0,Y;
bm<Y.length;
bm++){X=Y[bm];
if(bq=="out"){var bo=X.source();
if(bo.shape&&bo.shape==this){bn.push(X);
}}else{if(bq=="in"){var bp=X.target();
if(bp.shape&&bp.shape==this){bn.push(X);
}}else{bn.push(X);
}}}}return bn;
},refreshConnections:function(){a.each(this.connections(),function(){this.refresh();
});
},getConnector:function(bk){var Y,X;
if(ar(bk)){bk=bk.toLocaleLowerCase();
for(Y=0;
Y<this.connectors.length;
Y++){X=this.connectors[Y];
if(X.options.name.toLocaleLowerCase()==bk){return X;
}}}else{if(bk instanceof aM){return o(bk,this.connectors);
}else{return this.connectors.length?this.connectors[0]:null;
}}},getPosition:function(bk){var X=this.bounds(),Y=bk.charAt(0).toLowerCase()+bk.slice(1);
if(ap(X[Y])){return this._transformPoint(X[Y]());
}return X.center();
},redraw:function(Y){if(Y){var bk=this.options;
var X;
this.shapeVisual.redraw(this._visualOptions(Y));
if(this._diffNumericOptions(Y,[bf,af,bg,bh])){this.bounds(new aT(bk.x,bk.y,bk.width,bk.height));
X=true;
}if(Y.connectors){bk.connectors=Y.connectors;
this._updateConnectors();
}bk=A(bk,Y);
if(Y.rotation||X){this._rotate();
}if(bk.content){this.content(bk.content);
}}},_updateConnectors:function(){var Y=this.connections();
this.connectors=[];
this._createConnectors();
var X;
var bl;
var bm;
for(var bk=0;
bk<Y.length;
bk++){X=Y[bk];
bl=X.source();
bm=X.target();
if(bl.shape&&bl.shape===this){X.source(this.getConnector(bl.options.name)||null);
}else{if(bm.shape&&bm.shape===this){X.target(this.getConnector(bm.options.name)||null);
}}X.updateModel();
}},_diffNumericOptions:O.diffNumericOptions,_visualOptions:function(X){return{data:X.path,source:X.source,hover:X.hover,fill:X.fill,stroke:X.stroke};
},_triggerBoundsChange:function(){if(this.diagram){this.diagram.trigger(au,{item:this,bounds:this._bounds.clone()});
}},_transformPoint:function(Y){var bk=this.rotate(),X=this.bounds(),bl=X.topLeft();
if(bk.angle){Y.rotate(bk.center().plus(bl),360-bk.angle);
}return Y;
},_transformedBounds:function(){var X=this.bounds(),bk=X.topLeft(),Y=X.bottomRight();
return aT.fromPoints(this.diagram.modelToView(bk),this.diagram.modelToView(Y));
},_rotatedBounds:function(){var X=this.bounds().rotatedBounds(this.rotate().angle),bk=X.topLeft(),Y=X.bottomRight();
return aT.fromPoints(bk,Y);
},_rotate:function(){var X=this.options.rotation;
if(X&&X.angle){this.rotate(X.angle);
}this._rotationOffset=new aM();
},_hover:function(bm){var bk=this.options,Y=bk.hover,bl=bk.stroke,X=bk.fill;
if(bm&&ao(Y.stroke)){bl=A({},bl,Y.stroke);
}if(bm&&ao(Y.fill)){X=Y.fill;
}this.shapeVisual.redraw({stroke:bl,fill:X});
if(bk.editable&&bk.editable.connect){this.diagram._showConnectors(this,bm);
}},_hitTest:function(bl){if(this.visible()){var Y=this.bounds(),bk,X=this.rotate().angle;
if(bl.isEmpty&&!bl.isEmpty()){return al.rects(bl,Y,X?X:0);
}else{bk=bl.clone().rotate(Y.center(),X);
if(Y.contains(bk)){return this;
}}}},toJSON:function(){return{shapeId:this.options.id};
},createShapeVisual:function(){var X=this.options;
var bl=this._visualOptions(X);
var bm=X.visual;
var bk=(X.type+"").toLocaleLowerCase();
var Y;
bl.width=X.width;
bl.height=X.height;
if(ap(bm)){Y=bm.call(this,X);
}else{if(bl.data){Y=new aL(bl);
a9(Y);
}else{if(bk=="rectangle"){Y=new aU(bl);
}else{if(bk=="circle"){Y=new j(bl);
}else{if(bk=="text"){Y=new a3(bl);
}else{if(bk=="image"){Y=new ah(bl);
}else{Y=new aL(bl);
}}}}}}this.shapeVisual=Y;
this.visual.append(this.shapeVisual);
}});
var q=Q.extend({init:function(X,bl,Y){var bk=this;
Q.fn.init.call(bk,Y);
this.updateOptionsFromModel();
this._initRouter();
bk.path=new O.Polyline(bk.options);
bk.path.fill(ba);
bk.visual.append(bk.path);
bk._sourcePoint=bk._targetPoint=new aM();
bk._setSource(X);
bk._setTarget(bl);
bk.content(bk.options.content);
bk.definers=[];
if(L(Y)&&Y.points){bk.points(Y.points);
}},options:{hover:{stroke:{}},startCap:aH,endCap:aH,points:[],selectable:true,fromConnector:c,toConenctor:c},_setOptionsFromModel:function(X){this.updateOptionsFromModel(X||this.dataItem);
},updateOptionsFromModel:function(bk){if(this.diagram&&this.diagram._isEditable){var X=this.diagram._dataMap;
var bl=ab(bk||this.dataItem);
if(bk){if(L(bl.from)){var Y=X[bl.from];
if(Y&&L(bl.fromConnector)){Y=Y.getConnector(bl.fromConnector);
}this.source(Y);
}else{if(L(bl.fromX)&&L(bl.fromY)){this.source(new aM(bl.fromX,bl.fromY));
}}if(L(bl.to)){var bm=X[bl.to];
if(bm&&L(bl.toConnector)){bm=bm.getConnector(bl.toConnector);
}this.target(bm);
}else{if(L(bl.toX)&&L(bl.toY)){this.target(new aM(bl.toX,bl.toY));
}}if(L(bl.type)&&this.type()!==bl.type){this.points([]);
this.type(bl.type);
}this.dataItem=bk;
this._template();
this.redraw(this.options);
}else{this.options=A({},bl,this.options);
}}},updateModel:function(Y){if(this.diagram&&this.diagram._isEditable){if(this.diagram.connectionsDataSource){var X=this.diagram.connectionsDataSource.getByUid(this.dataItem.uid);
if(X){this.diagram._suspendModelRefresh();
if(L(this.options.fromX)&&this.options.fromX!==null){l("from",X);
l("fromConnector",X);
X.set("fromX",this.options.fromX);
X.set("fromY",this.options.fromY);
}else{X.set("from",this.options.from);
if(L(X.fromConnector)){X.set("fromConnector",this.sourceConnector?this.sourceConnector.options.name:null);
}l("fromX",X);
l("fromY",X);
}if(L(this.options.toX)&&this.options.toX!==null){l("to",X);
l("toConnector",X);
X.set("toX",this.options.toX);
X.set("toY",this.options.toY);
}else{X.set("to",this.options.to);
if(L(X.toConnector)){X.set("toConnector",this.targetConnector?this.targetConnector.options.name:null);
}l("toX",X);
l("toY",X);
}if(L(this.options.type)&&L(X.type)){X.set("type",this.options.type);
}this.dataItem=X;
this.diagram._resumeModelRefresh();
if(Y){this.diagram._syncConnectionChanges();
}}}}},sourcePoint:function(){return this._resolvedSourceConnector?this._resolvedSourceConnector.position():this._sourcePoint;
},_setSource:function(bl){var bk=bl instanceof a0;
var Y=this.options.fromConnector||c;
var X;
if(bk&&!bl.getConnector(Y)){return;
}if(bl!==bb){this.from=bl;
}this._removeFromSourceConnector();
if(bl===null){if(this.sourceConnector){this._sourcePoint=(this._resolvedSourceConnector||this.sourceConnector).position();
this._clearSourceConnector();
this._setFromOptions(null,this._sourcePoint);
}}else{if(bl instanceof u){X=bl.shape.dataItem;
if(X){this._setFromOptions(X.id);
}this.sourceConnector=bl;
this.sourceConnector.connections.push(this);
}else{if(bl instanceof aM){this._setFromOptions(null,bl);
this._sourcePoint=bl;
if(this.sourceConnector){this._clearSourceConnector();
}}else{if(bk){X=bl.dataItem;
if(X){this._setFromOptions(X.id);
}this.sourceConnector=bl.getConnector(Y);
this.sourceConnector.connections.push(this);
}}}}},source:function(X,Y){if(ao(X)){if(Y&&this.diagram){this.diagram.undoRedoService.addCompositeItem(new O.ConnectionEditUnit(this,X));
}this._setSource(X);
this.refresh();
}return this.sourceConnector?this.sourceConnector:this._sourcePoint;
},_setFromOptions:function(X,Y){this.options.from=X;
if(Y){this.options.fromX=Y.x;
this.options.fromY=Y.y;
}else{this.options.fromX=null;
this.options.fromY=null;
}},sourceDefiner:function(X){if(X){if(X instanceof O.PathDefiner){X.left=null;
this._sourceDefiner=X;
this.source(X.point);
}else{throw"The sourceDefiner needs to be a PathDefiner.";
}}else{if(!this._sourceDefiner){this._sourceDefiner=new O.PathDefiner(this.sourcePoint(),null,null);
}return this._sourceDefiner;
}},targetPoint:function(){return this._resolvedTargetConnector?this._resolvedTargetConnector.position():this._targetPoint;
},_setTarget:function(bl){var bk=bl instanceof a0;
var Y=this.options.toConnector||c;
var X;
if(bk&&!bl.getConnector(Y)){return;
}if(bl!==bb){this.to=bl;
}this._removeFromTargetConnector();
if(bl===null){if(this.targetConnector){this._targetPoint=(this._resolvedTargetConnector||this.targetConnector).position();
this._clearTargetConnector();
this._setToOptions(null,this._targetPoint);
}}else{if(bl instanceof u){X=bl.shape.dataItem;
if(X){this._setToOptions(X.id);
}this.targetConnector=bl;
this.targetConnector.connections.push(this);
}else{if(bl instanceof aM){this._setToOptions(null,bl);
this._targetPoint=bl;
if(this.targetConnector){this._clearTargetConnector();
}}else{if(bk){X=bl.dataItem;
if(X){this._setToOptions(X.id);
}this.targetConnector=bl.getConnector(Y);
this.targetConnector.connections.push(this);
}}}}},target:function(X,Y){if(ao(X)){if(Y&&this.diagram){this.diagram.undoRedoService.addCompositeItem(new O.ConnectionEditUnit(this,bb,X));
}this._setTarget(X);
this.refresh();
}return this.targetConnector?this.targetConnector:this._targetPoint;
},_setToOptions:function(X,Y){this.options.to=X;
if(Y){this.options.toX=Y.x;
this.options.toY=Y.y;
}else{this.options.toX=null;
this.options.toY=null;
}},targetDefiner:function(X){if(X){if(X instanceof O.PathDefiner){X.right=null;
this._targetDefiner=X;
this.target(X.point);
}else{throw"The sourceDefiner needs to be a PathDefiner.";
}}else{if(!this._targetDefiner){this._targetDefiner=new O.PathDefiner(this.targetPoint(),null,null);
}return this._targetDefiner;
}},_updateConnectors:function(){this._updateConnector(this.source(),"source");
this._updateConnector(this.target(),"target");
},_updateConnector:function(bm,bn){var bp=this;
var bk=bp.diagram;
if(bm instanceof u&&!bk.getShapeById(bm.shape.id)){var Y=bm.shape.dataItem;
var X=bm.options.name;
var bo=function(){var bq=bk._dataMap[Y.id];
bm=bq.getConnector(X);
bp[bn](bm,false);
bp.updateModel();
};
if(bk._dataMap[Y.id]){bo();
}else{var bl=bk._inactiveShapeItems.getByUid(Y.uid);
if(bl){bk._deferredConnectionUpdates.push(bl.onActivate(bo));
}}}else{bp[bn](bm,false);
}},content:function(X){var Y=this._content(X);
if(L(X)){this._alignContent();
}return Y;
},_createContentVisual:function(X){var Y;
if(ap(X.visual)){Y=X.visual.call(this,X);
}else{if(X.text){Y=new a3(X);
}}if(Y){this._contentVisual=Y;
Y._includeInBBox=false;
this.visual.append(Y);
}return Y;
},_updateContentVisual:function(X){if(ap(X.visual)){this.visual.remove(this._contentVisual);
this._createContentVisual(X);
}else{this._contentVisual.redraw(X);
}},_alignContent:function(){if(this._contentVisual){var bq=r;
var bu=this.allPoints();
var bm=ax.floor(bu.length/2);
var bv=bm-1;
while(bv>0&&bu[bv].equals(bu[bm])){bv--;
bm++;
}var bn=bu[bm];
var bw=bu[bv];
var bk=this._contentVisual._measure();
var bx=bk.width;
var bo=bk.height;
var X=bu.length%2===0;
var bl=bw.distanceTo(bn);
if(X&&bu.length>2&&bl>0&&(bw.y===bn.y&&bl<bx||bw.x===bn.x&&bl<bo)){X=false;
bq=0;
}var bt;
if(X){var Y=kendo.util.deg(ax.atan2(bn.y-bw.y,bn.x-bw.x));
bt=new aM((bn.x-bw.x)/2+bw.x,(bn.y-bw.y)/2+bw.y);
if(ax.abs(Y)===90){bt.x+=bq;
bt.y-=bo/2;
}else{if(Y%180===0){bt.x-=bx/2;
bt.y-=bo+bq;
}else{if(Y<-90||0<Y&&Y<90){bt.y-=bo;
}else{if(Y<0||Y>90){bt.x-=bx;
bt.y-=bo;
}}}}}else{var bp=ax.floor(bu.length/2);
bt=bu[bp].clone();
bw=bu[bp-1];
bn=bu[bp+1];
var br=bw.x<=bt.x&&bn.x<=bt.x?bq:-bk.width-bq;
var bs=bw.y<=bt.y&&bn.y<=bt.y?bq:-bk.height-bq;
bt.x+=br;
bt.y+=bs;
}this._contentVisual.position(bt);
}},select:function(bl){var Y=this.diagram,bk,X;
if(this._canSelect()){if(this.isSelected!==bl){this.isSelected=bl;
bk=[];
X=[];
if(this.isSelected){this.adorner=new s(this,this.options.selection);
Y._adorn(this.adorner,true);
Y._selectedItems.push(this);
bk.push(this);
}else{if(this.adorner){Y._adorn(this.adorner,false);
bd.remove(Y._selectedItems,this);
this.adorner=bb;
X.push(this);
}}if(this.adorner){this.adorner.refresh();
}if(!Y._internalSelection){Y._selectionChanged(bk,X);
}return true;
}}},bounds:function(X){if(X&&!ar(X)){this._bounds=X;
}else{return this._bounds;
}},type:function(Y){var X=this.options;
if(Y){if(Y!==X.type){X.type=Y;
this._initRouter();
this.refresh();
}}else{return X.type;
}},_initRouter:function(){var X=(this.options.type||"").toLowerCase();
if(X==g){this._router=new h(this);
}else{this._router=new aN(this);
}},points:function(bm){if(bm){this.definers=[];
for(var Y=0;
Y<bm.length;
Y++){var X=bm[Y];
if(X instanceof O.Point){this.definers.push(new O.PathDefiner(X));
}else{if(X.hasOwnProperty("x")&&X.hasOwnProperty("y")){this.definers.push(new O.PathDefiner(new aM(X.x,X.y)));
}else{throw"A Connection point needs to be a Point or an object with x and y properties.";
}}}}else{var bl=[];
if(ao(this.definers)){for(var bk=0;
bk<this.definers.length;
bk++){bl.push(this.definers[bk].point);
}}return bl;
}},allPoints:function(){var Y=[this.sourcePoint()];
if(this.definers){for(var X=0;
X<this.definers.length;
X++){Y.push(this.definers[X].point);
}}Y.push(this.targetPoint());
return Y;
},refresh:function(){this._resolveConnectors();
this._refreshPath();
this._alignContent();
if(this.adorner){this.adorner.refresh();
}},_resolveConnectors:function(){var X=this,bl,bo,bk,bn,Y=X.source(),bm=X.target();
if(Y instanceof aM){bl=Y;
}else{if(Y instanceof u){if(an(Y)){bk=Y.shape.connectors;
}else{bk=[Y];
}}}if(bm instanceof aM){bo=bm;
}else{if(bm instanceof u){if(an(bm)){bn=bm.shape.connectors;
}else{bn=[bm];
}}}if(bl){if(bn){X._resolvedTargetConnector=o(bl,bn);
}}else{if(bk){if(bo){X._resolvedSourceConnector=o(bo,bk);
}else{if(bn){this._resolveAutoConnectors(bk,bn);
}}}}},_resolveAutoConnectors:function(bq,bu){var bk=az;
var Y=az;
var bl,bm;
var bs,bw;
var bn,bo;
var bp,bt;
var br,bv;
var X;
for(br=0;
br<bq.length;
br++){bp=bq[br];
if(!an(bp)){bs=bp.position();
for(bv=0;
bv<bu.length;
bv++){bt=bu[bv];
if(!an(bt)){bw=bt.position();
X=ax.round(bs.distanceTo(bw));
if(X<bk&&this.diagram&&this._testRoutePoints(bs,bw,bp,bt)){bk=X;
bl=bp;
bm=bt;
}if(X<Y){bn=bp;
bo=bt;
Y=X;
}}}}}if(bl){bn=bl;
bo=bm;
}this._resolvedSourceConnector=bn;
this._resolvedTargetConnector=bo;
},_testRoutePoints:function(bp,bs,bo,br){var bn=this._router;
var bk=true;
if(bn instanceof h){var bl=bn.routePoints(bp,bs,bo,br),bq,X,bm;
bl.unshift(bp);
bl.push(bs);
for(var Y=1;
Y<bl.length;
Y++){bq=bl[Y-1];
X=bl[Y];
bm=new aT(ax.min(bq.x,X.x),ax.min(bq.y,X.y),ax.abs(bq.x-X.x),ax.abs(bq.y-X.y));
if(bm.width>0){bm.x++;
bm.width-=2;
}if(bm.height>0){bm.y++;
bm.height-=2;
}if(!bm.isEmpty()&&this.diagram._shapesQuadTree.hitTestRect(bm)){bk=false;
break;
}}}return bk;
},redraw:function(X){if(X){this.options=A({},this.options,X);
var Y=this.options.points;
if(L(Y)&&Y.length>0){this.points(Y);
this._refreshPath();
}if(X&&X.content||X.text){this.content(X.content);
}this.path.redraw({fill:X.fill,stroke:X.stroke,startCap:X.startCap,endCap:X.endCap});
}},clone:function(){var X=this.serialize();
if(this.diagram&&this.diagram._isEditable&&L(this.dataItem)){X.options.dataItem=n(this.dataItem);
}return new q(this.from,this.to,X.options);
},serialize:function(){var X=this.from.toJSON?this.from.toJSON:this.from.toString(),bk=this.to.toJSON?this.to.toJSON:this.to.toString();
var Y=A({},{options:this.options,from:X,to:bk});
if(L(this.dataItem)){Y.dataItem=this.dataItem.toString();
}Y.options.points=this.points();
return Y;
},_hitTest:function(bl){if(this.visible()){var Y=new aM(bl.x,bl.y),X=this.sourcePoint(),bk=this.targetPoint();
if(bl.isEmpty&&!bl.isEmpty()&&bl.contains(X)&&bl.contains(bk)){return this;
}if(this._router.hitTest(Y)){return this;
}}},_hover:function(Y){var X=(this.options.stroke||{}).color;
if(Y&&ao(this.options.hover.stroke.color)){X=this.options.hover.stroke.color;
}this.path.redraw({stroke:{color:X}});
},_refreshPath:function(){if(!L(this.path)){return;
}this._drawPath();
this.bounds(this._router.getBounds());
},_drawPath:function(){if(this._router){this._router.route();
}var Y=this.sourcePoint();
var bk=this.targetPoint();
var X=this.points();
this.path.redraw({points:[Y].concat(X,[bk])});
},_clearSourceConnector:function(){this.sourceConnector=bb;
this._resolvedSourceConnector=bb;
},_clearTargetConnector:function(){this.targetConnector=bb;
this._resolvedTargetConnector=bb;
},_removeFromSourceConnector:function(){if(this.sourceConnector){bd.remove(this.sourceConnector.connections,this);
}},_removeFromTargetConnector:function(){if(this.targetConnector){bd.remove(this.targetConnector.connections,this);
}},toJSON:function(){var X=this;
var Y,bl,bk;
if(X.from&&X.from.toJSON){Y=X.from.toJSON();
}else{bk=X._sourcePoint;
Y={x:bk.x,y:bk.y};
}if(X.to&&X.to.toJSON){bl=X.to.toJSON();
}else{bk=X._targetPoint;
bl={x:bk.x,y:bk.y};
}return{from:Y,to:bl};
}});
var P=be.extend({init:function(X,bk){var Y=this;
kendo.destroy(X);
be.fn.init.call(Y,X,bk);
Y._initTheme();
Y._initElements();
Y._extendLayoutOptions(Y.options);
Y._initDefaults(bk);
Y._interactionDefaults();
Y._initCanvas();
Y.mainLayer=new ae({id:"main-layer"});
Y.canvas.append(Y.mainLayer);
Y._shapesQuadTree=new a1(Y);
Y._pan=new aM();
Y._adorners=[];
Y.adornerLayer=new ae({id:"adorner-layer"});
Y.canvas.append(Y.adornerLayer);
Y._createHandlers();
Y._initialize();
Y._resizingAdorner=new aV(Y,{editable:Y.options.editable});
Y._connectorsAdorner=new v(Y);
Y._adorn(Y._resizingAdorner,true);
Y._adorn(Y._connectorsAdorner,true);
Y.selector=new aZ(Y);
Y._clipboard=[];
Y.pauseMouseHandlers=false;
Y._fetchFreshData();
Y._createGlobalToolBar();
Y._createOptionElements();
Y.zoom(Y.options.zoom);
Y.canvas.draw();
},options:{name:"Diagram",theme:"default",layout:"",zoomRate:0.1,zoom:1,zoomMin:0,zoomMax:2,dataSource:{},draggable:true,template:"",autoBind:true,editable:{rotate:{},resize:{},text:true,tools:[],drag:{snap:{size:10,angle:10}},remove:true},pannable:{},selectable:{key:"none"},tooltip:{enabled:true,format:"{0}"},copy:{enabled:true,offsetX:20,offsetY:20},shapeDefaults:O.shapeDefaults({undoable:true}),connectionDefaults:{editable:{tools:[]},type:g},shapes:[],connections:[]},events:[bi,bj,aK,aY,av,au,i,m,aD,aE,"toolBarClick","save","cancel","edit","remove","add","dataBound",U,S,T],items:function(){return a();
},_createGlobalToolBar:function(){var X=this.options.editable;
if(X){var Y=X.tools;
if(this._isEditable&&Y!==false&&(!Y||Y.length===0)){Y=["createShape","undo","redo","rotateClockwise","rotateAnticlockwise"];
}if(Y&&Y.length){this.toolBar=new R(this,{tools:Y||{},click:aQ(this._toolBarClick,this),modal:false});
this.toolBar.element.css({textAlign:"left"});
this.element.prepend(this.toolBar.element);
this._resize();
}}},createShape:function(){if(this.editor&&this.editor.end()||!this.editor){var X=this.dataSource;
var bn=X.view()||[];
var bk=bn.length;
var bl=x(X,{});
var bm=this._createShape(bl,{});
if(!this.trigger("add",{shape:bm})){X.insert(bk,bl);
var Y=this._inactiveShapeItems.getByUid(bl.uid);
Y.element=bm;
this.edit(bm);
}}},_createShape:function(X,Y){Y=A({},this.options.shapeDefaults,Y);
Y.dataItem=X;
var bk=new a0(Y,this);
return bk;
},createConnection:function(){if(this.editor&&this.editor.end()||!this.editor){var Y=this.connectionsDataSource;
var bm=Y.view()||[];
var bk=bm.length;
var bl=x(Y,{});
var X=this._createConnection(bl);
if(!this.trigger("add",{connection:X})){this._connectionsDataMap[bl.uid]=X;
Y.insert(bk,bl);
this.addConnection(X,false);
this.edit(X);
}}},_createConnection:function(Y,bl,bm){var bk=A({},this.options.connectionDefaults);
bk.dataItem=Y;
var X=new q(bl||new aM(),bm||new aM(),bk);
return X;
},editModel:function(Y,bm){this.cancelEdit();
var bl,bn;
var bk=this.options.editable;
if(bm=="shape"){bl=bk.shapeEditors;
bn=bk.shapeTemplate;
}else{if(bm=="connection"){var X=aQ(t,this);
bl=A({},{from:X,to:X},bk.connectionEditors);
bn=bk.connectionTemplate;
}else{return;
}}this.editor=new aO(this.element,{update:aQ(this._update,this),cancel:aQ(this._cancel,this),model:Y,type:bm,target:this,editors:bl,template:bn});
this.trigger("edit",this._editArgs());
},edit:function(Y){if(Y.dataItem){var X=Y instanceof a0?"shape":"connection";
this.editModel(Y.dataItem,X);
}},cancelEdit:function(){if(this.editor){this._getEditDataSource().cancelChanges(this.editor.model);
this._destroyEditor();
}},saveEdit:function(){if(this.editor&&this.editor.end()&&!this.trigger("save",this._editArgs())){this._getEditDataSource().sync();
}},_update:function(){if(this.editor&&this.editor.end()&&!this.trigger("save",this._editArgs())){this._getEditDataSource().sync();
this._destroyEditor();
}},_cancel:function(){if(this.editor&&!this.trigger("cancel",this._editArgs())){var Y=this.editor.model;
this._getEditDataSource().cancelChanges(Y);
var X=this._connectionsDataMap[Y.uid]||this._dataMap[Y.id];
if(X){X._setOptionsFromModel(Y);
}this._destroyEditor();
}},_getEditDataSource:function(){return this.editor.options.type==="shape"?this.dataSource:this.connectionsDataSource;
},_editArgs:function(){var X={container:this.editor.wrapper};
X[this.editor.options.type]=this.editor.model;
return X;
},_destroyEditor:function(){if(this.editor){this.editor.close();
this.editor=null;
}},_initElements:function(){this.wrapper=this.element.empty().css("position","relative").attr("tabindex",0).addClass("k-widget k-diagram");
this.scrollable=a("<div />").appendTo(this.element);
},_initDefaults:function(bm){var bk=this.options;
var Y=bk.editable;
var bl=bk.shapeDefaults;
var X=bk.connectionDefaults;
var bn=(bm||{}).shapeDefaults;
if(Y===false){bl.editable=false;
X.editable=false;
}else{w(Y,bl.editable,["drag","remove","connect"]);
w(Y,X.editable,["drag","remove"]);
}if(bn&&bn.connectors){bk.shapeDefaults.connectors=bn.connectors;
}},_interactionDefaults:function(){var Y=this.options;
var bl=Y.selectable;
var bk=Y.pannable;
var X=kendo.support.mobileOS;
if(bl&&!L(bl.multiple)){Y.selectable=A({multiple:X?false:true},Y.selectable);
}if(bk&&!L(bk.key)){Y.pannable=A({key:X?"none":"ctrl"},Y.pannable);
}},_initCanvas:function(){var X=a("<div class='k-layer'></div>").appendTo(this.scrollable)[0];
var Y=this.viewport();
this.canvas=new f(X,{width:Y.width||C,height:Y.height||B});
},_createHandlers:function(){var Y=this;
var X=Y.element;
X.on(aF,aQ(Y._wheel,Y)).on("keydown"+aI,aQ(Y._keydown,Y));
Y._userEvents=new kendo.UserEvents(this.scrollable,{multiTouch:true,fastTap:true,tap:aQ(Y._tap,Y),start:aQ(Y._dragStart,Y),move:aQ(Y._drag,Y),end:aQ(Y._dragEnd,Y),gesturestart:aQ(Y._gestureStart,Y),gesturechange:aQ(Y._gestureChange,Y),gestureend:aQ(Y._gestureEnd,Y)});
Y.toolService=new a6(Y);
this.scrollable.on("mouseover"+aI,aQ(Y._mouseover,Y)).on("mouseout"+aI,aQ(Y._mouseout,Y)).on("mousemove"+aI,aQ(Y._mouseMove,Y));
this._syncHandler=aQ(Y._syncChanges,Y);
Y._resizeHandler=aQ(Y.resize,Y,false);
kendo.onResize(Y._resizeHandler);
this.bind(bj,aQ(Y._destroyToolBar,Y));
this.bind(aK,aQ(Y._destroyToolBar,Y));
},_dragStart:function(X){this._pauseMouseHandlers=true;
var bk=this._eventPositions(X,true);
var Y=X.event;
if(this.toolService.start(bk,this._meta(Y))){this._destroyToolBar();
Y.preventDefault();
}},_drag:function(X){var bk=this._eventPositions(X);
var Y=X.event;
if(this.toolService.move(bk,this._meta(Y))){Y.preventDefault();
}},_dragEnd:function(X){this._pauseMouseHandlers=false;
var bk=this._eventPositions(X);
var Y=X.event;
if(this.toolService.end(bk,this._meta(Y))){this._createToolBar();
Y.preventDefault();
}},_mouseMove:function(X){if(!this._pauseMouseHandlers&&(X.which===0||X.which===1)){var Y=this._eventPositions(X);
this.toolService._updateHoveredItem(Y);
this.toolService._updateCursor(Y);
}},_tap:function(Y){var bp=this.toolService;
var bo=this.options.selectable;
var bn=this._eventPositions(Y);
var bk=this.focus();
bp._updateHoveredItem(bn);
if(bp.hoveredItem){var bl=bp.hoveredItem;
this.trigger("click",{item:bl,point:bn});
if(bo&&bl.options.selectable!==false){var bm=bo.multiple!==false;
var X=kendo.support.mobileOS||this._meta(Y.event).ctrlKey;
if(bl.isSelected){if(X){this._destroyToolBar();
bl.select(false);
}else{this._createToolBar(bk);
}}else{this._destroyToolBar();
this.select(bl,{addToSelection:bm&&X});
this._createToolBar(bk);
}}}else{if(bo){this._destroyToolBar();
this.deselect();
}}},_keydown:function(X){if(this.toolService.keyDown(X.keyCode,this._meta(X))){X.preventDefault();
}},_wheel:function(Y){var X=aG(Y),bl=this._eventPositions(Y),bk=A(this._meta(Y),{delta:X});
if(this.toolService.wheel(bl,bk)){Y.preventDefault();
}},_meta:function(X){return{ctrlKey:X.ctrlKey,metaKey:X.metaKey,altKey:X.altKey,shiftKey:X.shiftKey};
},_eventPositions:function(X,bl){var bk;
if(X.touch){var Y=bl?"startLocation":"location";
bk=new aM(X.x[Y],X.y[Y]);
}else{bk=new aM(X.pageX,X.pageY);
}return this.documentToModel(bk);
},_gestureStart:function(X){this._destroyToolBar();
this.scroller.disable();
var bk=this.documentToModel(new aM(X.center.x,X.center.y));
var Y={point:bk,zoom:this.zoom()};
if(this.trigger(bj,Y)){return;
}this._gesture=X;
this._initialCenter=bk;
},_gestureChange:function(Y){var bm=this._gesture;
var bk=this._initialCenter;
var X=this.documentToView(new aM(Y.center.x,Y.center.y));
var bn=Y.distance/bm.distance;
var bp=this._zoom;
var bo=false;
if(ax.abs(bn-1)>=aC){this._zoom=bp=this._getValidZoom(bp*bn);
this.options.zoom=bp;
this._gesture=Y;
bo=true;
}var bq=bk.times(bp);
var bl=X.minus(bq);
if(bo||this._pan.distanceTo(bl)>=aB){this._panTransform(bl);
this._updateAdorners();
}Y.preventDefault();
},_gestureEnd:function(){if(this.options.pannable!==false){this.scroller.enable();
}this.trigger(bi,{point:this._initialCenter,zoom:this.zoom()});
},_resize:function(){var X=this.viewport();
if(this.canvas){this.canvas.size(X);
}if(this.scrollable&&this.toolBar){this.scrollable.height(X.height);
}},_mouseover:function(X){var Y=X.target._kendoNode;
if(Y&&Y.srcElement._hover){Y.srcElement._hover(true,Y.srcElement);
}},_mouseout:function(X){var Y=X.target._kendoNode;
if(Y&&Y.srcElement._hover){Y.srcElement._hover(false,Y.srcElement);
}},_initTheme:function(){var X=this,bl=z.ui.themes||{},Y=((X.options||{}).theme||"").toLowerCase(),bk=(bl[Y]||{}).diagram;
X.options=A({},bk,X.options);
if(X.options.editable===true){A(X.options,{editable:(bk||{}).editable});
}},_createOptionElements:function(){var X=this.options;
var Y=X.shapes.length;
if(Y){this._createShapes();
}if(X.connections.length){this._createConnections();
}if(Y&&X.layout){this.layout(X.layout);
}},_createShapes:function(){var bm=this,Y=bm.options,bl=Y.shapes,bk,X;
for(X=0;
X<bl.length;
X++){bk=bl[X];
bm.addShape(bk);
}},_createConnections:function(){var bl=this,bn=bl.options,bk=bn.connectionDefaults,Y=bn.connections,X,bo,bp,bm;
for(bm=0;
bm<Y.length;
bm++){X=Y[bm];
bo=bl._findConnectionTarget(X.from);
bp=bl._findConnectionTarget(X.to);
bl.connect(bo,bp,A({},bk,X));
}},_findConnectionTarget:function(Y){Y=Y||{};
var X=this;
var bk=ar(Y)?Y:Y.shapeId||Y.id;
var bl;
if(bk){bl=X.getShapeById(bk);
if(Y.connector){bl=bl.getConnector(Y.connector);
}}else{bl=new aM(Y.x||0,Y.y||0);
}return bl;
},destroy:function(){var X=this;
be.fn.destroy.call(X);
if(this._userEvents){this._userEvents.destroy();
}kendo.unbindResize(X._resizeHandler);
X.clear();
X.element.off(aI);
X.scroller.wrapper.off(aI);
X.canvas.destroy(true);
X.canvas=bb;
X._destroyEditor();
X.destroyScroller();
X._destroyGlobalToolBar();
X._destroyToolBar();
},destroyScroller:function(){var X=this.scroller;
if(!X){return;
}X.destroy();
X.element.remove();
this.scroller=null;
},save:function(){var bk={shapes:[],connections:[]};
var Y,X,bl;
for(Y=0;
Y<this.shapes.length;
Y++){bl=this.shapes[Y];
if(bl.options.serializable){bk.shapes.push(bl.options);
}}for(Y=0;
Y<this.connections.length;
Y++){X=this.connections[Y];
bk.connections.push(A({},X.options,X.toJSON()));
}return bk;
},focus:function(){if(!this.element.is(kendo._activeElement())){var bk=this.element,bn=bk[0],X=[],bm=[],Y=document.documentElement,bl;
do{bn=bn.parentNode;
if(bn.scrollHeight>bn.clientHeight){X.push(bn);
bm.push(bn.scrollTop);
}}while(bn!=Y);
bk.focus();
for(bl=0;
bl<X.length;
bl++){X[bl].scrollTop=bm[bl];
}return true;
}},load:function(X){this.clear();
this.setOptions(X);
this._createShapes();
this._createConnections();
},setOptions:function(X){A(this.options,X);
},clear:function(){var X=this;
X.select(false);
X.mainLayer.clear();
X._shapesQuadTree.clear();
X._initialize();
},connect:function(bl,bm,bk){var X;
if(this.connectionsDataSource&&this._isEditable){var Y=this.connectionsDataSource.add({});
X=this._connectionsDataMap[Y.uid];
X.source(bl);
X.target(bm);
X.redraw(bk);
X.updateModel();
}else{X=new q(bl,bm,A({},this.options.connectionDefaults,bk));
this.addConnection(X);
}return X;
},connected:function(bk,bl){for(var Y=0;
Y<this.connections.length;
Y++){var X=this.connections[Y];
if(X.from==bk&&X.to==bl){return true;
}}return false;
},addConnection:function(X,Y){if(Y!==false){this.undoRedoService.add(new O.AddConnectionUnit(X,this),false);
}X.diagram=this;
X._setOptionsFromModel();
X.refresh();
this.mainLayer.append(X.visual);
this.connections.push(X);
this.trigger(i,{added:[X],removed:[]});
return X;
},_addConnection:function(X,bl){var Y=this.connectionsDataSource;
var bk;
if(Y&&this._isEditable){bk=x(Y,n(X.dataItem));
X.dataItem=bk;
X.updateModel();
if(!this.trigger("add",{connection:X})){this._connectionsDataMap[bk.uid]=X;
Y.add(bk);
this.addConnection(X,bl);
X._updateConnectors();
return X;
}}else{if(!this.trigger("add",{connection:X})){this.addConnection(X,bl);
X._updateConnectors();
return X;
}}},addShape:function(X,bl){var Y,bk=this.options.shapeDefaults;
if(X instanceof a0){Y=X;
}else{if(!(X instanceof kendo.Class)){bk=A({},bk,X||{});
Y=new a0(bk,this);
}else{return;
}}if(bl!==false){this.undoRedoService.add(new O.AddShapeUnit(Y,this),false);
}this.shapes.push(Y);
if(Y.diagram!==this){this._shapesQuadTree.insert(Y);
Y.diagram=this;
}this.mainLayer.append(Y.visual);
this.trigger(i,{added:[Y],removed:[]});
return Y;
},_addShape:function(bl,bn){var bm=this;
var Y=bm.dataSource;
var X;
if(Y&&this._isEditable){X=x(Y,n(bl.dataItem));
bl.dataItem=X;
bl.updateModel();
if(!this.trigger("add",{shape:bl})){this.dataSource.add(X);
var bk=this._inactiveShapeItems.getByUid(X.uid);
bk.element=bl;
bk.undoable=bn;
return bl;
}}else{if(!this.trigger("add",{shape:bl})){return this.addShape(bl,bn);
}}},remove:function(bl,bn){bl=am(bl)?bl.slice(0):[bl];
var Y=a2(bl);
var bm=Y.shapes;
var X=Y.connections;
var bk;
if(!L(bn)){bn=true;
}if(bn){this.undoRedoService.begin();
}this._suspendModelRefresh();
for(bk=bm.length-1;
bk>=0;
bk--){this._removeItem(bm[bk],bn,X);
}for(bk=X.length-1;
bk>=0;
bk--){this._removeItem(X[bk],bn);
}this._resumeModelRefresh();
if(bn){this.undoRedoService.commit(false);
}this.trigger(i,{added:[],removed:bl});
},_removeShapeDataItem:function(X){if(this._isEditable){this.dataSource.remove(X.dataItem);
delete this._dataMap[X.dataItem.id];
}},_removeConnectionDataItem:function(X){if(this._isEditable){this.connectionsDataSource.remove(X.dataItem);
delete this._connectionsDataMap[X.dataItem.uid];
}},_triggerRemove:function(bm){var bn=[];
var bl,X,Y;
for(var bk=0;
bk<bm.length;
bk++){bl=bm[bk];
Y=bl.options.editable;
if(bl instanceof a0){X={shape:bl};
}else{X={connection:bl};
}if(Y&&Y.remove!==false&&!this.trigger("remove",X)){bn.push(bl);
}}return bn;
},undo:function(){this.undoRedoService.undo();
},redo:function(){this.undoRedoService.redo();
},select:function(bl,bn){if(ao(bl)){bn=A({addToSelection:false},bn);
var X=bn.addToSelection,bm=[],bo=[],bk,Y;
if(!X){this.deselect();
}this._internalSelection=true;
if(bl instanceof Array){bm=bl;
}else{if(bl instanceof Q){bm=[bl];
}}for(bk=0;
bk<bm.length;
bk++){Y=bm[bk];
if(Y.select(true)){bo.push(Y);
}}this._selectionChanged(bo,[]);
this._internalSelection=false;
}else{return this._selectedItems;
}},selectAll:function(){this.select(this.shapes.concat(this.connections));
},selectArea:function(bl){var X,bk,Y;
this._internalSelection=true;
var bm=[];
if(bl instanceof aT){bk=this.shapes.concat(this.connections);
for(X=0;
X<bk.length;
X++){Y=bk[X];
if((!bl||Y._hitTest(bl))&&Y.options.enable){if(Y.select(true)){bm.push(Y);
}}}}this._selectionChanged(bm,[]);
this._internalSelection=false;
},deselect:function(bl){this._internalSelection=true;
var X=[],bm=[],Y,bk;
if(bl instanceof Array){bm=bl;
}else{if(bl instanceof Q){bm.push(bl);
}else{if(!ao(bl)){bm=this._selectedItems.slice(0);
}}}for(bk=0;
bk<bm.length;
bk++){Y=bm[bk];
if(Y.select(false)){X.push(Y);
}}this._selectionChanged([],X);
this._internalSelection=false;
},toFront:function(Y,bl){if(!Y){Y=this._selectedItems.slice();
}var bk=this._getDiagramItems(Y),X;
if(!L(bl)||bl){X=ak(this.mainLayer,bk.visuals);
var bm=new a5(this,Y,X);
this.undoRedoService.add(bm);
}else{this.mainLayer.toFront(bk.visuals);
this._fixOrdering(bk,true);
}},toBack:function(Y,bl){if(!Y){Y=this._selectedItems.slice();
}var bk=this._getDiagramItems(Y),X;
if(!L(bl)||bl){X=ak(this.mainLayer,bk.visuals);
var bm=new a4(this,Y,X);
this.undoRedoService.add(bm);
}else{this.mainLayer.toBack(bk.visuals);
this._fixOrdering(bk,false);
}},bringIntoView:function(bk,bm){var bp=this.viewport();
var X=new O.RectAlign(bp);
var Y,bo,bn,bl;
if(bp.width===0||bp.height===0){return;
}bm=A({animate:false,align:"center middle"},bm);
if(bm.align=="none"){bm.align="center middle";
}if(bk instanceof Q){bo=bk.bounds(a8);
}else{if(am(bk)){bo=this.boundingBox(bk);
}else{if(bk instanceof aT){bo=bk.clone();
}}}bn=bo.clone();
bo.zoom(this._zoom);
if(bo.width>bp.width||bo.height>bp.height){this._zoom=this._getValidZoom(ax.min(bp.width/bn.width,bp.height/bn.height));
bo=bn.clone().zoom(this._zoom);
}this._zoomMainLayer();
Y=bo.clone();
X.align(bo,bm.align);
bl=bo.topLeft().minus(Y.topLeft());
this.pan(bl.times(-1),bm.animate);
},alignShapes:function(X){if(at(X)){X="Left";
}var bl=this.select(),bp,bk,Y;
if(bl.length===0){return;
}switch(X.toLowerCase()){case"left":case"top":bp=ay;
break;
case"right":case"bottom":bp=aA;
break;
}for(Y=0;
Y<bl.length;
Y++){bk=bl[Y];
if(bk instanceof a0){switch(X.toLowerCase()){case"left":bp=ax.min(bp,bk.options.x);
break;
case"top":bp=ax.min(bp,bk.options.y);
break;
case"right":bp=ax.max(bp,bk.options.x);
break;
case"bottom":bp=ax.max(bp,bk.options.y);
break;
}}}var bn=[];
var bm=[];
for(Y=0;
Y<bl.length;
Y++){bk=bl[Y];
if(bk instanceof a0){bm.push(bk);
bn.push(bk.bounds());
switch(X.toLowerCase()){case"left":case"right":bk.position(new aM(bp,bk.options.y));
break;
case"top":case"bottom":bk.position(new aM(bk.options.x,bp));
break;
}}}var bo=new O.TransformUnit(bm,bn);
this.undoRedoService.add(bo,false);
},zoom:function(bm,X){if(bm){var bk=X?X.point:new O.Point(0,0);
bm=this._zoom=this._getValidZoom(bm);
if(!at(bk)){bk=new O.Point(ax.round(bk.x),ax.round(bk.y));
var bn=bk.times(bm);
var bl=this.modelToView(bk);
var Y=bl.minus(bn);
this._storePan(new O.Point(ax.round(Y.x),ax.round(Y.y)));
}if(X){X.zoom=bm;
}this._panTransform();
this.canvas.surface.hideTooltip();
this._updateAdorners();
}return this._zoom;
},_getPan:function(Y){var X=this.canvas;
if(!X.translate){Y=Y.plus(this._pan);
}return Y;
},pan:function(Y,X){if(Y instanceof aM){var bl=this;
var bk=bl.scroller;
Y=bl._getPan(Y);
Y=Y.times(-1);
if(X){bk.animatedScrollTo(Y.x,Y.y,function(){bl._updateAdorners();
});
}else{bk.scrollTo(Y.x,Y.y);
bl._updateAdorners();
}}else{return this._pan.times(-1);
}},viewport:function(){var X=this.element;
var bk=X.width();
var Y=X.height();
if(this.toolBar){Y-=this.toolBar.element.outerHeight();
}return new aT(0,0,bk,Y);
},copy:function(){if(this.options.copy.enabled){this._clipboard=[];
this._copyOffset=1;
for(var X=0;
X<this._selectedItems.length;
X++){var Y=this._selectedItems[X];
this._clipboard.push(Y);
}}},cut:function(){if(this.options.copy.enabled){this._clipboard=[];
this._copyOffset=0;
for(var X=0;
X<this._selectedItems.length;
X++){var Y=this._selectedItems[X];
this._clipboard.push(Y);
}this.remove(this._clipboard,true);
}},paste:function(){if(this._clipboard.length>0){var bm,Y,bl;
var bn={};
var bk=a2(this._clipboard);
var X=bk.connections;
var bp=bk.shapes;
var bo={x:this._copyOffset*this.options.copy.offsetX,y:this._copyOffset*this.options.copy.offsetY};
this.deselect();
for(bl=0;
bl<bp.length;
bl++){bm=bp[bl];
Y=bm.clone();
bn[bm.id]=Y;
Y.position(new aM(bm.options.x+bo.x,bm.options.y+bo.y));
Y.diagram=this;
Y=this._addShape(Y);
if(Y){Y.select();
}}for(bl=0;
bl<X.length;
bl++){bm=X[bl];
Y=this._addConnection(bm.clone());
if(Y){this._updateCopiedConnection(Y,bm,"source",bn,bo);
this._updateCopiedConnection(Y,bm,"target",bn,bo);
Y.select(true);
Y.updateModel();
}}this._syncChanges();
this._copyOffset+=1;
}},_updateCopiedConnection:function(X,bp,Y,bm,bn){var bo,bl,br;
var bq=bp[Y]();
var bk=this;
if(bq instanceof u&&bm[bq.shape.id]){br=bm[bq.shape.id];
if(bk.getShapeById(br.id)){X[Y](br.getConnector(bq.options.name));
}else{bl=bk._inactiveShapeItems.getByUid(br.dataItem.uid);
if(bl){bo=function(bs){br=bk._dataMap[bs.id];
X[Y](br.getConnector(bq.options.name));
X.updateModel();
};
bk._deferredConnectionUpdates.push(bl.onActivate(bo));
}}}else{X[Y](new aM(bp[Y+"Point"]().x+bn.x,bp[Y+"Point"]().y+bn.y));
}},boundingBox:function(bl,bm){var bn=aT.empty(),bo,X=ao(bl)?this._getDiagramItems(bl):{shapes:this.shapes};
if(X.shapes.length>0){var bk=X.shapes[0];
bn=bk.bounds(aX);
for(var Y=1;
Y<X.shapes.length;
Y++){bk=X.shapes[Y];
bo=bk.bounds(aX);
if(bm===true){bo.x-=bk._rotationOffset.x;
bo.y-=bk._rotationOffset.y;
}bn=bn.union(bo);
}}return bn;
},_containerOffset:function(){var X=this.element.offset();
if(this.toolBar){X.top+=this.toolBar.element.outerHeight();
}return X;
},documentToView:function(Y){var X=this._containerOffset();
return new aM(Y.x-X.left,Y.y-X.top);
},viewToDocument:function(Y){var X=this._containerOffset();
return new aM(Y.x+X.left,Y.y+X.top);
},viewToModel:function(X){return this._transformWithMatrix(X,this._matrixInvert);
},modelToView:function(X){return this._transformWithMatrix(X,this._matrix);
},modelToLayer:function(X){return this._transformWithMatrix(X,this._layerMatrix);
},layerToModel:function(X){return this._transformWithMatrix(X,this._layerMatrixInvert);
},documentToModel:function(X){var Y=this.documentToView(X);
if(!this.canvas.translate){Y.x=Y.x+this.scroller.scrollLeft;
Y.y=Y.y+this.scroller.scrollTop;
}return this.viewToModel(Y);
},modelToDocument:function(X){return this.viewToDocument(this.modelToView(X));
},_transformWithMatrix:function(bk,Y){var bl=bk;
if(bk instanceof aM){if(Y){bl=Y.apply(bk);
}}else{var bm=this._transformWithMatrix(bk.topLeft(),Y),X=this._transformWithMatrix(bk.bottomRight(),Y);
bl=aT.fromPoints(bm,X);
}return bl;
},setDataSource:function(X){this.options.dataSource=X;
this._dataSource();
if(this.options.autoBind){this.dataSource.fetch();
}},setConnectionsDataSource:function(X){this.options.connectionsDataSource=X;
this._connectionDataSource();
if(this.options.autoBind){this.connectionsDataSource.fetch();
}},layout:function(bl){this._layouting=true;
var bm;
if(at(bl)){bl=this.options.layout;
}if(at(bl)||at(bl.type)){bm="Tree";
}else{bm=bl.type;
}var bk;
switch(bm.toLowerCase()){case"tree":bk=new O.TreeLayout(this);
break;
case"layered":bk=new O.LayeredLayout(this);
break;
case"forcedirected":case"force":case"spring":case"springembedder":bk=new O.SpringLayout(this);
break;
default:throw"Layout algorithm '"+bm+"' is not supported.";
}var Y=new O.LayoutState(this);
var X=bk.layout(bl);
if(X){var bn=new O.LayoutUndoUnit(Y,X,bl?bl.animate:null);
this.undoRedoService.add(bn);
}this._layouting=false;
this._redrawConnections();
},getShapeById:function(Y){var X;
X=bd.first(this.shapes,function(bk){return bk.visual.id===Y;
});
if(X){return X;
}X=bd.first(this.connections,function(bk){return bk.visual.id===Y;
});
return X;
},getShapeByModelId:function(X){var Y;
if(this._isEditable){Y=this._dataMap[X];
}else{Y=bd.first(this.shapes,function(bk){return(bk.dataItem||{}).id===X;
});
}return Y;
},getShapeByModelUid:function(Y){var X;
if(this._isEditable){X=bd.first(this.shapes,function(bk){return(bk.dataItem||{}).uid===Y;
});
}else{X=this._dataMap[Y];
}return X;
},getConnectionByModelId:function(Y){var X;
if(this.connectionsDataSource){X=bd.first(this.connections,function(bk){return(bk.dataItem||{}).id===Y;
});
}return X;
},getConnectionByModelUid:function(Y){var X;
if(this.connectionsDataSource){X=this._connectionsDataMap[Y];
}return X;
},_extendLayoutOptions:function(X){if(X.layout){X.layout=A(O.LayoutBase.fn.defaultOptions||{},X.layout);
}},_selectionChanged:function(Y,X){if(Y.length||X.length){this.trigger(aY,{selected:Y,deselected:X});
}},_getValidZoom:function(X){return ax.min(ax.max(X,this.options.zoomMin),this.options.zoomMax);
},_panTransform:function(bk){var X=this,Y=bk||X._pan;
if(X.canvas.translate){X.scroller.scrollTo(Y.x,Y.y);
X._zoomMainLayer();
}else{X._storePan(Y);
X._transformMainLayer();
}},_finishPan:function(){this.trigger(aK,{total:this._pan,delta:Number.NaN});
},_storePan:function(X){this._pan=X;
this._storeViewMatrix();
},_zoomMainLayer:function(){var Y=this._zoom;
var X=new p(0,0,Y,Y);
X.render(this.mainLayer);
this._storeLayerMatrix(X);
this._storeViewMatrix();
},_transformMainLayer:function(){var X=this._pan,bk=this._zoom;
var Y=new p(X.x,X.y,bk,bk);
Y.render(this.mainLayer);
this._storeLayerMatrix(Y);
this._storeViewMatrix();
},_storeLayerMatrix:function(X){this._layerMatrix=X.toMatrix();
this._layerMatrixInvert=X.invert().toMatrix();
},_storeViewMatrix:function(){var X=this._pan,bk=this._zoom;
var Y=new p(X.x,X.y,bk,bk);
this._matrix=Y.toMatrix();
this._matrixInvert=Y.invert().toMatrix();
},_toIndex:function(Y,X){var bk=this._getDiagramItems(Y);
this.mainLayer.toIndex(bk.visuals,X);
this._fixOrdering(bk,false);
},_fixOrdering:function(bl,bn){var bm=bn?this.shapes.length-1:0,X=bn?this.connections.length-1:0,Y,bk;
for(Y=0;
Y<bl.shapes.length;
Y++){bk=bl.shapes[Y];
bd.remove(this.shapes,bk);
bd.insert(this.shapes,bk,bm);
}for(Y=0;
Y<bl.cons.length;
Y++){bk=bl.cons[Y];
bd.remove(this.connections,bk);
bd.insert(this.connections,bk,X);
}},_getDiagramItems:function(bl){var Y,bm={},X=bl;
bm.visuals=[];
bm.shapes=[];
bm.cons=[];
if(!bl){X=this._selectedItems.slice();
}else{if(!am(bl)){X=[bl];
}}for(Y=0;
Y<X.length;
Y++){var bk=X[Y];
if(bk instanceof a0){bm.shapes.push(bk);
bm.visuals.push(bk.visual);
}else{if(bk instanceof q){bm.cons.push(bk);
bm.visuals.push(bk.visual);
}}}return bm;
},_removeItem:function(X,bk,Y){X.select(false);
if(X instanceof a0){this._removeShapeDataItem(X);
this._removeShape(X,bk,Y);
}else{if(X instanceof q){this._removeConnectionDataItem(X);
this._removeConnection(X,bk);
}}this.mainLayer.remove(X.visual);
},_removeShape:function(bn,bq,bm){var bk,X,Y,bo=[],bp=[];
this.toolService._removeHover();
if(bq){this.undoRedoService.addCompositeItem(new N(bn));
}bd.remove(this.shapes,bn);
this._shapesQuadTree.remove(bn);
for(bk=0;
bk<bn.connectors.length;
bk++){Y=bn.connectors[bk];
for(var bl=0;
bl<Y.connections.length;
bl++){X=Y.connections[bl];
if(!bm||!z.inArray(X,bm)){if(X.sourceConnector==Y){bo.push(X);
}else{if(X.targetConnector==Y){bp.push(X);
}}}}}for(bk=0;
bk<bo.length;
bk++){bo[bk].source(null,bq);
bo[bk].updateModel();
}for(bk=0;
bk<bp.length;
bk++){bp[bk].target(null,bq);
bp[bk].updateModel();
}},_removeConnection:function(X,Y){if(X.sourceConnector){bd.remove(X.sourceConnector.connections,X);
}if(X.targetConnector){bd.remove(X.targetConnector.connections,X);
}if(Y){this.undoRedoService.addCompositeItem(new M(X));
}bd.remove(this.connections,X);
},_removeDataItems:function(bl,bm){var bk,X,bn,Y;
bl=am(bl)?bl:[bl];
while(bl.length){bk=bl.shift();
bn=this._dataMap[bk.uid];
if(bn){this._removeShapeConnections(bn);
this._removeItem(bn,false);
delete this._dataMap[bk.uid];
if(bm&&bk.hasChildren&&bk.loaded()){X=bk.children.data();
for(Y=0;
Y<X.length;
Y++){bl.push(X[Y]);
}}}}},_removeShapeConnections:function(bk){var X=bk.connections();
var Y;
if(X){for(Y=0;
Y<X.length;
Y++){this._removeItem(X[Y],false);
}}},_addDataItem:function(X,bl){if(!L(X)){return;
}var bk=this._dataMap[X.id];
if(bk){return bk;
}var Y=A({},this.options.shapeDefaults);
Y.dataItem=X;
bk=new a0(Y,this);
this.addShape(bk,bl!==false);
this._dataMap[X.id]=bk;
return bk;
},_addDataItemByUid:function(X){if(!L(X)){return;
}var bk=this._dataMap[X.uid];
if(bk){return bk;
}var Y=A({},this.options.shapeDefaults);
Y.dataItem=X;
bk=new a0(Y,this);
this.addShape(bk);
this._dataMap[X.uid]=bk;
return bk;
},_addDataItems:function(bl,bm){var bk,Y,bo,bn,X;
for(Y=0;
Y<bl.length;
Y++){bk=bl[Y];
bo=this._addDataItemByUid(bk);
bn=this._addDataItemByUid(bm);
if(bn&&!this.connected(bn,bo)){X=this.connect(bn,bo);
}}},_refreshSource:function(bk){var bp=this,bn=bk.node,X=bk.action,bm=bk.items,bo=bp.options,bl,Y;
if(bk.field){for(bl=0;
bl<bm.length;
bl++){if(this._dataMap[bm[bl].uid]){this._dataMap[bm[bl].uid].redrawVisual();
}}return;
}if(X=="remove"){this._removeDataItems(bk.items,true);
}else{if((!X||X==="itemloaded")&&!this._bindingRoots){this._bindingRoots=true;
Y=true;
}if(!X&&!bn){bp.clear();
}this._addDataItems(bm,bn);
for(bl=0;
bl<bm.length;
bl++){bm[bl].load();
}}if(bo.layout&&(Y||X=="remove"||X=="add")){bp.layout(bo.layout);
}if(Y){this.trigger("dataBound");
this._bindingRoots=false;
}},_addItem:function(X){if(X instanceof a0){this.addShape(X);
}else{if(X instanceof q){this.addConnection(X);
}}},_createToolBar:function(bq){var Y=this.toolService.diagram;
if(!this.singleToolBar&&Y.select().length===1){var bl=Y.select()[0];
if(bl&&bl.options.editable!==false){var bk=bl.options.editable;
var bs=bk.tools;
if(this._isEditable&&bs.length===0){if(bl instanceof a0){bs=["edit","rotateClockwise","rotateAnticlockwise"];
}else{if(bl instanceof q){bs=["edit"];
}}if(bk&&bk.remove!==false){bs.push("delete");
}}if(bs&&bs.length){var bm=20;
var bn;
this.singleToolBar=new R(Y,{tools:bs,click:aQ(this._toolBarClick,this),modal:true});
var bp=this.singleToolBar._popup.element.outerWidth();
var bo=this.singleToolBar._popup.element.outerHeight();
if(bl instanceof a0){var br=this.modelToView(bl.bounds(aX));
bn=aM(br.x,br.y).minus(aM((bp-br.width)/2,bo+bm));
}else{if(bl instanceof q){var X=this.modelToView(bl.bounds());
bn=aM(X.x,X.y).minus(aM((bp-X.width-20)/2,bo+bm));
}}if(bn){if(!this.canvas.translate){bn=bn.minus(aM(this.scroller.scrollLeft,this.scroller.scrollTop));
}bn=this.viewToDocument(bn);
bn=aM(ax.max(bn.x,0),ax.max(bn.y,0));
this.singleToolBar.showAt(bn);
if(bq){this.singleToolBar._popup.one("close",aP);
}}else{this._destroyToolBar();
}}}}},_toolBarClick:function(X){this.trigger("toolBarClick",X);
this._destroyToolBar();
},_normalizePointZoom:function(X){return X.times(1/this.zoom());
},_initialize:function(){this.shapes=[];
this._selectedItems=[];
this.connections=[];
this._dataMap={};
this._connectionsDataMap={};
this._inactiveShapeItems=new aj();
this._deferredConnectionUpdates=[];
this.undoRedoService=new bc({undone:this._syncHandler,redone:this._syncHandler});
this.id=O.randomId();
},_fetchFreshData:function(){var X=this;
X._dataSource();
if(X._isEditable){X._connectionDataSource();
}if(X.options.autoBind){if(X._isEditable){this._loadingShapes=true;
this._loadingConnections=true;
X.dataSource.fetch();
X.connectionsDataSource.fetch();
}else{X.dataSource.fetch();
}}},_dataSource:function(){if(L(this.options.connectionsDataSource)){this._isEditable=true;
var Y=this.options.dataSource||{};
var X=am(Y)?{data:Y}:Y;
if(this.dataSource&&this._shapesRefreshHandler){this.dataSource.unbind("change",this._shapesRefreshHandler).unbind("requestStart",this._shapesRequestStartHandler).unbind("error",this._shapesErrorHandler);
}else{this._shapesRefreshHandler=aQ(this._refreshShapes,this);
this._shapesRequestStartHandler=aQ(this._shapesRequestStart,this);
this._shapesErrorHandler=aQ(this._error,this);
}this.dataSource=kendo.data.DataSource.create(X).bind("change",this._shapesRefreshHandler).bind("requestStart",this._shapesRequestStartHandler).bind("error",this._shapesErrorHandler);
}else{this._treeDataSource();
this._isEditable=false;
}},_connectionDataSource:function(){var Y=this.options.connectionsDataSource;
if(Y){var X=am(Y)?{data:Y}:Y;
if(this.connectionsDataSource&&this._connectionsRefreshHandler){this.connectionsDataSource.unbind("change",this._connectionsRefreshHandler).unbind("requestStart",this._connectionsRequestStartHandler).unbind("error",this._connectionsErrorHandler);
}else{this._connectionsRefreshHandler=aQ(this._refreshConnections,this);
this._connectionsRequestStartHandler=aQ(this._connectionsRequestStart,this);
this._connectionsErrorHandler=aQ(this._connectionsError,this);
}this.connectionsDataSource=kendo.data.DataSource.create(X).bind("change",this._connectionsRefreshHandler).bind("requestStart",this._connectionsRequestStartHandler).bind("error",this._connectionsErrorHandler);
}},_shapesRequestStart:function(X){if(X.type=="read"){this._loadingShapes=true;
}},_connectionsRequestStart:function(X){if(X.type=="read"){this._loadingConnections=true;
}},_error:function(){this._loadingShapes=false;
},_connectionsError:function(){this._loadingConnections=false;
},_refreshShapes:function(X){if(X.action==="remove"){if(this._shouldRefresh()){this._removeShapes(X.items);
}}else{if(X.action==="itemchange"){if(this._shouldRefresh()){this._updateShapes(X.items,X.field);
}}else{if(X.action==="add"){this._inactiveShapeItems.add(X.items);
}else{if(X.action==="sync"){this._syncShapes(X.items);
}else{this.refresh();
}}}}},_shouldRefresh:function(){return !this._suspended;
},_suspendModelRefresh:function(){this._suspended=(this._suspended||0)+1;
},_resumeModelRefresh:function(){this._suspended=ax.max((this._suspended||0)-1,0);
},refresh:function(){this._loadingShapes=false;
if(!this._loadingConnections){this._rebindShapesAndConnections();
}},_rebindShapesAndConnections:function(){this.clear();
this._addShapes(this.dataSource.view());
if(this.connectionsDataSource){this._addConnections(this.connectionsDataSource.view(),false);
}if(this.options.layout){this.layout(this.options.layout);
}else{this._redrawConnections();
}this.trigger("dataBound");
},refreshConnections:function(){this._loadingConnections=false;
if(!this._loadingShapes){this._rebindShapesAndConnections();
}},_redrawConnections:function(){var X=this.connections;
for(var Y=0;
Y<X.length;
Y++){X[Y].refresh();
}},_removeShapes:function(bl){var X=this._dataMap;
var bk,Y;
for(Y=0;
Y<bl.length;
Y++){bk=bl[Y];
if(X[bk.id]){this.remove(X[bk.id],false);
X[bk.id]=null;
}}},_syncShapes:function(){var X=this;
var Y=X._inactiveShapeItems;
Y.forEach(function(bl){var bk=bl.dataItem;
var bm=bl.element;
if(!bk.isNew()){if(bm){bm._setOptionsFromModel();
X.addShape(bm,bl.undoable);
X._dataMap[bk.id]=bm;
}else{X._addDataItem(bk);
}bl.activate();
Y.remove(bk);
}});
},_updateShapes:function(bl,Y){for(var bk=0;
bk<bl.length;
bk++){var X=bl[bk];
var bm=this._dataMap[X.id];
if(bm){bm.updateOptionsFromModel(X,Y);
}}},_addShapes:function(X){for(var Y=0;
Y<X.length;
Y++){this._addDataItem(X[Y],false);
}},_refreshConnections:function(X){if(X.action==="remove"){if(this._shouldRefresh()){this._removeConnections(X.items);
}}else{if(X.action==="add"){this._addConnections(X.items);
}else{if(X.action==="sync"){}else{if(X.action==="itemchange"){if(this._shouldRefresh()){this._updateConnections(X.items);
}}else{this.refreshConnections();
}}}}},_removeConnections:function(Y){for(var X=0;
X<Y.length;
X++){this.remove(this._connectionsDataMap[Y[X].uid],false);
this._connectionsDataMap[Y[X].uid]=null;
}},_updateConnections:function(bl){for(var bk=0;
bk<bl.length;
bk++){var Y=bl[bk];
var X=this._connectionsDataMap[Y.uid];
X.updateOptionsFromModel(Y);
}},_addConnections:function(X,bm){var bl=X.length;
for(var bk=0;
bk<bl;
bk++){var Y=X[bk];
this._addConnectionDataItem(Y,bm);
}},_addConnectionDataItem:function(Y,bn){if(!this._connectionsDataMap[Y.uid]){var bk=this._validateConnector(Y.from);
if(!L(bk)||bk===null){bk=new aM(Y.fromX,Y.fromY);
}var bm=this._validateConnector(Y.to);
if(!L(bm)||bm===null){bm=new aM(Y.toX,Y.toY);
}if(L(bk)&&L(bm)){var bl=A({},this.options.connectionDefaults);
bl.dataItem=Y;
var X=new q(bk,bm,bl);
this._connectionsDataMap[Y.uid]=X;
this.addConnection(X,bn);
}}},_validateConnector:function(Y){var X;
if(L(Y)&&Y!==null){X=this._dataMap[Y];
}return X;
},_treeDataSource:function(){var bk=this,Y=bk.options,X=Y.dataSource;
X=am(X)?{data:X}:X;
if(X instanceof kendo.data.DataSource&&!(X instanceof kendo.data.HierarchicalDataSource)){throw new Error("Incorrect DataSource type. If a single dataSource instance is set to the diagram then it should be a HierarchicalDataSource. You should set only the options instead of an instance or a HierarchicalDataSource instance or supply connectionsDataSource as well.");
}if(!X.fields){X.fields=[{field:"text"},{field:"url"},{field:"spriteCssClass"},{field:"imageUrl"}];
}if(bk.dataSource&&bk._refreshHandler){bk._unbindDataSource();
}bk._refreshHandler=aQ(bk._refreshSource,bk);
bk._errorHandler=aQ(bk._error,bk);
bk.dataSource=ag.create(X).bind(i,bk._refreshHandler).bind(Z,bk._errorHandler);
},_unbindDataSource:function(){var X=this;
X.dataSource.unbind(i,X._refreshHandler).unbind(Z,X._errorHandler);
},_adorn:function(X,Y){if(Y!==bb&&X){if(Y){this._adorners.push(X);
this.adornerLayer.append(X.visual);
}else{bd.remove(this._adorners,X);
this.adornerLayer.remove(X.visual);
}}},_showConnectors:function(X,Y){if(Y){this._connectorsAdorner.show(X);
}else{this._connectorsAdorner.destroy();
}},_updateAdorners:function(){var Y=this._adorners;
for(var bk=0;
bk<Y.length;
bk++){var X=Y[bk];
if(X.refreshBounds){X.refreshBounds();
}X.refresh();
}},_refresh:function(){for(var X=0;
X<this.connections.length;
X++){this.connections[X].refresh();
}},_destroyToolBar:function(){if(this.singleToolBar){this.singleToolBar.hide();
this.singleToolBar.destroy();
this.singleToolBar=null;
}},_destroyGlobalToolBar:function(){if(this.toolBar){this.toolBar.hide();
this.toolBar.destroy();
this.toolBar=null;
}},exportDOMVisual:function(){var bm=this.canvas._viewBox;
var bl=ad.transform().translate(-bm.x,-bm.y);
var bn=new ad.Rect([0,0],[bm.width,bm.height]);
var X=V.Path.fromRect(bn);
var bo=new V.Group({transform:bl});
var Y=new V.Group({clip:X});
var bk=this.canvas.drawingElement.children[0];
Y.append(bo);
bo.children.push(bk);
return Y;
},exportVisual:function(){var Y=ad.transform().scale(1/this._zoom);
var bk=new V.Group({transform:Y});
var X=this.mainLayer.drawingElement;
bk.children.push(X);
return bk;
},_syncChanges:function(){this._syncShapeChanges();
this._syncConnectionChanges();
},_syncShapeChanges:function(){if(this.dataSource&&this._isEditable){this.dataSource.sync();
}},_syncConnectionChanges:function(){var X=this;
if(X.connectionsDataSource&&X._isEditable){a.when.apply(a,X._deferredConnectionUpdates).then(function(){X.connectionsDataSource.sync();
});
X.deferredConnectionUpdates=[];
}}});
z.ExportMixin.extend(P.fn,true);
if(kendo.PDFMixin){kendo.PDFMixin.extend(P.fn);
}function ac(X){var Y={};
X=X||{};
if(L(X.text)&&X.text!==null){Y.text=X.text;
}if(L(X.x)&&X.x!==null){Y.x=X.x;
}if(L(X.y)&&X.y!==null){Y.y=X.y;
}if(L(X.width)&&X.width!==null){Y.width=X.width;
}if(L(X.height)&&X.height!==null){Y.height=X.height;
}if(L(X.type)&&X.type!==null){Y.type=X.type;
}return Y;
}function ab(X){var Y={};
X=X||{};
if(L(X.text)&&X.text!==null){Y.content=X.text;
}if(L(X.type)&&X.type!==null){Y.type=X.type;
}if(L(X.from)&&X.from!==null){Y.from=X.from;
}if(L(X.fromConnector)&&X.fromConnector!==null){Y.fromConnector=X.fromConnector;
}if(L(X.fromX)&&X.fromX!==null){Y.fromX=X.fromX;
}if(L(X.fromY)&&X.fromY!==null){Y.fromY=X.fromY;
}if(L(X.to)&&X.to!==null){Y.to=X.to;
}if(L(X.toConnector)&&X.toConnector!==null){Y.toConnector=X.toConnector;
}if(L(X.toX)&&X.toX!==null){Y.toX=X.toX;
}if(L(X.toY)&&X.toY!==null){Y.toY=X.toY;
}return Y;
}var R=kendo.Observable.extend({init:function(X,Y){kendo.Observable.fn.init.call(this);
this.diagram=X;
this.options=A({},this.options,Y);
this._tools=[];
this.createToolBar();
this.createTools();
this.appendTools();
if(this.options.modal){this.createPopup();
}this.bind(this.events,Y);
},events:["click"],createPopup:function(){this.container=a("<div/>").append(this.element);
this._popup=this.container.kendoPopup({}).getKendoPopup();
},appendTools:function(){for(var X=0;
X<this._tools.length;
X++){var Y=this._tools[X];
if(Y.buttons&&Y.buttons.length||!L(Y.buttons)){this._toolBar.add(Y);
}}},createToolBar:function(){this.element=a("<div/>");
this._toolBar=this.element.kendoToolBar({click:aQ(this.click,this),resizable:false}).getKendoToolBar();
this.element.css("border","none");
},createTools:function(){for(var X=0;
X<this.options.tools.length;
X++){this.createTool(this.options.tools[X]);
}},createTool:function(X){if(!aq(X)){X={name:X};
}var Y=X.name+"Tool";
if(this[Y]){this[Y](X);
}else{this._tools.push(A({},X,{attributes:this._setAttributes({action:X.name})}));
}},showAt:function(X){if(this._popup){this._popup.open(X.x,X.y);
}},hide:function(){if(this._popup){this._popup.close();
}},newGroup:function(){return{type:"buttonGroup",buttons:[]};
},editTool:function(){this._tools.push({spriteCssClass:"k-icon k-i-pencil",showText:"overflow",type:"button",text:"Edit",attributes:this._setAttributes({action:"edit"})});
},deleteTool:function(){this._tools.push({spriteCssClass:"k-icon k-i-close",showText:"overflow",type:"button",text:"Delete",attributes:this._setAttributes({action:"delete"})});
},rotateAnticlockwiseTool:function(X){this._appendGroup("rotate");
this._rotateGroup.buttons.push({spriteCssClass:"k-icon k-i-rotateccw",showText:"overflow",text:"RotateAnticlockwise",group:"rotate",attributes:this._setAttributes({action:"rotateAnticlockwise",step:X.step})});
},rotateClockwiseTool:function(X){this._appendGroup("rotate");
this._rotateGroup.buttons.push({spriteCssClass:"k-icon k-i-rotatecw",attributes:this._setAttributes({action:"rotateClockwise",step:X.step}),showText:"overflow",text:"RotateClockwise",group:"rotate"});
},createShapeTool:function(){this._appendGroup("create");
this._createGroup.buttons.push({spriteCssClass:"k-icon k-i-shape",showText:"overflow",text:"CreateShape",group:"create",attributes:this._setAttributes({action:"createShape"})});
},createConnectionTool:function(){this._appendGroup("create");
this._createGroup.buttons.push({spriteCssClass:"k-icon k-i-connector",showText:"overflow",text:"CreateConnection",group:"create",attributes:this._setAttributes({action:"createConnection"})});
},undoTool:function(){this._appendGroup("history");
this._historyGroup.buttons.push({spriteCssClass:"k-icon k-i-undo",showText:"overflow",text:"Undo",group:"history",attributes:this._setAttributes({action:"undo"})});
},redoTool:function(){this._appendGroup("history");
this._historyGroup.buttons.push({spriteCssClass:"k-icon k-i-redo",showText:"overflow",text:"Redo",group:"history",attributes:this._setAttributes({action:"redo"})});
},_appendGroup:function(X){var Y="_"+X+"Group";
if(!this[Y]){this[Y]=this.newGroup();
this._tools.push(this[Y]);
}},_setAttributes:function(Y){var X={};
if(Y.action){X[kendo.attr("action")]=Y.action;
}if(Y.step){X[kendo.attr("step")]=Y.step;
}return X;
},_getAttributes:function(bk){var Y={};
var X=bk.attr(kendo.attr("action"));
if(X){Y.action=X;
}var bl=bk.attr(kendo.attr("step"));
if(bl){Y.step=bl;
}return Y;
},click:function(bk){var Y=this._getAttributes(a(bk.target));
var X=Y.action;
if(X&&this[X]){this[X](Y);
}this.trigger("click",this.eventData(X,bk.target));
},eventData:function(X,bp){var bl=this.selectedElements(),bn=bl.length,bo=[],Y=[],bk;
for(var bm=0;
bm<bn;
bm++){bk=bl[bm];
if(bk instanceof a0){bo.push(bk);
}else{Y.push(bk);
}}return{shapes:bo,connections:Y,action:X,target:bp};
},"delete":function(){var X=this.diagram;
var Y=X._triggerRemove(this.selectedElements());
if(Y.length){this.diagram.remove(Y,true);
this.diagram._syncChanges();
}},edit:function(){var X=this.selectedElements();
if(X.length===1){this.diagram.edit(X[0]);
}},rotateClockwise:function(Y){var X=parseFloat(Y.step||90);
this._rotate(X);
},rotateAnticlockwise:function(Y){var X=parseFloat(Y.step||90);
this._rotate(-X);
},_rotate:function(Y){var X=this.diagram._resizingAdorner;
X.angle(X.angle()+Y);
X.rotate();
},selectedElements:function(){return this.diagram.select();
},createShape:function(){this.diagram.createShape();
},createConnection:function(){this.diagram.createConnection();
},undo:function(){this.diagram.undo();
},redo:function(){this.diagram.redo();
},destroy:function(){this.diagram=null;
this.element=null;
this.options=null;
if(this._toolBar){this._toolBar.destroy();
}if(this._popup){this._popup.destroy();
}}});
var W=kendo.Observable.extend({init:function(X,Y){kendo.Observable.fn.init.call(this);
this.options=aa(true,{},this.options,Y);
this.element=X;
this.model=this.options.model;
this.fields=this._getFields();
this._initContainer();
this.createEditable();
},options:{editors:{}},_initContainer:function(){this.wrapper=this.element;
},createEditable:function(){var X=this.options;
this.editable=new kendo.ui.Editable(this.wrapper,{fields:this.fields,target:X.target,clearContainer:false,model:this.model});
},_isEditable:function(X){return this.model.editable&&this.model.editable(X);
},_getFields:function(){var bk=[];
var bl=this.model.fields;
for(var Y in bl){var bm={};
if(this._isEditable(Y)){var X=this.options.editors[Y];
if(X){bm.editor=X;
}bm.field=Y;
bk.push(bm);
}}return bk;
},end:function(){return this.editable.end();
},destroy:function(){this.editable.destroy();
this.editable.element.find("["+kendo.attr("container-for")+"]").empty();
this.model=this.wrapper=this.element=this.columns=this.editable=null;
}});
var aO=W.extend({init:function(X,Y){W.fn.init.call(this,X,Y);
this.bind(this.events,this.options);
this.open();
},events:["update","cancel"],options:{window:{modal:true,resizable:false,draggable:true,title:"Edit",visible:false}},_initContainer:function(){var Y=this;
this.wrapper=a('<div class="k-popup-edit-form"/>').attr(kendo.attr("uid"),this.model.uid);
var X="";
if(this.options.template){X+=this._renderTemplate();
this.fields=[];
}else{X+=this._renderFields();
}X+=this._renderButtons();
this.wrapper.append(a('<div class="k-edit-form-container"/>').append(X));
this.window=new kendo.ui.Window(this.wrapper.appendTo(this.element),this.options.window);
this.window.bind("close",function(bk){if(bk.userTriggered){bk.sender.element.focus();
Y._cancelClick(bk);
}});
this._attachButtonEvents();
},_renderTemplate:function(){var X=this.options.template;
if(typeof X==="string"){X=window.unescape(X);
}X=kendo.template(X)(this.model);
return X;
},_renderFields:function(){var Y="";
for(var bk=0;
bk<this.fields.length;
bk++){var X=this.fields[bk];
Y+='<div class="k-edit-label"><label for="'+X.field+'">'+(X.field||"")+"</label></div>";
if(this._isEditable(X.field)){Y+="<div "+kendo.attr("container-for")+'="'+X.field+'" class="k-edit-field"></div>';
}}return Y;
},_renderButtons:function(){var X='<div class="k-edit-buttons k-state-default">';
X+=this._createButton("update");
X+=this._createButton("cancel");
X+="</div>";
return X;
},_createButton:function(X){return kendo.template(e)(K[X]);
},_attachButtonEvents:function(){this._cancelClickHandler=aQ(this._cancelClick,this);
this.window.element.on(m+aI,"a.k-diagram-cancel",this._cancelClickHandler);
this._updateClickHandler=aQ(this._updateClick,this);
this.window.element.on(m+aI,"a.k-diagram-update",this._updateClickHandler);
},_updateClick:function(X){X.preventDefault();
this.trigger("update");
},_cancelClick:function(X){X.preventDefault();
this.trigger("cancel");
},open:function(){this.window.center().open();
},close:function(){this.window.bind("deactivate",aQ(this.destroy,this)).close();
},destroy:function(){this.window.close().destroy();
this.window.element.off(m+aI,"a.k-diagram-cancel",this._cancelClickHandler);
this.window.element.off(m+aI,"a.k-diagram-update",this._updateClickHandler);
this._cancelClickHandler=null;
this._editUpdateClickHandler=null;
this.window=null;
W.fn.destroy.call(this);
}});
function t(X,bk){var Y=this.dataSource.reader.model;
if(Y){var bl=Y.fn.fields.text?"text":Y.idField;
a("<input name='"+bk.field+"' />").appendTo(X).kendoDropDownList({dataValueField:Y.idField,dataTextField:bl,dataSource:this.dataSource.data().toJSON(),optionLabel:" ",valuePrimitive:true});
}}function ai(X){this.dataItem=X;
this.callbacks=[];
}ai.fn=ai.prototype={onActivate:function(X){var Y=a.Deferred();
this.callbacks.push({callback:X,deferred:Y});
return Y;
},activate:function(){var X=this.callbacks;
var bk;
for(var Y=0;
Y<X.length;
Y++){bk=this.callbacks[Y];
bk.callback(this.dataItem);
bk.deferred.resolve();
}this.callbacks=[];
}};
function aj(){this.items={};
}aj.fn=aj.prototype={add:function(Y){for(var X=0;
X<Y.length;
X++){this.items[Y[X].uid]=new ai(Y[X]);
}},forEach:function(X){for(var Y in this.items){X(this.items[Y]);
}},getByUid:function(X){return this.items[X];
},remove:function(X){delete this.items[X.uid];
}};
var aS=k.extend({init:function(){this.shapes=[];
},_add:function(Y,X){this.shapes.push({bounds:X,shape:Y});
Y._quadNode=this;
},insert:function(Y,X){this._add(Y,X);
},remove:function(bk){var bl=this.shapes;
var Y=bl.length;
for(var X=0;
X<Y;
X++){if(bl[X].shape===bk){bl.splice(X,1);
break;
}}},hitTestRect:function(bk){var bl=this.shapes;
var Y=bl.length;
for(var X=0;
X<Y;
X++){if(this._testRect(bl[X].shape,bk)){return true;
}}},_testRect:function(bm,bl){var X=bm.rotate().angle;
var Y=bm.bounds();
var bk;
if(!X){bk=Y.overlaps(bl);
}else{bk=al.rects(bl,Y,-X);
}return bk;
}});
var aR=aS.extend({init:function(X){aS.fn.init.call(this);
this.children=[];
this.rect=X;
},inBounds:function(bm){var bl=this.rect;
var bk=bl.bottomRight();
var X=bm.bottomRight();
var Y=bl.x<=bm.x&&bl.y<=bm.y&&X.x<=bk.x&&X.y<=bk.y;
return Y;
},overlapsBounds:function(X){return this.rect.overlaps(X);
},insert:function(bn,X){var bl=false;
var Y=this.children;
var bm=Y.length;
if(this.inBounds(X)){if(!bm&&this.shapes.length<4){this._add(bn,X);
}else{if(!bm){this._initChildren();
}for(var bk=0;
bk<Y.length;
bk++){if(Y[bk].insert(bn,X)){bl=true;
break;
}}if(!bl){this._add(bn,X);
}}bl=true;
}return bl;
},_initChildren:function(){var bn=this.rect,bk=this.children,bp=this.shapes,X=bn.center(),bm=bn.width/2,bl=bn.height/2,Y,bo;
bk.push(new aR(new aT(bn.x,bn.y,bm,bl)),new aR(new aT(X.x,bn.y,bm,bl)),new aR(new aT(bn.x,X.y,bm,bl)),new aR(new aT(X.x,X.y,bm,bl)));
for(bo=bp.length-1;
bo>=0;
bo--){for(Y=0;
Y<bk.length;
Y++){if(bk[Y].insert(bp[bo].shape,bp[bo].bounds)){bp.splice(bo,1);
break;
}}}},hitTestRect:function(bm){var bk;
var X=this.children;
var bl=X.length;
var Y=false;
if(this.overlapsBounds(bm)){if(aS.fn.hitTestRect.call(this,bm)){Y=true;
}else{for(bk=0;
bk<bl;
bk++){if(X[bk].hitTestRect(bm)){Y=true;
break;
}}}}return Y;
}});
var a1=k.extend({ROOT_SIZE:1000,init:function(Y){var X=aQ(this._boundsChange,this);
Y.bind(au,X);
Y.bind(av,X);
this.initRoots();
},initRoots:function(){this.rootMap={};
this.root=new aS();
},clear:function(){this.initRoots();
},_boundsChange:function(X){if(X.item._quadNode){X.item._quadNode.remove(X.item);
}this.insert(X.item);
},insert:function(bl){var X=bl.bounds(aX);
var Y=this.ROOT_SIZE;
var bk=this.getSectors(X);
var bm=bk[0][0];
var bn=bk[1][0];
if(this.inRoot(bk)){this.root.insert(bl,X);
}else{if(!this.rootMap[bm]){this.rootMap[bm]={};
}if(!this.rootMap[bm][bn]){this.rootMap[bm][bn]=new aR(new aT(bm*Y,bn*Y,Y,Y));
}this.rootMap[bm][bn].insert(bl,X);
}},remove:function(X){if(X._quadNode){X._quadNode.remove(X);
}},inRoot:function(X){return X[0].length>1||X[1].length>1;
},getSectors:function(bl){var bm=this.ROOT_SIZE;
var X=bl.bottomRight();
var Y=ax.floor(X.x/bm);
var bk=ax.floor(X.y/bm);
var bn=[[],[]];
for(var bo=ax.floor(bl.x/bm);
bo<=Y;
bo++){bn[0].push(bo);
}for(var bp=ax.floor(bl.y/bm);
bp<=bk;
bp++){bn[1].push(bp);
}return bn;
},hitTestRect:function(X){var bk=this.getSectors(X);
var bm,bo,bl,bn;
var Y;
if(this.root.hitTestRect(X)){return true;
}for(bm=0;
bm<bk[0].length;
bm++){bl=bk[0][bm];
for(bo=0;
bo<bk[1].length;
bo++){bn=bk[1][bo];
Y=(this.rootMap[bl]||{})[bn];
if(Y&&Y.hitTestRect(X)){return true;
}}}return false;
}});
function n(X){var Y=X;
if(X instanceof kendo.data.Model){Y=X.toJSON();
Y[X.idField]=X._defaultId;
}return Y;
}function a2(bk){var X=[];
var bm=[];
var Y,bl;
for(bl=0;
bl<bk.length;
bl++){Y=bk[bl];
if(Y instanceof a0){bm.push(Y);
}else{X.push(Y);
}}return{shapes:bm,connections:X};
}function x(X,Y){if(X.reader.model){return new X.reader.model(Y);
}return new kendo.data.ObservableObject(Y);
}function l(X,Y){if(L(Y[X])){Y.set(X,null);
}}function w(bm,X,bk){var Y;
for(var bl=0;
bl<bk.length;
bl++){Y=bk[bl];
if(X&&!L(X[Y])){X[Y]=bm[Y];
}}}function a9(Y){var X=Y.drawingContainer().clippedBBox(null);
if(X.origin.x!==0||X.origin.y!==0){Y.position(-X.origin.x,-X.origin.y);
}}function aP(X){X.preventDefault();
}z.ui.plugin(P);
A(O,{Shape:a0,Connection:q,Connector:u,DiagramToolBar:R,QuadNode:aR,QuadRoot:aS,ShapesQuadTree:a1,PopupEditor:aO});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("kendo.dataviz.diagram",["kendo.data","kendo.draganddrop","kendo.userevents","kendo.mobile.scroller","kendo.drawing","dataviz/diagram/utils","dataviz/diagram/math","dataviz/diagram/svg","dataviz/diagram/services","dataviz/diagram/layout","dataviz/diagram/dom"],b);
}(function(){var a={id:"dataviz.diagram",name:"Diagram",category:"dataviz",description:"The Kendo DataViz Diagram ",depends:["data","userevents","mobile.scroller","draganddrop","drawing","dataviz.core","dataviz.themes","toolbar"],features:[{id:"dataviz.diagram-pdf-export",name:"PDF export",description:"Export Diagram as PDF",depends:["pdf"]},{id:"dataviz.diagram-editing",name:"Editing",description:"Support for model editing",depends:["editable","window","dropdownlist"]}]};
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
